"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[531],{58469:(t,e,a)=>{a.d(e,{Bq:()=>f,Ij:()=>l,XC:()=>c,f7:()=>h,uF:()=>s});var i=a(77231),r=a(37246);const s={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],d=[i.N_,1,2,3,4,5,6,7];function c(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e){const{profile:a,sampleRate:r,channels:s}=function(t){let e=i.N_,a=i.N_,r=i.N_;var s,n;return t.length>=2&&(e=t[0]>>3&31,a=null!==(s=o[(7&t[0])<<1|t[1]>>7])&&void 0!==s?s:48e3,r=null!==(n=d[t[1]>>3&15])&&void 0!==n?n:2),{profile:e,sampleRate:a,channels:r}}(e);t.codecpar.profile=a,t.codecpar.sampleRate=r,t.codecpar.chLayout.nbChannels=s}}function l(t){const e=n[t.sampleRate],a=t.chLayout.nbChannels,i=new Uint8Array(2);return i[0]=(31&t.profile)<<3|(14&e)>>1,i[1]=(1&e)<<7|(15&a)<<3,i}function f(t){if(t.length<7)return-1;const e=t[0]<<4|t[1]>>4;if(4095!==e)return-1;const a=1&t[1],i=(192&t[2])>>>6,r=(60&t[2])>>>2,s=(1&t[2])<<2|(192&t[3])>>>6,n=(3&t[3])<<11|t[4]<<3|(224&t[5])>>>5,c=3&t[6];let l=1===a?7:9,f=n-l;return{syncWord:e,profile:i+1,sampleRate:o[r],channels:d[s],aacFrameLength:n,numberOfRawDataBlocksInFrame:c,headerLength:l,framePayloadLength:f}}function h(t,e){function a(){const t=e.readU(2);let a=0;for(let i=0;i<=t;i++)a<<=8,a|=e.readU(8);return a}e||(e=new r.A).appendBuffer(t);const i=e.getPointer(),s={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=e.readU(11);if(695!==n)return-1;s.syncWord=n,s.muxLengthBytes=e.readU(13);const c=1===e.readU1();if(s.useSameStreamMux=c,!c){const t=1===e.readU1();if(t&&1===e.readU1())return-1;if(t&&a(),1!==e.readU1())return-1;if(0!==e.readU(6))return-1;if(0!==e.readU(4))return-1;if(0!==e.readU(3))return-1;let i=t?a():0;const r=e.readU(5);i-=5;const n=e.readU(4);i-=4;const c=e.readU(4);if(i-=4,e.readU(3),i-=3,i>0&&e.readU(i),0!==e.readU(3))return-1;if(e.readU(8),1===e.readU1())if(t)a();else{let t=0;for(;;){t<<=8;const a=1===e.readU1();if(t+=e.readU(8),!a)break}}1===e.readU1()&&e.readU(8),s.profile=r+1,s.sampleRate=o[n],s.channels=d[c]}let l=0;for(;;){const t=e.readU(8);if(l+=t,255!==t)break}return s.framePayloadLength=l,s.headerLength=e.getPointer()-i+(8===e.getBitLeft()?0:1),s}},87771:(t,e,a)=>{a.d(e,{R:()=>p,j:()=>r});var i=a(37246);const r=[3,4,3,7,259,263,1539,1543],s=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],o=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],f=[1,2,3,6],h=7;function p(t){const e=new i.A(t.length);e.appendBuffer(t);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=e.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&e.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=e.readU(16),a.srCode=e.readU(2),3===a.srCode)return-3;const t=e.readU(6);if(t>37)return-4;a.ac3BitrateCode=t>>1,e.readU(5),a.bitstreamMode=e.readU(3),a.channelMode=e.readU(3),2==a.channelMode?a.dolbySurroundMode=e.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=n[e.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=o[e.readU(2)])),a.lfeOn=e.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=d[a.srCode]>>a.srShift,a.bitrate=1e3*c[a.ac3BitrateCode]>>a.srShift,a.channels=l[a.channelMode]+a.lfeOn,a.frameSize=2*s[t][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=e.readU(2),3==a.frameType)return-5;if(a.substreamId=e.readU(3),a.frameSize=e.readU(11)+1<<1,a.frameSize<h)return-6;if(a.srCode=e.readU(2),3==a.srCode){const t=e.readU(2);if(3==t)return-7;a.sampleRate=d[t]/2,a.srShift=1}else a.numBlocks=f[e.readU(2)],a.sampleRate=d[a.srCode],a.srShift=0;a.channelMode=e.readU(3),a.lfeOn=e.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=l[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},90412:(t,e,a)=>{a.d(e,{Ui:()=>n,XC:()=>s,zk:()=>r});var i=a(37246);const r={0:"Main",1:"High",2:"Professional"};function s(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=4){const a=n(e);t.codecpar.profile=a.profile,t.codecpar.level=a.level}}function n(t){const e=new i.A(t.length);e.appendBuffer(t),e.readU1(),e.readU(7);const a=e.readU(3),r=e.readU(5),s=e.readU1();let n=e.readU1()?10:8;return e.readU1()&&(n=12),{profile:a,level:r,tier:s,bitDepth:n,monochrome:e.readU1(),chromaSubsamplingX:e.readU1(),chromaSubsamplingY:e.readU1(),chromaSamplePosition:e.readU(2)}}},20620:(t,e,a)=>{a.d(e,{Jk:()=>A,KD:()=>x,MB:()=>b,S1:()=>v,XC:()=>I,ci:()=>y,oT:()=>k,tZ:()=>U,wf:()=>P});var i=a(63939),r=a(50932),s=a(72739),n=a(729),o=a(31865),d=a(37246),c=a(4624),l=a(14686),f=a(71517),h=a(60264),p=a(37837),u=a(23991),g=a(39381),m="src/avformat/codecs/h264.ts";const w=3,U={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"};function b(t){const e=new o.A(t);e.skip(5);const a=[],i=[],r=[],s=31&e.readUint8();for(let t=0;t<s;t++){const t=e.readUint16();a.push(e.readBuffer(t))}const n=e.readUint8();for(let t=0;t<n;t++){const t=e.readUint16();i.push(e.readBuffer(t))}if(e.remainingSize()>4){e.skip(3);const t=e.readUint8();if(t>0)for(let a=0;a<t;a++){const t=e.readUint16();r.push(e.readBuffer(t))}}return{spss:a,ppss:i,spsExts:r}}function z(t,e,a=[]){t.length>32&&(c.R8(`h264 metadata's sps max length is 32, but get ${t.length}`,m,210),t=t.slice(0,32)),t.length>256&&(c.R8(`h264 metadata's pps max length is 256, but get ${t.length}`,m,214),t=t.slice(0,256));let i=7;i=t.reduce(((t,e)=>t+2+e.length),i),i=e.reduce(((t,e)=>t+2+e.length),i);const r=t[0],o=P(r);66!==o.profile&&77!==o.profile&&88!==o.profile&&(i+=4,a.length&&(i=a.reduce(((t,e)=>t+2+e.length),i)));const d=new Uint8Array(i),l=new n.A(d);return l.writeUint8(1),l.writeUint8(r[1]),l.writeUint8(r[2]),l.writeUint8(r[3]),l.writeUint8(252|w),l.writeUint8(224|31&t.length),s.__(t,(t=>{l.writeUint16(t.length),l.writeBuffer(t)})),l.writeUint8(e.length),s.__(e,(t=>{l.writeUint16(t.length),l.writeBuffer(t)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(l.writeUint8(252|o.chromaFormatIdc),l.writeUint8(248|o.bitDepthLumaMinus8),l.writeUint8(248|o.bitDepthChromaMinus8),a.length&&s.__(a,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),d}function v(t){let e=(0,h.py)(t);if(e.length>1){const t=[],a=[],i=[];if(e.forEach((e=>{const r=31&e[0];7===r?t.push(e):8===r?a.push(e):13===r&&i.push(e)})),t.length&&a.length)return z(t,a,i)}}function k(t){let e,a=(0,h.py)(t),i=!1;if(a.length>1){const t=[],i=[],r=[];a.forEach((e=>{const a=31&e[0];7===a?t.push(e):8===a?i.push(e):13===a&&r.push(e)})),t.length&&i.length&&(e=z(t,i,r)),a=a.filter((t=>{const e=31&t[0];return 9!==e&&8!==e&&7!==e&&13!==e}))}const r=a.reduce(((t,e)=>t+w+1+e.length),0),o=(0,p.sY)(r),d=(0,l.s3)(o,r),c=new n.A(d);return s.__(a,(t=>{3===w?c.writeUint32(t.length):2===w?c.writeUint24(t.length):1===w?c.writeUint16(t.length):c.writeUint8(t.length),c.writeBuffer(t.subarray(0)),5==(31&t[0])&&(i=!0)})),{bufferPointer:o,length:r,key:i,extradata:e}}function A(t,e){var a;if(!(1&i.f[15](t+36)))return;const r=(0,f.iI)(t);if((0,h.Bs)(r))return;const s=null!==(a=e.metadata.naluLengthSizeMinusOne)&&void 0!==a?a:w;let n=[],d=[],c=[],u=[];const g=new o.A(r);for(;g.remainingSize()>0;){let t=0;t=3===s?g.readUint32():2===s?g.readUint24():1===s?g.readUint16():g.readUint8();const e=r.subarray(Number(BigInt.asIntN(32,g.getPos())),Number(BigInt.asIntN(32,g.getPos()))+t);g.skip(t);const a=31&e[0];7===a?n.push(e):8===a?d.push(e):13===a?c.push(e):u.push(e)}if(n.length||d.length){const e=z(n,d,c),a=(0,p.sY)(e.length);(0,l.lW)(a,e.length,e),(0,f.Ow)(t,1,a,e.length)}}function y(t,e=!1){if(!(1&i.f[15](t+36)||e))return;const a=(0,f.iI)(t);if(!(0,h.Bs)(a))return;let s=(0,h.py)(a);if(s.length>1){const e=[],a=[],n=[];if(s.forEach((t=>{const i=31&t[0];7===i?e.push(t):8===i?a.push(t):13===i&&n.push(t)})),e.length&&a.length){const s=z(e,a,n),o=(0,p.sY)(s.length);(0,l.lW)(o,s.length,s),(0,f.Ow)(t,1,o,s.length),r.M[15](t+36,1|i.f[15](t+36))}}}function I(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[4];const{spss:a}=b(e);if(a.length){const{profile:e,level:i,width:r,height:s}=P(a[0]);t.codecpar.profile=e,t.codecpar.level=i,t.codecpar.width=r,t.codecpar.height=s}}}function x(t,e=4){if(2===i.f[15](t+80))return(0,h.py)((0,l.s3)(i.f[20](t+24),i.f[15](t+28))).some((t=>5==(31&t[0])));{const a=i.f[15](t+28);let r=0;for(;r<a-e;){if(5==(31&g.r8(i.f[20](t+24)+(r+e))))return!0;r+=4===e?g.Sg(i.f[20](t+24)+r):3===e?g.ht(i.f[20](t+24)+r):2===e?g.yd(i.f[20](t+24)+r):g.r8(i.f[20](t+24)+r),r+=e}return!1}}function P(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const a=(0,h.BN)(t.subarray(e)),i=new d.A(a.length);i.appendBuffer(a),i.readU1(),i.readU(2),i.readU(5);const r=i.readU(8);i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU(2);const s=i.readU(8);u.xb(i);let n=1,o=0,c=0;if((100==r||110==r||122==r||244==r||44==r||83==r||86==r||118==r||128==r||138==r||139==r||134==r||135==r)&&(n=u.xb(i),3===n&&i.readU1(),o=u.xb(i),c=u.xb(i),i.readU1(),i.readU1())){const t=new Array(8);for(let e=0;e<(3!=n?8:12);e++)t[e]=i.readU1()}const l=u.xb(i),f=u.xb(i);let p=0,g=0;if(0===f)p=u.xb(i);else if(1===f){g=i.readU1(),u.$x(i),u.$x(i);const t=u.xb(i);for(let e=0;e<t;e++)u.$x(i)}u.xb(i),i.readU1();const m=u.xb(i),w=u.xb(i),U=i.readU1();let b=16*(m+1),z=(2-U)*(w+1)*16;U||i.readU1(),i.readU1();const v=i.readU1();if(v){let t=1,e=2-v;1===n?(t=2,e=2*(2-v)):2===v&&(t=2,e=2-v),b-=t*(u.xb(i)+u.xb(i)),z-=e*(u.xb(i)+u.xb(i))}return{profile:r,level:s,width:b,height:z,chromaFormatIdc:n,bitDepthLumaMinus8:o,bitDepthChromaMinus8:c,frameMbsOnlyFlag:U,picOrderCntType:f,log2MaxPicOrderCntLsbMinus4:p,deltaPicOrderAlwaysZeroFlag:g,log2MaxFrameNumMinus4:l}}},53e3:(t,e,a)=>{a.d(e,{HL:()=>w,Jk:()=>v,KD:()=>y,S1:()=>b,XC:()=>A,ZU:()=>x,ci:()=>k,dT:()=>g,oT:()=>z,wf:()=>I});var i=a(63939),r=a(50932),s=a(72739),n=a(729),o=a(31865),d=a(37246),c=a(14686),l=a(60264),f=a(71517),h=a(37837),p=a(23991),u=a(39381);const g={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},m=3;function w(t){const e=new o.A(t,!0);e.skip(22);let a=[],i=[],r=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=63&e.readUint8(),s=e.readUint16(),n=[];for(let t=0;t<s;t++){const t=e.readUint16();n.push(e.readBuffer(t))}32===t?a=n:33===t?i=n:34===t&&(r=n)}return{vpss:a,spss:i,ppss:r}}function U(t,e,a){const i=e[0];let r=23;t.length&&(r+=3,r=t.reduce(((t,e)=>t+2+e.length),r)),e.length&&(r+=3,r=e.reduce(((t,e)=>t+2+e.length),r)),a.length&&(r+=3,r=a.reduce(((t,e)=>t+2+e.length),r));const o=new Uint8Array(r),d=new n.A(o,!0),c=I(i);d.writeUint8(1),d.writeUint8(i[1]),d.writeUint8(i[2]),d.writeUint8(i[3]),d.writeUint8(i[4]),d.writeUint8(i[5]),d.writeUint8(i[6]),d.writeUint8(i[7]),d.writeUint8(i[8]),d.writeUint8(i[9]),d.writeUint8(i[10]),d.writeUint8(i[11]),d.writeUint8(c.level),d.writeUint8(1020),d.writeUint8(0),d.writeUint8(16320),d.writeUint8(16320|c.chroma_format_idc),d.writeUint8(8160|c.bit_depth_luma_minus8),d.writeUint8(8160|c.bit_depth_chroma_minus8),d.writeUint16(0),d.writeUint8(8|(1&i[0])<<2|m);let l=0;return t.length&&l++,e.length&&l++,a.length&&l++,d.writeUint8(l),t.length&&(d.writeUint8(160),d.writeUint16(t.length),s.__(t,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),e.length&&(d.writeUint8(161),d.writeUint16(e.length),s.__(e,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),a.length&&(d.writeUint8(162),d.writeUint16(a.length),s.__(a,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),o}function b(t){let e=(0,l.py)(t);if(e.length>=2){const t=[],a=[],i=[];if(e.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?a.push(e):34===r&&i.push(e)})),a.length&&i.length)return U(t,a,i)}}function z(t){let e,a=!1,i=(0,l.py)(t);if(i.length>=2){const t=[],a=[],r=[];i.forEach((e=>{const i=e[0]>>>1&63;32===i?t.push(e):33===i?a.push(e):34===i&&r.push(e)})),a.length&&r.length&&(e=U(t,a,r),i=i.filter((t=>{const e=t[0]>>>1&63;return 32!==e&&33!==e&&34!==e&&35!==e})))}const r=i.reduce(((t,e)=>t+m+1+e.length),0),o=(0,h.sY)(r),d=(0,c.s3)(o,r),f=new n.A(d);return s.__(i,(t=>{3===m?f.writeUint32(t.length):2===m?f.writeUint24(t.length):1===m?f.writeUint16(t.length):f.writeUint8(t.length),f.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;19!==e&&20!==e&&21!==e||(a=!0)})),{bufferPointer:o,length:r,extradata:e,key:a}}function v(t,e){var a;if(!(1&i.f[15](t+36)))return;const r=(0,f.iI)(t);if((0,l.Bs)(r))return;const s=null!==(a=e.metadata.naluLengthSizeMinusOne)&&void 0!==a?a:m;let n=[],d=[],p=[];const u=new o.A(r);for(;u.remainingSize()>0;){let t=0;t=3===s?u.readUint32():2===s?u.readUint24():1===s?u.readUint16():u.readUint8();const e=r.subarray(Number(BigInt.asIntN(32,u.getPos())),Number(BigInt.asIntN(32,u.getPos()))+t);u.skip(t);const a=e[0]>>>1&63;33===a?d.push(e):34===a?p.push(e):32===a&&n.push(e)}if(d.length||p.length||n.length){const e=U(n,d,p),a=(0,h.sY)(e.length);(0,c.lW)(a,e.length,e),(0,f.Ow)(t,1,a,e.length)}}function k(t,e=!1){if(!(1&i.f[15](t+36)||e))return;const a=(0,f.iI)(t);if(!(0,l.Bs)(a))return;let s=(0,l.py)(a);if(s.length>2){const e=[],a=[],n=[];if(s.forEach((t=>{const i=t[0]>>>1&63;32===i?e.push(t):33===i?a.push(t):34===i&&n.push(t)})),e.length&&a.length&&n.length){const s=U(e,a,n),o=(0,h.sY)(s.length);(0,c.lW)(o,s.length,s),(0,f.Ow)(t,1,o,s.length),r.M[15](t+36,1|i.f[15](t+36))}}}function A(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[21];const{spss:a}=w(e);if(a.length){const{profile:e,level:i,width:r,height:s}=I(a[0]);t.codecpar.profile=e,t.codecpar.level=i,t.codecpar.width=r,t.codecpar.height=s}}}function y(t,e=4){if(2===i.f[15](t+80))return(0,l.py)((0,c.s3)(i.f[20](t+24),i.f[15](t+28))).some((t=>{const e=t[0]>>>1&63;return 20===e||19===e}));{const a=i.f[15](t+28);let r=0;for(;r<a-e;){const a=u.r8(i.f[20](t+24)+(r+e))>>>1&63;if(20===a||19===a)return!0;r+=4===e?u.Sg(i.f[20](t+24)+r):3===e?u.ht(i.f[20](t+24)+r):2===e?u.yd(i.f[20](t+24)+r):u.r8(i.f[20](t+24)+r),r+=e}return!1}}function I(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let a=0,i=0,r=0,s=0,n=0,o=0,c=1,f=0,h=0,u=0,g=0;const m=(0,l.BN)(t.subarray(e)),w=new d.A(m.length);w.appendBuffer(m),w.readU1(),w.readU(6),w.readU(6),w.readU(3),w.readU(4);const U=w.readU(3);w.readU1();let b=0;if(U<=6){f=w.readU(2),h=w.readU1(),a=w.readU(5),u=w.readU(32),g=w.readU(48),i=w.readU(8);const t=new Array(6),e=new Array(6);for(let a=0;a<U;a++)t[a]=w.readU1(),e[a]=w.readU1();if(U>0)for(let t=U;t<8;t++)w.readU(2);for(let a=0;a<U;a++)t[a]&&(w.readU(2),w.readU(1),w.readU(5),w.readU(32),w.readU(1),w.readU(1),w.readU(1),w.readU(1),w.readU(44)),e[a]&&w.readU(8);p.xb(w),c=p.xb(w),3===c&&(b=w.readU(1)),r=p.xb(w),s=p.xb(w);let d=0,l=0,m=0,z=0;w.readU1()&&(d=p.xb(w),l=p.xb(w),m=p.xb(w),z=p.xb(w)),n=p.xb(w),o=p.xb(w);let v=2,k=2;0===c?v=k=0:2===c?(v=2,k=1):3===c&&(v=k=1),r-=v*(1<<n+1)*(d+l),s-=k*(1<<n+1)*(m+z)}const z=p.xb(w)+4;for(let t=w.readU1()?0:U;t<U+1;t++)p.xb(w),p.xb(w),p.xb(w);const v=p.xb(w)+3,k=p.xb(w),A=p.xb(w)+2,y=p.xb(w),I=v+k,x=v-1,P=r+(1<<I)-1>>I,B=s+(1<<I)-1>>I;return{profile:a,level:i,width:r,height:s,chroma_format_idc:c,bit_depth_luma_minus8:n,bit_depth_chroma_minus8:o,general_profile_space:f,general_tier_flag:h,general_profile_compatibility_flags:u,constraint_flags:g,separate_colour_plane_flag:b,log2_min_cb_size:v,log2_diff_max_min_coding_block_size:k,log2_min_tb_size:A,log2_diff_max_min_transform_block_size:y,log2_max_trafo_size:y+A,log2_ctb_size:I,log2_min_pu_size:x,ctb_width:P,ctb_height:B,ctb_size:P*B,min_cb_width:r>>v,min_cb_height:s>>v,min_tb_width:r>>A,min_tb_height:s>>A,min_pu_width:r>>x,min_pu_height:s>>x,log2_max_poc_lsb:z}}function x(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const a=(0,l.BN)(t.subarray(e)),i=new d.A(a.length);return i.appendBuffer(a),{pps_pic_parameter_set_id:p.xb(i),pps_seq_parameter_set_id:p.xb(i),dependent_slice_segment_flag:i.readU1(),output_flag_present_flag:i.readU1(),num_extra_slice_header_bits:i.readU(3)}}},65451:(t,e,a)=>{a.d(e,{Ij:()=>c,XC:()=>d,kt:()=>o});var i=a(31865),r=a(729),s=a(44328);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(t){let e=0,a=0,i=0;if(t.length<1)return 0;switch(e=t[0],a=n[e>>3],3&e){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(t.length<2)return 0;i=63&t[1]}return i*a}function d(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=19){const a=new i.A(e,!1);a.skip(9),t.codecpar.chLayout.nbChannels=a.readUint8(),t.codecpar.initialPadding=a.readUint16(),t.codecpar.sampleRate=a.readUint32(),t.codecpar.seekPreroll=Number((0,s.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function c(t){const e=new Uint8Array(19),a=new r.A(e,!1);return a.writeString("OpusHead"),a.writeUint8(1),a.writeUint8(t.chLayout.nbChannels),a.writeUint16(t.initialPadding),a.writeUint32(t.sampleRate),e}},58919:(t,e,a)=>{a.d(e,{Ui:()=>n,XC:()=>s,wN:()=>r});var i=a(37246);const r={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function s(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){const a=n(e);t.codecpar.profile=a.profile,t.codecpar.level=a.level}}function n(t){const e=new i.A(t.length);return e.appendBuffer(t),{profile:e.readU(8),level:e.readU(8),bitDepth:e.readU(4),chromaSubsampling:e.readU(3),fullRangeFlag:e.readU1(),colorPrimaries:e.readU(8),colorTrc:e.readU(8),colorSpace:e.readU(8)}}},55611:(t,e,a)=>{a.d(e,{Jk:()=>z,KD:()=>y,QA:()=>k,Ui:()=>x,XC:()=>A,ci:()=>v,oT:()=>b,wf:()=>I});var i=a(63939),r=a(50932),s=a(72739),n=a(729),o=a(31865),d=a(37246),c=a(14686),l=a(60264),f=a(71517),h=a(37837),p=a(23991),u=a(83314),g=a(39381);const m=3;function w(t){const e=t.readU(9),a=t.readU(3),i=t.readU(2),r=t.readU(2),s=t.readU(3);t.readU(5),t.readU(2);const n=t.readU(6),o=t.readU(7),d=t.readU(1),c=t.readU(8),l=t.readU(1),f=t.readU(1),h=[],p=[];if(n){for(let e=0;e<n-1;e++)h[e]=t.readU(8);h[n-1]=t.readU(6)}else t.readU(6);if(a>1){let e=0;for(let i=a-2;i>=0;--i)e|=t.readU(1)<<i;for(let e=a;e<=8&&a>1;++e)t.readU(1);for(let i=a-2;i>=0;--i)e&1<<i&&(p[i]=t.readU(8))}const u=t.readU(8),g=[];if(u)for(let e=0;e<u;e++)g.push(t.readU(8));return{olsIdx:e,numSublayers:a,bitDepthMinus8:s,chromaFormatIdc:r,constantFrameRate:i,generalProfileIdc:o,generalTierFlag:d,generalLevelIdc:c,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:f,generalConstraintInfo:h,sublayerLevelIdc:p,generalSubProfileIdc:g,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function U(t,e,a){const i=e[0];let r;if(i){const t=I(i);let e=t.generalConstraintInfo;e.length||(e=new Array(12).fill(0));const a=new u.A;if(a.writeU(9,0),a.writeU(3,t.spsMaxSublayersMinus1+1),a.writeU(2,1),a.writeU(2,t.chromaFormatIdc),a.writeU(3,t.bitDepthMinus8),a.writeU(5,31),a.writeU(2,0),a.writeU(6,e.length),a.writeU(7,t.profile),a.writeU1(t.tierFlag),a.writeU(8,t.level),a.writeU1(t.ptlFrameOnlyConstraintFlag),a.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)a.writeU(8,e[t]);a.writeU(6,e[e.length-1])}else a.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let a=t.spsMaxSublayersMinus1-1;a>=0;a--)e=e<<1|t.ptlSublayerLevelPresentFlag[a];a.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)a.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&a.writeU(8,t.sublayerLevelIdc[e])}a.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)a.writeU(8,t.sublayerLevelIdc[e]);a.writeU(16,t.width),a.writeU(16,t.height),a.writeU(16,0),a.padding(),r=a.getBuffer().subarray(0,a.getPointer())}let o=2+(r?r.length:0);t.length&&(o+=3,o=t.reduce(((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=e.reduce(((t,e)=>t+2+e.length),o)),a.length&&(o+=3,o=a.reduce(((t,e)=>t+2+e.length),o));const d=new Uint8Array(o),c=new n.A(d,!0);c.writeUint8(m<<1|(r?1:0)|248),r&&c.writeBuffer(r);let l=0;return t.length&&l++,e.length&&l++,a.length&&l++,c.writeUint8(l),t.length&&(c.writeUint8(142),c.writeUint16(t.length),s.__(t,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),e.length&&(c.writeUint8(143),c.writeUint16(e.length),s.__(e,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),a.length&&(c.writeUint8(144),c.writeUint16(a.length),s.__(a,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),d}function b(t){let e,a=!1,i=(0,l.py)(t);if(i.length>=2){const t=[],a=[],r=[];i.forEach((e=>{const i=e[1]>>>3&31;14===i?t.push(e):15===i?a.push(e):16===i&&r.push(e)})),a.length&&r.length&&(e=U(t,a,r),i=i.filter((t=>{const e=t[1]>>>3&31;return 14!==e&&15!==e&&16!==e&&20!==e})))}const r=i.reduce(((t,e)=>t+m+1+e.length),0),o=(0,h.sY)(r),d=(0,c.s3)(o,r),f=new n.A(d);return s.__(i,(t=>{3===m?f.writeUint32(t.length):2===m?f.writeUint24(t.length):1===m?f.writeUint16(t.length):f.writeUint8(t.length),f.writeBuffer(t.subarray(0));const e=t[1]>>>3&31;8!==e&&7!==e&&9!==e&&10!==e||(a=!0)})),{bufferPointer:o,length:r,extradata:e,key:a}}function z(t,e){var a;if(!(1&i.f[15](t+36)))return;const r=(0,f.iI)(t);if((0,l.Bs)(r))return;const s=null!==(a=e.metadata.naluLengthSizeMinusOne)&&void 0!==a?a:m;let n=[],d=[],p=[];const u=new o.A(r);for(;u.remainingSize()>0;){let t=0;t=3===s?u.readUint32():2===s?u.readUint24():1===s?u.readUint16():u.readUint8();const e=r.subarray(Number(BigInt.asIntN(32,u.getPos())),Number(BigInt.asIntN(32,u.getPos()))+t);u.skip(t);const a=e[1]>>>3&31;15===a?d.push(e):16===a?p.push(e):14===a&&n.push(e)}if(d.length||p.length||n.length){const e=U(n,d,p),a=(0,h.sY)(e.length);(0,c.lW)(a,e.length,e),(0,f.Ow)(t,1,a,e.length)}}function v(t,e=!1){if(!(1&i.f[15](t+36)||e))return;const a=(0,f.iI)(t);if(!(0,l.Bs)(a))return;let s=(0,l.py)(a);if(s.length>2){const e=[],a=[],n=[];if(s.forEach((t=>{const i=t[1]>>>3&31;14===i?e.push(t):15===i?a.push(t):16===i&&n.push(t)})),e.length&&a.length&&n.length){const s=U(e,a,n),o=(0,h.sY)(s.length);(0,c.lW)(o,s.length,s),(0,f.Ow)(t,1,o,s.length),r.M[15](t+36,1|i.f[15](t+36))}}}function k(t,e){const{profile:a,level:i,width:r,height:s}=I(e);t.codecpar.profile=a,t.codecpar.level=i,t.codecpar.width=r,t.codecpar.height=s}function A(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:a}=function(t){const e=new o.A(t,!0);if(1&e.readUint8()){const a=new d.A;a.appendBuffer(t.subarray(1)),w(a),e.skip(a.getPointer())}let a=[],i=[],r=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=31&e.readUint8();let s=1;13!==t&&12!==t&&(s=e.readUint16());const n=[];for(let t=0;t<s;t++){const t=e.readUint16();n.push(e.readBuffer(t))}14===t?a=n:15===t?i=n:16===t&&(r=n)}return{vpss:a,spss:i,ppss:r}}(e);a.length&&k(t,a[0])}}function y(t,e=4){if(2===i.f[15](t+80))return(0,l.py)((0,c.s3)(i.f[20](t+24),i.f[15](t+28))).some((t=>{const e=t[1]>>>3&31;return 8===e||7===e}));{const a=i.f[15](t+28);let r=0;for(;r<a-e;){const a=g.r8(i.f[20](t+24)+(r+e+1))>>>3&31;if(8===a||7===a)return!0;r+=4===e?g.Sg(i.f[20](t+24)+r):3===e?g.ht(i.f[20](t+24)+r):2===e?g.yd(i.f[20](t+24)+r):g.r8(i.f[20](t+24)+r),r+=e}return!1}}function I(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let a=0,i=0,r=0,s=0,n=0,o=1,c=0,f=0,h=0;const u=[],g=[],m=[],w=[],U=(0,l.BN)(t.subarray(e)),b=new d.A(U.length);b.appendBuffer(U),b.readU1(),b.readU1(),b.readU(6),b.readU(5),b.readU(3),b.readU(8);const z=b.readU(3);o=b.readU(2);const v=b.readU(2);if(b.readU(1)){if(a=b.readU(7),c=b.readU(1),i=b.readU(8),f=b.readU(1),h=b.readU(1),b.readU(1)){for(let t=0;t<8;t++)u[t]=b.readU(8);u[8]=b.readU(7);const t=b.readU(8);b.readU(t)}b.skipPadding();for(let t=z-1;t>=0;t--)g[t]=b.readU(1);b.skipPadding();for(let t=z-1;t>=0;t--)g[t]&&(m[t]=b.readU(8));const t=b.readU(8);if(t)for(let e=0;e<t;e++)w[e]=b.readU(32)}b.readU1(),b.readU1()&&b.readU1();const k=r=p.xb(b),A=s=p.xb(b);if(b.readU1()&&(p.xb(b),p.xb(b),p.xb(b),p.xb(b)),b.readU1()){const t=p.xb(b),e=v+5,a=1<<e,i=k/(1<<e),r=A/(1<<e),s=Math.ceil(Math.log2(i)),n=Math.ceil(Math.log2(r));let o=0,d=0,c=0;t>0&&(c=b.readU1(),d=b.readU1());for(let e=0;t>0&&e<=t;e++)d&&0!=e||(e>0&&k>a&&b.readU(s),e>0&&A>a&&b.readU(n),e<t&&k>a&&b.readU(s),e<t&&A>a&&b.readU(n)),c||b.readU(2);if(o=p.xb(b)+1,b.readU(1)&&b.readU(1))for(let e=0;e<=t;e++)b.readU(o)}n=p.xb(b),b.readU(1),b.readU(1);const y=b.readU(4),I=b.readU(1);let x=0;I&&(x=p.xb(b));const P=[],B=b.readU(2);for(let t=0;t<8*B;t++)P[t]=b.readU(1);return{profile:a,level:i,width:r,height:s,chromaFormatIdc:o,bitDepthMinus8:n,generalProfileSpace:0,tierFlag:c,generalConstraintInfo:u,generalSubProfileIdc:w,ptlFrameOnlyConstraintFlag:f,ptlMultilayerEnabledFlag:h,spsMaxSublayersMinus1:z,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:m,sps_log2_max_pic_order_cnt_lsb_minus4:y,sps_poc_msb_cycle_flag:I,sps_poc_msb_cycle_len_minus1:x,sps_num_extra_ph_bytes:B,sps_extra_ph_bit_present_flag:P}}function x(t){0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(t=function(t){let e=(0,l.py)(t);if(e.length>=2){const t=[],a=[],i=[];if(e.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?a.push(e):16===r&&i.push(e)})),a.length&&i.length)return U(t,a,i)}}(t));const e=new d.A;return e.appendBuffer(t),1&e.readU(8)?w(e):{}}},85947:(t,e,a)=>{a.d(e,{A:()=>r});var i=a(134);class r{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}destroy(t){}}},92047:(t,e,a)=>{a.r(e),a.d(e,{default:()=>v});var i=a(134),r=a(63939),s=a(50932),n=a(4624),o=a(9705),d=a(65977),c=a(74963),l=a(85947),f=a(85428),h=a(9690),p=a(72739),u=a(14686),g=a(37837),m=a(71517),w=a(44328),U=a(77231),b=a(39381),z="src/avformat/formats/IMovFormat.ts";class v extends l.A{constructor(t={}){super(),(0,i.A)(this,"type",1),(0,i.A)(this,"context",void 0),(0,i.A)(this,"options",void 0),this.options=t,this.context=(0,h.A)()}init(t){t.ioReader&&t.ioReader.setEndian(!0)}async readHeader(t){try{const e=await t.ioReader.fileSize();let a=0,i=await t.ioReader.readUint32(),r=await t.ioReader.readUint32();r===(0,d.A)("ftyp")?await c.E6(t.ioReader,this.context,{type:r,size:i-8}):(!e||i<e)&&await t.ioReader.skip(i-8);let s=BigInt(0);for(;!this.context.foundMoov;){const a=t.ioReader.getPos();if(a===e)return n.z3("the file format is not mp4",z,100),o.LR;if(i=await t.ioReader.readUint32(),r=await t.ioReader.readUint32(),i<8||e&&a+BigInt(Math.floor(i))>e)return n.z3(`invalid box size ${i}`,z,108),o.LR;r===(0,d.A)("mdat")?(this.context.foundMdat||(s=a),this.context.foundMdat=!0,await t.ioReader.seek(a+BigInt(Math.floor(i)))):r===(0,d.A)("moov")?(await c.wB(t.ioReader,t,this.context,{size:i-8,type:r}),this.context.foundMoov=!0):await t.ioReader.seek(a+BigInt(Math.floor(i)))}if(!this.context.fragment&&!this.context.foundMdat){const e=await t.ioReader.peekUint64()>>BigInt(32);Number(e)===(0,d.A)("moof")&&(this.context.fragment=!0)}if(this.context.fragment&&1&t.ioReader.flags){const e=t.ioReader.getPos(),a=await t.ioReader.fileSize();if(a>BigInt(16)){await t.ioReader.seek(a-BigInt(12));let i=await t.ioReader.readUint32();if(i===(0,d.A)("mfro")){await t.ioReader.skip(4);const e=await t.ioReader.readUint32();await t.ioReader.seek(a-BigInt(Math.floor(e)));const r=await t.ioReader.readUint32();i=await t.ioReader.readUint32(),i===(0,d.A)("mfra")&&await c.t9(t.ioReader,t,this.context,{size:r-8,type:i})}await t.ioReader.seek(e)}}return!this.context.fragment&&this.context.foundMdat&&await t.ioReader.seek(s),a}catch(e){return n.z3(e.message,z,170),this.context.foundMoov||n.z3("moov not found",z,173),t.ioReader.error}}async readAVPacket_(t,e){const{sample:a,stream:i}=(0,f.G)(t,this.context);if(!a)return-1048576;{s.M[15](e+32,i.index),s.M[17](e+16,a.dts),s.M[17](e+8,a.pts),s.M[17](e+48,BigInt(Math.floor(a.duration))),s.M[15](e+36,r.f[15](e+36)|a.flags),s.M[17](e+56,a.pos),s.M[15](e+76,i.timeBase.den),s.M[15](e+72,i.timeBase.num),i.startTime===U.Dh&&(i.startTime=r.f[17](e+8)||r.f[17](e+16)),await t.ioReader.seek(r.f[17](e+56));const n=a.size,o=(0,g.sY)(n);if((0,m.NX)(e,o,n),await t.ioReader.readBuffer(n,(0,u.JW)(o,n)),27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||s.M[15](e+80,1),94226===i.codecpar.codecId&&r.f[15](e+28)>=8){const t=b.Sg(r.f[20](e+24)+4)>>>0,a=r.f[15](e+28);if(t===(0,d.A)("vtte")&&8===a){const t=(0,g.Gy)(1);(0,m.NX)(e,t,1),s.M[15](e+28,1)}if(a>8&&(t===(0,d.A)("vtte")||t===(0,d.A)("vttc"))){let t=r.f[20](e+24)+8;const i=r.f[20](e+24)+a;for(;t<i;){const a=b.Sg(t);if(b.Sg(t+4)>>>0===(0,d.A)("payl")&&a>8){const i=(0,g.sY)(a-8);(0,u.Mr)(i,t+8,a-8),(0,m.NX)(e,i,a-8);break}t+=a}}}if(i.sideData[1]){const t=i.sideData[1].length,a=(0,g.sY)(t);(0,m.Ow)(e,1,a,t),(0,u.lW)(a,t,i.sideData[1]),delete i.sideData[1]}}return 0}async readAVPacket(t,e){try{if(this.context.fragment&&!this.context.currentFragment)for(;!this.context.currentFragment;){const e=t.ioReader.getPos(),a=await t.ioReader.readUint32(),i=await t.ioReader.readUint32();i===(0,d.A)("moof")?(this.context.currentFragment={pos:e,size:a,sequence:0,tracks:[],currentTrack:null},this.context.firstMoof||(this.context.firstMoof=e),await c.wZ(t.ioReader,t,this.context,{type:i,size:a-8})):i===(0,d.A)("moov")?await c.wB(t.ioReader,t,this.context,{size:a-8,type:i}):await t.ioReader.skip(a-8)}return await this.readAVPacket_(t,e)}catch(e){return-1048576!==t.ioReader.error?(n.z3(`read packet error, ${e}`,z,306),o.LR):t.ioReader.error}}async seek(t,e,a,i){const r=a,s=e.privData,n=()=>{this.context.currentFragment=null,t.streams.forEach((t=>{t.privData.samplesIndex.length=0}))};if(16&i&&this.context.fragment){const i=(0,w.k)(a,e.timeBase,U.i0);return await t.ioReader.seek(i,!0),n(),BigInt(0)}if(this.context.fragment){if(s.fragIndexes.length){let e=p.El(s.fragIndexes,(t=>t.time>r?-1:t.time===r?0:1));if(e>-1)return await t.ioReader.seek(s.fragIndexes[e].pos,!0),n(),BigInt(0)}return r===BigInt(0)&&this.context.firstMoof?(await t.ioReader.seek(this.context.firstMoof),n(),BigInt(0)):BigInt(o.E$)}let d=p.El(s.samplesIndex,(t=>t.pts>r?-1:t.pts===r?0:1));if(d>-1&&0===e.codecpar.codecType){let t=d;for(;t>=0;t--)if(1&s.samplesIndex[t].flags){d=t;break}t<0&&(d=-1)}return d>-1?(s.currentSample=d,s.sampleEnd=!1,p.__(t.streams,(t=>{if(t!==e){const a=t.privData;let i=!1,r=(0,w.k)(s.samplesIndex[s.currentSample].pts,e.timeBase,t.timeBase);p.__(a.samplesIndex,((t,e)=>{if(t.pts>=r)return a.currentSample=e,i=!0,!1})),i?a.sampleEnd=!1:(a.sampleEnd=!0,a.currentSample=a.samplesIndex.length)}})),BigInt(0)):BigInt(o.LR)}getAnalyzeStreamsCount(){return 0}}},21071:(t,e,a)=>{a.d(e,{_l:()=>i,gQ:()=>r});const i=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],r=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco"]},61179:(t,e,a)=>{function i(t,e,a,i=0){const r=t.privData,s=a.trexs.find((t=>t.trackId===e.trackId));let n=e.baseDataOffset+BigInt(Math.floor(e.dataOffset));e.baseIsMoof&&(n+=a.currentFragment.pos);let o=e.baseMediaDecodeTime;const d=e.sampleSizes,c=e.sampleDurations,l=e.sampleFlags,f=e.sampleCompositionTimeOffset;if(!d.length)for(let t=0;t<e.sampleCount;t++)d.push(e.defaultSampleSize||s.size);if(!c.length)for(let t=0;t<e.sampleCount;t++)c.push(e.defaultSampleDuration||s.duration);if(!l.length)for(let t=0;t<e.sampleCount;t++)l.push(e.defaultSampleFlags||s.flags);if(!f.length)for(let t=0;t<e.sampleCount;t++)f.push(0);const h=[];for(let t=0;t<e.sampleCount;t++){const a={dts:o,pts:o+BigInt(Math.floor(f[t])),pos:n,size:d[t],duration:c[t],flags:0};o+=BigInt(Math.floor(a.duration)),n+=BigInt(Math.floor(a.size));let r=l[t];0===t&&e.firstSampleFlags&&(r=e.firstSampleFlags),16842752&r||(a.flags|=1),0===t&&d.length>1&&2&i&&(a.flags|=1),h.push(a)}r.samplesIndex=h}a.d(e,{p:()=>i})},98859:(t,e,a)=>{function i(t){const e=t.privData,a=e.chunkOffsets,i=e.sampleSizes,r=e.cttsSampleCounts,s=e.cttsSampleOffsets,n=e.stscFirstChunk,o=e.stscSamplesPerChunk,d=e.stssSampleNumbersMap,c=e.sttsSampleCounts,l=e.sttsSampleDeltas;if(!a.length)return;let f=0,h=0,p=0,u=0,g=0,m=0,w=BigInt(0),U=0,b=BigInt(0);const z=[];for(let e=0;e<a.length;e++)for(w=a[e],f<n.length-1&&n[f+1]===e+1&&f++,m=o[f];m>0;){const e={dts:b,pts:b,pos:w,size:i[U],duration:0,flags:0};(d&&d.has(U+1)||1===t.codecpar.codecType)&&(e.flags|=1),s&&(e.pts=e.dts+BigInt(Math.floor(s[u])),g++,g===r[u]&&(u++,g=0)),U&&(z[U-1].duration=Number(e.dts-z[U-1].dts)),w+=BigInt(Math.floor(e.size)),b+=BigInt(Math.floor(l[h])),p++,p===c[h]&&(h++,p=0),U++,z.push(e),m--}z.length>1&&(z[U-1].duration=z[U-2].duration),e.samplesIndex=z}a.d(e,{X:()=>i})},3384:(t,e,a)=>{function i(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[]}}a.d(e,{A:()=>i})},9690:(t,e,a)=>{a.d(e,{A:()=>r});var i=a(77231);function r(){return{isom:!1,timescale:i.N_,duration:i.Dh,foundMoov:!1,foundMdat:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:i.N_,volume:i.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},38106:(t,e,a)=>{a.d(e,{A:()=>r});var i=a(77231);function r(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,timescale:0,duration:BigInt(0),trackId:i.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],fragIndexes:[],lastPts:BigInt(0),lastDts:BigInt(0),startDts:BigInt(0),startCT:0,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},85428:(t,e,a)=>{a.d(e,{G:()=>s});var i=a(77231),r=a(44328);function s(t,e){let a,s,n,o,d,c,l=BigInt(0);if(t.streams.forEach((t=>{const e=t.privData;if(!e.samplesIndex||!e.samplesIndex.length)return e.sampleEnd=!0,!0;e.sampleEnd||n&&!(e.samplesIndex[e.currentSample].pos<n.pos)||(n=e.samplesIndex[e.currentSample],o=t),e.sampleEnd||d&&!((0,r.k)(e.samplesIndex[e.currentSample].dts,t.timeBase,i.KR)<l)||(d=e.samplesIndex[e.currentSample],l=(0,r.k)(d.dts,t.timeBase,i.KR),c=t)})),n&&d){const e=(0,r.k)(n.dts,o.timeBase,i.KR),l=(0,r.k)(d.dts,c.timeBase,i.KR);Math.abs(Number(e-l))<1e6||2&t.ioReader.flags?(a=n,s=o):(a=d,s=c)}else n?(a=n,s=o):d&&(a=d,s=c);if(s&&(s.privData.currentSample++,s.privData.currentSample>=s.privData.samplesIndex.length&&(s.privData.sampleEnd=!0)),e.fragment){const a=!!t.streams.find((t=>!1===t.privData.sampleEnd));a||(e.currentFragment=null)}return{sample:a,stream:s}}},74963:(t,e,a)=>{a.d(e,{E6:()=>g,t9:()=>b,wB:()=>w,wZ:()=>U});var i=a(65977),r=a(21071),s=a(68361),n=a(4624),o=a(61179),d=a(98859),c=a(3384),l=a(38106),f=a(37837),h=a(14686),p=a(77231),u="src/avformat/formats/mov/imov.ts";async function g(t,e,a){const r=t.getPos()+BigInt(Math.floor(a.size));for(e.majorBrand=await t.readUint32(),e.minorVersion=await t.readUint32(),e.majorBrand===(0,i.A)("qt  ")&&(e.isom=!0);t.getPos()<r;)e.compatibleBrand.push(await t.readUint32())}async function m(t,e,a,o){const d=t.getPos()+BigInt(Math.floor(a.size));for(;t.getPos()<d;){const a=await t.readUint32(),d=await t.readUint32();if(a<8)return void n.z3(`invalid box size ${a}`,u,76);if(s.A[d])await s.A[d](t,e,{type:d,size:a-8},o);else if(d===(0,i.A)("mdia")){let n=!1,d=BigInt(0);const c=t.getPos()+BigInt(Math.floor(a-8));for(;t.getPos()<c;){const a=await t.readUint32(),c=await t.readUint32();c===(0,i.A)("hdlr")?(await s.A[c](t,e,{type:c,size:a-8},o),n=!0):c===(0,i.A)("minf")&&n?await m(t,e,{type:c,size:a-8},o):c!==(0,i.A)("minf")||n?s.A[c]?await s.A[c](t,e,{type:c,size:a-8},o):r.gQ.some((t=>(0,i.A)(t)===c))?await m(t,e,{type:c,size:a-8},o):await t.skip(a-8):(d=t.getPos()-BigInt(8),await t.skip(a-8))}if(d){const a=t.getPos();await t.seek(d);const i=await t.readUint32(),r=await t.readUint32();await m(t,e,{type:r,size:i-8},o),await t.seek(a)}}else r.gQ.some((t=>(0,i.A)(t)===d))?await m(t,e,{type:d,size:a-8},o):await t.skip(a-8)}}async function w(t,e,a,r){const o=t.getPos()+BigInt(Math.floor(r.size));for(;t.getPos()<o;){const r=await t.readUint32(),o=await t.readUint32();if(r<8)return void n.z3(`invalid box, type: ${o}, size ${r}`,u,209);if(s.A[o])await s.A[o](t,null,{type:o,size:r-8},a);else if(o===(0,i.A)("trak"))if(!a.foundMoov||a.fragment){const i=e.createStream();if(i.privData=(0,l.A)(),await m(t,i,{type:o,size:r-8},a),a.fragment){const t=i.privData,a=e.streams.find((e=>{const a=e.privData;if(e.index!==i.index&&a.trackId===t.trackId)return!0}));a?(i.sideData[1]&&(a.sideData[1]=i.sideData[1],a.codecpar.extradata&&(0,f.Eb)(a.codecpar.extradata),a.codecpar.extradataSize=a.sideData[1].length,a.codecpar.extradata=(0,f.sY)(a.codecpar.extradataSize),(0,h.lW)(a.codecpar.extradata,a.codecpar.extradataSize,a.sideData[1]),i.codecpar.width===p.N_&&t.width>0&&(a.codecpar.width=t.width),i.codecpar.width===p.N_&&t.height>0&&(a.codecpar.height=t.height)),e.removeStream(i),e.streamIndex--):(i.codecpar.width===p.N_&&t.width>0&&(i.codecpar.width=t.width),i.codecpar.width===p.N_&&t.height>0&&(i.codecpar.height=t.height))}else(0,d.X)(i)}else await t.skip(r-8);else o===(0,i.A)("mvex")?(a.fragment=!0,await m(t,null,{type:o,size:r-8},a)):await t.skip(r-8)}}async function U(t,e,a,r){const d=t.getPos()+BigInt(Math.floor(r.size));for(;t.getPos()<d;){const r=await t.readUint32(),d=await t.readUint32();if(r<8)return void n.z3(`invalid box, type: ${d}, size ${r}`,u,314);if(s.A[d])await s.A[d](t,null,{type:d,size:r-8},a);else if(d===(0,i.A)("traf")){const i=(0,c.A)();a.currentFragment.currentTrack=i,await m(t,null,{type:d,size:r-8},a),a.currentFragment.tracks.push(i),a.currentFragment.currentTrack=null;const s=e.streams.find((t=>t.privData.trackId===i.trackId));if(s){const t=s.privData;i.streamIndex=s.index,(0,o.p)(s,i,a,e.ioReader.flags),t.currentSample=0,t.sampleEnd=!1}}else await t.skip(r-8)}}async function b(t,e,a,r){const s=t.getPos()+BigInt(Math.floor(r.size));for(;t.getPos()<s;){const r=t.getPos(),s=await t.readUint32();if(await t.readUint32()===(0,i.A)("tfra")){const r=await t.readUint8();await t.skip(3);const s=await t.readUint32(),n=await t.readUint32(),o=await t.readUint32(),d=e.streams.find((t=>t.privData.trackId===s));if(d){const s=d.privData;let c,l;for(let e=0;e<o;e++){1===r?(c=await t.readUint64(),l=await t.readUint64()):(c=BigInt(Math.floor(await t.readUint32())),l=BigInt(Math.floor(await t.readUint32()))),s.fragIndexes.push({pos:l,time:c});for(let e=0;e<1+(n>>4&3);e++)await t.skip(1);for(let e=0;e<1+(n>>2&3);e++)await t.skip(1);for(let e=0;e<1+(3&n);e++)await t.skip(1)}if(s.fragIndexes.length){await t.seek(s.fragIndexes[s.fragIndexes.length-1].pos);const r=await t.readUint32(),n=await t.readUint32();if(n===(0,i.A)("moof")&&(a.currentFragment={pos:BigInt(0),size:r,sequence:0,tracks:[],currentTrack:null},await U(t,e,a,{size:r,type:n}),s.samplesIndex.length)){const t=s.samplesIndex[s.samplesIndex.length-1];d.duration=t.pts+BigInt(Math.floor(t.duration)),s.samplesIndex.length=0}}}}await t.seek(r+BigInt(Math.floor(s)),!1,!1)}a.currentFragment=null}},6660:(t,e,a)=>{a.d(e,{Q9:()=>s,f3:()=>n,uf:()=>o,zs:()=>r});var i=a(65977);const r={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},s={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},n={vide:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,i.A)("mp4a")]:86018,1836253269:86017,[(0,i.A)("Opus")]:86076,[(0,i.A)("fLaC")]:86028,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[i.A.mp4v]:12,[(0,i.A)("av01")]:225,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("avc1")]:27,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213}},38582:(t,e,a)=>{a.d(e,{A:()=>d});var i=a(4624),r=a(14686),s=a(37837),n=a(90412),o="src/avformat/formats/mov/parsing/av1c.ts";async function d(t,e,a,d){const c=t.getPos();if(e.codecpar.codecId=225,a.size<=0)return;const l=(0,s.sY)(a.size),f=await t.readBuffer(a.size,(0,r.JW)(l,a.size));d.foundMoov?(e.sideData[1]=f.slice(),(0,s.Eb)(l)):(e.codecpar.extradata=l,e.codecpar.extradataSize=a.size,e.sideData[1]=f.slice()),n.XC(e,e.sideData[1]);const h=a.size-Number(t.getPos()-c);h>0?await t.skip(h):h<0&&i.z3(`read avcc error, size: ${a.size}, read: ${a.size-h}`,o,67)}},73840:(t,e,a)=>{a.d(e,{A:()=>d});var i=a(37837),r=a(14686),s=a(4624),n=a(20620),o="src/avformat/formats/mov/parsing/avcc.ts";async function d(t,e,a,d){const c=t.getPos();if(e.codecpar.codecId=27,a.size<=0)return;const l=(0,i.sY)(a.size),f=await t.readBuffer(a.size,(0,r.JW)(l,a.size));d.foundMoov?(e.sideData[1]=f.slice(),(0,i.Eb)(l)):(e.codecpar.extradata=l,e.codecpar.extradataSize=a.size,e.sideData[1]=f.slice()),n.XC(e,e.sideData[1]);const h=a.size-Number(t.getPos()-c);h>0?await t.skip(h):h<0&&s.z3(`read avcc error, size: ${a.size}, read: ${a.size-h}`,o,67)}},37213:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/co64.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[],c=await t.readUint32();if(0===o)for(let e=0;e<c;e++)d.push(await t.readUint64());e.privData.chunkOffsets=d;const l=a.size-Number(t.getPos()-n);l>0?await t.skip(l):l<0&&i.z3(`read co64 error, size: ${a.size}, read: ${a.size-l}`,r,56)}},12869:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/colr.ts";async function s(t,e,a,s){const n=t.getPos();let o=await t.readString(4);if("nclx"===o||"nclc"===o||"prof"===o)if("prof"===o){const i=await t.readBuffer(a.size-4);e.sideData[28]=i}else{let a=await t.readUint16(),i=await t.readUint16(),r=await t.readUint16();if("nclx"===o){const a=await t.readUint8()>>7;e.codecpar.colorRange=a?2:1}a>=23&&(a=2),i>=19&&(i=2),r>=15&&(r=2),e.codecpar.colorPrimaries=a,e.codecpar.colorTrc=i,e.codecpar.colorSpace=r}else i.R8(`unsupported color_parameter_type: ${o}`,r,79);const d=a.size-Number(t.getPos()-n);d>0?await t.skip(d):d<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-d}`,r,87)}},59299:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/ctts.ts";async function s(t,e,a,s){const n=t.getPos(),o=e.privData;await t.skip(4);const d=[],c=[],l=await t.readUint32();for(let e=0;e<l;e++)d.push(await t.readUint32()),c.push(await t.readInt32());o.cttsSampleCounts=d,o.cttsSampleOffsets=c;const f=a.size-Number(t.getPos()-n);f>0?await t.skip(f):f<0&&i.z3(`read ctts error, size: ${a.size}, read: ${a.size-f}`,r,59)}},7320:(t,e,a)=>{a.d(e,{A:()=>f});var i=a(61499),r=a(63939),s=a(50932),n=a(4624),o=a(71517),d=a(87771),c=a(99991),l="src/avformat/formats/mov/parsing/dac3.ts";async function f(t,e,a,f){const h=t.getPos();if(e.codecpar.codecId=86019,a.size<=0)return;const p=(0,o.E4)(e.codecpar[i.o9]+20,e.codecpar[i.o9]+24,7,4),u=r.f[20](p),g=await t.readUint24(),m=g>>14&7,w=g>>11&7,U=g>>10&1;let b=d.j[w];U&&(b|=8),c.bl(e.codecpar[i.o9]+112),c.ML(e.codecpar[i.o9]+112,b),s.M[15](u,m);const z=a.size-Number(t.getPos()-h);z>0?await t.skip(z):z<0&&n.z3(`read avcc error, size: ${a.size}, read: ${a.size-z}`,l,77)}},36868:(t,e,a)=>{a.d(e,{A:()=>f});var i=a(61499),r=a(63939),s=a(50932),n=a(4624),o=a(71517),d=a(87771),c=a(99991),l="src/avformat/formats/mov/parsing/dec3.ts";async function f(t,e,a,f){const h=t.getPos();if(e.codecpar.codecId=86056,a.size<=0)return;const p=(0,o.E4)(e.codecpar[i.o9]+20,e.codecpar[i.o9]+24,7,4),u=r.f[20](p);await t.skip(2);const g=await t.readUint24(),m=g>>12&31,w=g>>9&7,U=g>>8&1;let b=d.j[w];U&&(b|=8),c.bl(e.codecpar[i.o9]+112),c.ML(e.codecpar[i.o9]+112,b),s.M[15](u,m),e.codecpar.chLayout.nbChannels>1&&7==m&&s.M[15](u,8);const z=a.size-Number(t.getPos()-h);z>0?await t.skip(z):z<0&&n.z3(`read avcc error, size: ${a.size}, read: ${a.size-z}`,l,82)}},86528:(t,e,a)=>{a.d(e,{A:()=>o});var i=a(4624),r=a(37837),s=a(14686),n="src/avformat/formats/mov/parsing/dfla.ts";async function o(t,e,a,o){const d=t.getPos();e.codecpar.codecId=86028,await t.skip(1),await t.skip(3);const c=await t.readUint8(),l=128&c,f=127&c,h=await t.readUint24();if(0===f&&34===h){const a=(0,r.sY)(h),i=await t.readBuffer(h,(0,s.JW)(a,h));o.foundMoov?(e.sideData[1]=i.slice(),(0,r.Eb)(a)):(e.codecpar.extradata=a,e.codecpar.extradataSize=h)}else i.z3("streaminfo must be first FLACMetadataBlock",n,67);l||i.R8("non streaminfo FLACMetadataBlock(s) ignored",n,71);const p=a.size-Number(t.getPos()-d);p>0?await t.skip(p):p<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-p}`,n,79)}},41781:(t,e,a)=>{a.d(e,{A:()=>l});var i=a(4624),r=a(37837),s=a(14686),n=a(65451),o=a(31865),d=a(729),c="src/avformat/formats/mov/parsing/dops.ts";async function l(t,e,a,l){const f=t.getPos();e.codecpar.codecId=86076,await t.skip(1);const h=(0,r.sY)(a.size+8),p=(0,s.JW)(h,a.size+8),u=new o.A(p),g=new d.A(p,!1);g.writeString("OpusHead"),g.writeUint8(1),await t.readBuffer(a.size-1,(0,s.JW)(h+9,a.size-1)),u.seek(10),g.seek(10),g.writeUint16(u.readUint16()),g.writeUint32(u.readUint32()),g.writeUint16(u.readUint16()),l.foundMoov?(e.sideData[1]=p.slice(),(0,r.Eb)(h)):(e.codecpar.extradata=h,e.codecpar.extradataSize=p.length,n.XC(e,p.slice()));const m=a.size-Number(t.getPos()-f);m>0?await t.skip(m):m<0&&i.z3(`read dops error, size: ${a.size}, read: ${a.size-m}`,c,81)}},28412:(t,e,a)=>{a.d(e,{A:()=>f});var i=a(4624),r=a(6660),s=a(37837),n=a(14686),o=a(58469),d=a(65451),c="src/avformat/formats/mov/parsing/esds.ts";async function l(t){let e=0;for(let a=0;a<4;a++){const a=await t.readUint8();if(e=e<<7|127&a,!(128&a))break}return e}async function f(t,e,a,f){const h=t.getPos();await t.skip(4);let p=t.getPos()+BigInt(Math.floor(a.size-4));for(;t.getPos()<p;){let a=await t.readUint8(),h=await l(t);if(0!==h)if(3===a){let p=t.getPos()+BigInt(Math.floor(h));if(await t.skip(2),await t.skip(1),a=await t.readUint8(),h=await l(t),0===h){i.R8("esds invalid ES descriptor size 0, skip",c,85),await t.skip(Number(p-t.getPos()));continue}if(4===a)if(e.codecpar.codecId=r.Q9[await t.readUint8()],await t.skip(1),await t.skip(3),await t.skip(4),await t.skip(4),t.getPos()<p-BigInt(5))if(a=await t.readUint8(),h=await l(t),5===a){const a=(0,s.sY)(h),i=await t.readBuffer(h,(0,n.JW)(a,h));f.foundMoov?(e.sideData[1]=i.slice(),(0,s.Eb)(a)):(e.codecpar.extradata=a,e.codecpar.extradataSize=h,86018===e.codecpar.codecId?o.XC(e,i.slice()):86076===e.codecpar.codecId&&d.XC(e,i.slice()))}else await t.skip(Number(p-t.getPos()));else await t.skip(Number(p-t.getPos()));else await t.skip(Math.min(h,Number(p-t.getPos())))}else await t.skip(Math.min(h,Number(p-t.getPos())));else i.R8("esds invalid descriptor size 0, skip",c,68),await t.skip(Number(p-t.getPos()))}const u=a.size-Number(t.getPos()-h);u>0?await t.skip(u):u<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-u}`,c,153)}},40179:(t,e,a)=>{a.d(e,{A:()=>o});var i=a(4624),r=a(34677),s=a(6660),n="src/avformat/formats/mov/parsing/hdlr.ts";async function o(t,e,a,o){const d=t.getPos(),c=await t.readUint8();if(await t.skip(3),0===c){await t.skip(4);const i=await t.readString(4),n=s.f3[i];(0,r.A)(n)&&(e.codecpar.codecType=n),await t.skip(4),await t.skip(4),await t.skip(4);const d=a.size-24;if(d>0){const a=!o.isom&&await t.peekUint8()===d-1;a&&await t.skip(1),e.metadata.handlerName=await t.readString(d-(a?1:0))}}const l=a.size-Number(t.getPos()-d);l>0?await t.skip(l):l<0&&i.z3(`read hdlr error, size: ${a.size}, read: ${a.size-l}`,n,77)}},31421:(t,e,a)=>{a.d(e,{A:()=>d});var i=a(37837),r=a(14686),s=a(4624),n=a(53e3),o="src/avformat/formats/mov/parsing/hvcc.ts";async function d(t,e,a,d){const c=t.getPos();if(e.codecpar.codecId=173,a.size<=0)return;const l=(0,i.sY)(a.size),f=await t.readBuffer(a.size,(0,r.JW)(l,a.size));d.foundMoov?(e.sideData[1]=f.slice(),(0,i.Eb)(l)):(e.codecpar.extradata=l,e.codecpar.extradataSize=a.size,e.sideData[1]=f.slice()),n.XC(e,e.sideData[1]);const h=a.size-Number(t.getPos()-c);h>0?await t.skip(h):h<0&&s.z3(`read hevc error, size: ${a.size}, read: ${a.size-h}`,o,67)}},45248:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/mdhd.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);let d=BigInt(0),c=BigInt(0),l=0,f=BigInt(0);1===o?(d=await t.readUint64(),c=await t.readUint64(),l=await t.readUint32(),f=await t.readUint64()):(d=BigInt(Math.floor(await t.readUint32())),c=BigInt(Math.floor(await t.readUint32())),l=await t.readUint32(),f=BigInt(Math.floor(await t.readUint32()))),e.duration=f,e.timeBase.den=l,e.timeBase.num=1,e.metadata.creationTime=d,e.metadata.modificationTime=c;const h=await t.readUint16(),p=[];p[0]=h>>10&31,p[1]=h>>5&31,p[2]=31&h;const u=String.fromCharCode(p[0]+96,p[1]+96,p[2]+96);e.metadata.language=h,e.metadata.languageString=u,await t.skip(2);const g=a.size-Number(t.getPos()-n);g>0?await t.skip(g):g<0&&i.z3(`read mdhd error, size: ${a.size}, read: ${a.size-g}`,r,83)}},7018:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/mfhd.ts";async function s(t,e,a,s){const n=t.getPos();await t.readUint8(),await t.skip(3),s.currentFragment.sequence=await t.readUint32();const o=a.size-Number(t.getPos()-n);o>0?await t.skip(o):o<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-o}`,r,49)}},19354:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/mvhd.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3),1===o?(s.creationTime=await t.readUint64(),s.modificationTime=await t.readUint64(),s.timescale=await t.readUint32(),s.duration=await t.readUint64()):(s.creationTime=BigInt(Math.floor(await t.readUint32())),s.modificationTime=BigInt(Math.floor(await t.readUint32())),s.timescale=await t.readUint32(),s.duration=BigInt(Math.floor(await t.readUint32()))),s.rate=await t.readUint32(),s.volume=await t.readUint16()>>>8,await t.skip(10),s.matrix=new Uint32Array(9);for(let e=0;e<9;e++)s.matrix[e]=await t.readUint32();await t.skip(24),s.nextTrackId=await t.readUint32();const d=a.size-Number(t.getPos()-n);d>0?await t.skip(d):d<0&&i.z3(`read mvhd error, size: ${a.size}, read: ${a.size-d}`,r,70)}},68361:(t,e,a)=>{a.d(e,{A:()=>k});var i=a(91635),r=a(59299),s=a(63080),n=a(62831),o=a(6570),d=a(34136),c=a(15692),l=a(37213),f=a(45248),h=a(19354),p=a(27436),u=a(40179),g=a(35173),m=a(25778),w=a(7018),U=a(61807),b=a(67523),z=a(58996),v=a(65977);const k={[(0,v.A)("stts")]:i.A,[(0,v.A)("ctts")]:r.A,[(0,v.A)("stss")]:s.A,[(0,v.A)("stsz")]:n.A,[(0,v.A)("stz2")]:o.A,[(0,v.A)("stsc")]:d.A,[(0,v.A)("stco")]:c.A,[(0,v.A)("co64")]:l.A,[(0,v.A)("mdhd")]:f.A,[(0,v.A)("mvhd")]:h.A,[(0,v.A)("tkhd")]:p.A,[(0,v.A)("hdlr")]:u.A,[(0,v.A)("stsd")]:g.A,[(0,v.A)("trex")]:m.A,[(0,v.A)("mfhd")]:w.A,[(0,v.A)("tfhd")]:U.A,[(0,v.A)("tfdt")]:b.A,[(0,v.A)("trun")]:z.A}},15692:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/stco.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[],c=await t.readUint32();if(0===o)for(let e=0;e<c;e++)d.push(BigInt(Math.floor(await t.readUint32())));e.privData.chunkOffsets=d;const l=a.size-Number(t.getPos()-n);l>0?await t.skip(l):l<0&&i.z3(`read stco error, size: ${a.size}, read: ${a.size-l}`,r,56)}},34136:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/stsc.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=e.privData,c=[],l=[],f=[],h=await t.readUint32();if(0===o)for(let e=0;e<h;e++)c.push(await t.readUint32()),l.push(await t.readUint32()),f.push(await t.readUint32());d.stscFirstChunk=c,d.stscSamplesPerChunk=l,d.stscSampleDescriptionIndex=f;const p=a.size-Number(t.getPos()-n);p>0?await t.skip(p):p<0&&i.z3(`read stsc error, size: ${a.size}, read: ${a.size-p}`,r,65)}},35173:(t,e,a)=>{a.d(e,{A:()=>b});var i=a(4624),r=a(65977),s=a(6660),n=a(73840),o=a(31421),d=a(60703),c=a(83561),l=a(38582),f=a(28412),h=a(28460),p=a(86528),u=a(41781),g=a(12869),m=a(7320),w=a(36868),U="src/avformat/formats/mov/parsing/stsd.ts";async function b(t,e,a,b){const z=t.getPos(),v=await t.readUint8();await t.skip(3);const k=e.privData,A=await t.readUint32();for(let a=0;a<A;a++){const a=await t.readUint32(),z=await t.readUint32(),A=t.getPos()+BigInt(Math.floor(a-8));if(s.uf[z]&&(e.codecpar.codecId=s.uf[z]),0===a){i.R8("stsd entry invalid box size 0, skip",U,73),await t.skip(Number(A-t.getPos()));break}if(a>=16?(await t.skip(6),await t.skip(2)):a<=7&&i.h2(`invalid size: ${a} in stsd`,U,86),0===e.codecpar.codecType){await t.skip(2),await t.skip(2),e.metadata.vendorId=await t.readString(4),await t.skip(4),await t.skip(4),e.codecpar.width=await t.readUint16(),e.codecpar.height=await t.readUint16(),await t.skip(4),await t.skip(4),await t.skip(4),await t.skip(2);let a=await t.readUint8();for(a>31&&(a=31),e.metadata.encoder=await t.readString(a),a<31&&await t.skip(31-a),await t.skip(2),await t.skip(2);t.getPos()<A;){const a=await t.readUint32(),s=await t.readUint32();0!==a?s===(0,r.A)("avcC")?await(0,n.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("hvcC")?await(0,o.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("vvcC")?await(0,d.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("av1C")?await(0,l.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("vpcC")?await(0,c.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("esds")?await(0,f.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("wave")?await(0,h.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("colr")?await(0,g.A)(t,e,{type:s,size:a-8},b):await t.skip(Math.min(a-8,Number(A-t.getPos()))):(i.R8("stsd video invalid box size 0, skip",U,135),await t.skip(Number(A-t.getPos())))}}else if(1===e.codecpar.codecType){const a=await t.readUint16();for(await t.skip(2),e.metadata.vendorId=await t.readString(4),e.codecpar.chLayout.nbChannels=await t.readUint16(),e.codecpar.bitsPerCodedSample=await t.readUint16(),k.audioCid=await t.readUint16(),await t.skip(2),e.codecpar.sampleRate=await t.readUint32()>>>16,(!b.isom||0===v&&a>0)&&(1===a?(k.samplesPerFrame=await t.readUint32(),await t.skip(4),k.bytesPerFrame=await t.readUint32(),await t.skip(4)):2===a&&(await t.skip(4),e.codecpar.sampleRate=Number(await t.readUint64()),e.codecpar.chLayout.nbChannels=await t.readUint32(),await t.skip(4),e.codecpar.bitsPerCodedSample=await t.readUint32(),await t.skip(4),k.bytesPerFrame=await t.readUint32(),k.samplesPerFrame=await t.readUint32()));t.getPos()<A;){const a=await t.readUint32(),s=await t.readUint32();0!==a?s===(0,r.A)("esds")?await(0,f.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("dfLa")?await(0,p.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("dOps")?await(0,u.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("wave")?await(0,h.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("dac3")?await(0,m.A)(t,e,{type:s,size:a-8},b):s===(0,r.A)("dec3")?await(0,w.A)(t,e,{type:s,size:a-8},b):await t.skip(Math.min(a-8,Number(A-t.getPos()))):(i.R8("stsd audio invalid box size 0, skip",U,282),await t.skip(Number(A-t.getPos())))}}else 3===e.codecpar.codecType?(z===(0,r.A)("stpp")?e.codecpar.codecId=94232:z===(0,r.A)("wvtt")?e.codecpar.codecId=94226:z===(0,r.A)("tx3g")||z===(0,r.A)("text")?e.codecpar.codecId=94213:z===(0,r.A)("c608")&&(e.codecpar.codecId=94218),await t.skip(Math.min(a-8,Number(A-t.getPos())))):await t.skip(Math.min(a-8,Number(A-t.getPos())))}const y=a.size-Number(t.getPos()-z);y>0?await t.skip(y):y<0&&i.z3(`read stsd error, size: ${a.size}, read: ${a.size-y}`,U,383)}},63080:(t,e,a)=>{a.d(e,{A:()=>o});var i=a(80662),r=a.n(i),s=a(4624),n="src/avformat/formats/mov/parsing/stss.ts";async function o(t,e,a,i){const o=t.getPos(),d=await t.readUint8();await t.skip(3);const c=new(r()),l=await t.readUint32();if(0===d)for(let e=0;e<l;e++)c.set(await t.readUint32(),!0);e.privData.stssSampleNumbersMap=c;const f=a.size-Number(t.getPos()-o);f>0?await t.skip(f):f<0&&s.z3(`read stss error, size: ${a.size}, read: ${a.size-f}`,n,57)}},62831:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/stsz.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[];let c=0,l=0;if(0===o){c=await t.readUint32(),l=await t.readUint32();for(let e=0;e<l;e++)0===c?d.push(await t.readUint32()):d[e]=c}e.privData.sampleSizes=d;const f=a.size-Number(t.getPos()-n);f>0?await t.skip(f):f<0&&i.z3(`read stsz error, size: ${a.size}, read: ${a.size-f}`,r,65)}},91635:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/stts.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=e.privData,c=[],l=[],f=await t.readUint32();let h=1;if(0===o)for(let e=0;e<f;e++)c.push(await t.readUint32()),h=await t.readInt32(),h<0&&i.R8("File uses negative stts sample delta, using value 1 instead, sync may be lost!",r,53),l.push(h);d.sttsSampleCounts=c,d.sttsSampleDeltas=l;const p=a.size-Number(t.getPos()-n);p>0?await t.skip(p):p<0&&i.z3(`read stts error, size: ${a.size}, read: ${a.size-p}`,r,67)}},6570:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/stz2.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=[];let c=0,l=0;if(0===o)if(await t.skip(3),l=await t.readUint8(),c=await t.readUint32(),4===l)for(let e=0;e<c;e+=2){const a=await t.readUint8();d[e]=a>>4&15,d[e+1]=15&a}else if(8===l)for(let e=0;e<c;e++)d[e]=await t.readUint8();else if(16===l)for(let e=0;e<c;e++)d[e]=await t.readUint16();else i.z3("Error in length field in stz2 box",r,67);e.privData.sampleSizes=d;const f=a.size-Number(t.getPos()-n);f>0?await t.skip(f):f<0&&i.z3(`read stz2 error, size: ${a.size}, read: ${a.size-f}`,r,78)}},67523:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/tfdt.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8();await t.skip(3);const d=s.currentFragment.currentTrack;d&&(d.baseMediaDecodeTime=1===o?await t.readUint64():BigInt(Math.floor(await t.readUint32())));const c=a.size-Number(t.getPos()-n);c>0?await t.skip(c):c<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-c}`,r,57)}},61807:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/tfhd.ts";async function s(t,e,a,s){const n=t.getPos(),o=(await t.readUint8(),await t.readUint24()),d=await t.readUint32(),c=s.currentFragment.currentTrack;c.trackId=d,c&&(1&o&&(c.baseDataOffset=await t.readUint64()),2&o&&await t.skip(4),8&o&&(c.defaultSampleDuration=await t.readUint32()),16&o&&(c.defaultSampleSize=await t.readUint32()),32&o&&(c.defaultSampleFlags=await t.readUint32()),131072&o&&(c.baseIsMoof=!0));const l=a.size-Number(t.getPos()-n);l>0?await t.skip(l):l<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-l}`,r,75)}},27436:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/tkhd.ts";async function s(t,e,a,s){const n=e.privData,o=t.getPos(),d=await t.readUint8();n.flags=await t.readUint24(),1&n.flags&&(e.disposition|=1),1===d?(e.metadata.creationTime=await t.readUint64(),e.metadata.modificationTime=await t.readUint64(),n.trackId=await t.readUint32(),await t.skip(4),n.duration=await t.readUint64()):(e.metadata.creationTime=BigInt(Math.floor(await t.readUint32())),e.metadata.modificationTime=BigInt(Math.floor(await t.readUint32())),n.trackId=await t.readUint32(),await t.skip(4),n.duration=BigInt(Math.floor(await t.readUint32()))),await t.skip(8),n.layer=await t.readInt16(),n.alternateGroup=await t.readInt16(),n.volume=await t.readInt16()>>8,await t.skip(2),n.matrix=new Uint32Array(9);for(let e=0;e<9;e++)n.matrix[e]=await t.readUint32();n.width=await t.readUint32()>>16,n.height=await t.readUint32()>>16;const c=a.size-Number(t.getPos()-o);c>0?await t.skip(c):c<0&&i.z3(`read tkhd error, size: ${a.size}, read: ${a.size-c}`,r,82)}},25778:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/trex.ts";async function s(t,e,a,s){const n=t.getPos();await t.readUint8(),await t.skip(3);const o=await t.readUint32();await t.skip(4);const d=await t.readUint32(),c=await t.readUint32(),l=await t.readUint32();s.trexs.push({trackId:o,duration:d,size:c,flags:l});const f=a.size-Number(t.getPos()-n);f>0?await t.skip(f):f<0&&i.z3(`read trex error, size: ${a.size}, read: ${a.size-f}`,r,61)}},58996:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/formats/mov/parsing/trun.ts";async function s(t,e,a,s){const n=t.getPos(),o=await t.readUint8(),d=await t.readUint24(),c=s.currentFragment.currentTrack;if(c){c.sampleCount=await t.readUint32(),1&d&&(c.dataOffset=await t.readInt32()),4&d&&(c.firstSampleFlags=await t.readUint32());for(let e=0;e<c.sampleCount;e++)256&d&&c.sampleDurations.push(await t.readUint32()),512&d&&c.sampleSizes.push(await t.readUint32()),1024&d&&c.sampleFlags.push(await t.readUint32()),2048&d&&(0===o?c.sampleCompositionTimeOffset.push(await t.readUint32()):c.sampleCompositionTimeOffset.push(await t.readInt32()))}const l=a.size-Number(t.getPos()-n);l>0?await t.skip(l):l<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-l}`,r,79)}},83561:(t,e,a)=>{a.d(e,{A:()=>d});var i=a(37837),r=a(14686),s=a(4624),n=a(58919),o="src/avformat/formats/mov/parsing/vpcc.ts";async function d(t,e,a,d){const c=t.getPos();if(await t.readUint8(),await t.skip(3),e.codecpar.codecId=167,a.size-4<=0)return;const l=(0,i.sY)(a.size-4),f=await t.readBuffer(a.size-4,(0,r.JW)(l,a.size-4));d.foundMoov?(e.sideData[1]=f.slice(),(0,i.Eb)(l)):(e.codecpar.extradata=l,e.codecpar.extradataSize=a.size-4,e.sideData[1]=f.slice()),n.XC(e,e.sideData[1]);const h=a.size-Number(t.getPos()-c);h>0?await t.skip(h):h<0&&s.z3(`read vpcc error, size: ${a.size}, read: ${a.size-h}`,o,71)}},60703:(t,e,a)=>{a.d(e,{A:()=>d});var i=a(37837),r=a(14686),s=a(4624),n=a(55611),o="src/avformat/formats/mov/parsing/vvcc.ts";async function d(t,e,a,d){const c=t.getPos();if(await t.readUint8(),await t.skip(3),e.codecpar.codecId=196,a.size-4<=0)return;const l=(0,i.sY)(a.size-4),f=await t.readBuffer(a.size-4,(0,r.JW)(l,a.size-4));d.foundMoov?(e.sideData[1]=f.slice(),(0,i.Eb)(l)):(e.codecpar.extradata=l,e.codecpar.extradataSize=a.size-4,e.sideData[1]=f.slice()),n.XC(e,e.sideData[1]);const h=a.size-Number(t.getPos()-c);h>0?await t.skip(h):h<0&&s.z3(`read vvcc error, size: ${a.size}, read: ${a.size-h}`,o,71)}},28460:(t,e,a)=>{a.d(e,{A:()=>o});var i=a(4624),r=a(65977),s=a(28412),n="src/avformat/formats/mov/parsing/wave.ts";async function o(t,e,a,o){const d=t.getPos(),c=d+BigInt(Math.floor(a.size));for(;t.getPos()<c;){const a=await t.readUint32(),d=await t.readUint32();0!==a?d===(0,r.A)("esds")?await(0,s.A)(t,e,{type:d,size:a-8},o):await t.skip(Math.min(a-8,Number(c-t.getPos()))):(i.R8("wave invalid box size 0, skip",n,47),await t.skip(Number(c-t.getPos())))}const l=a.size-Number(t.getPos()-d);l>0?await t.skip(l):l<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-l}`,n,73)}},65977:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(4624),r="src/avformat/function/mktag.ts";function s(t){4!==t.length&&i.R8(`tag length is not 4, tag: ${t}`,r,30);let e=0;for(let a=0;a<4;a++)e=e<<8|t.charCodeAt(a);return e}},null:()=>{},23991:(t,e,a)=>{function i(t){let e=0,a=0;for(;a<32&&0===t.readU1();)a++;return e=t.readU(a),e+=(1<<a)-1,e}function r(t){let e=i(t);return e=1&e?(e+1)/2:-e/2,e}a.d(e,{$x:()=>r,xb:()=>i})},39381:(t,e,a)=>{a.d(e,{E3:()=>s,Sg:()=>c,Y0:()=>d,ht:()=>o,r8:()=>r,yd:()=>n});var i=a(63939);function r(t){return i.f[2](t)}function s(t){return r(t+1)<<8|r(t)}function n(t){return r(t)<<8|r(t+1)}function o(t){return r(t)<<16|r(t+1)<<8|r(t+2)}function d(t){return s(t+2)<<16|s(t)}function c(t){return n(t)<<16|n(t+2)}},60264:(t,e,a)=>{function i(t){return t.length>4&&0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])}function r(t,e){let a=0;for(let i=e;i<t.length;i++)switch(t[i]){case 0:a++;break;case 1:if(a>=2)return{offset:i-Math.min(a,3),startCode:Math.min(a+1,4)};a=0;break;default:a=0}return{offset:-1,startCode:0}}function s(t){const e=[];let a=r(t,0),i={offset:-1,startCode:0};for(;i=r(t,a.offset+a.startCode),i.offset>-1;)e.push(t.subarray(a.offset+a.startCode,i.offset,!0)),a=i;return e.push(t.subarray(a.offset+a.startCode,void 0,!0)),e}function n(t,e=0,a){a||(a=t.length);const i=new Uint8Array(t.length);let r=0,s=0;for(let n=0;n<t.length;n++){if(n>=e&&n<a)if(0===t[n])r++;else if(3===t[n]&&2===r&&n+1<t.length&&t[n+1]<=3){if(n++,n===t.length)break;r=0===t[n]?1:0}else r=0;i[s++]=t[n]}return i.slice(0,s)}a.d(e,{BN:()=>n,Bs:()=>i,Ky:()=>r,py:()=>s})},37246:(t,e,a)=>{a.d(e,{A:()=>s});var i=a(134),r=a(4624);class s{constructor(t=1048576){(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"bitsLeft",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"endPointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.pos=BigInt(0),this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let t=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let e=this.pointer,a=this.bitsLeft;return 0===a&&(e++,a=8),t=this.buffer[e]>>a-1&1,t}readU1(){let t=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,t=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8,this.pos++),t}readU(t){let e=0;for(let a=0;a<t;a++)e|=this.readU1()<<t-a-1;return e}peekU(t){const e=this.pointer,a=this.bitsLeft,i=this.pos,r=this.readU(t);return this.pointer=e,this.bitsLeft=a,this.pos=i,r}remainingLength(){return this.endPointer-this.pointer}getBitLeft(){return this.bitsLeft}getPointer(){return this.pointer}setPointer(t){this.pointer=t}getPos(){return this.pos}skip(t){const e=(t-t%8)/8;this.pointer+=e,this.pos+=BigInt(e);const a=t%8;this.bitsLeft<=a?(this.pointer++,this.pos++,this.bitsLeft=8-(a-this.bitsLeft)):this.bitsLeft-=a}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&(this.pointer++,this.pos++),!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const t=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(t<0)throw this.error=t,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+t,this.pointer=0}else{const t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,r.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",257)}}reset(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0,this.pos=BigInt(0)}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++,this.pos++)}}},83314:(t,e,a)=>{a.d(e,{A:()=>r});var i=a(134);class r{constructor(t=1048576){(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"bitPointer",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.pos=BigInt(0),this.buffer=new Uint8Array(this.size)}writeU1(t){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&t?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.pos++,this.bitPointer=0)}writeU(t,e){for(let a=0;a<t;a++)this.writeU1(e>>t-a-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const t=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}reset(){this.pointer=0,this.bitPointer=0,this.error=0,this.pos=BigInt(0)}getBuffer(){return this.buffer}getPointer(){return this.pointer}getPos(){return this.pos}}},729:(t,e,a)=>{a.d(e,{A:()=>n});var i=a(134),r=a(4624),s=a(50011);class n{constructor(t,e=!0){(0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"byteStart",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}writeUint8(t){this.data.setUint8(this.pos+++this.byteStart,t)}writeUint16(t){this.data.setUint16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeUint24(t){const e=3840&t,a=240&t,i=15&t;this.littleEndian?(this.writeUint8(i),this.writeUint8(a),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(a),this.writeUint8(i))}writeUint32(t){this.data.setUint32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeUint64(t){const e=t&BigInt(4294967295),a=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(e)),this.writeUint32(Number(a))):(this.writeUint32(Number(a)),this.writeUint32(Number(e)))}writeInt8(t){this.data.setInt8(this.pos+++this.byteStart,t)}writeInt16(t){this.data.setInt16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeInt24(t){this.writeUint24(t<0?t+16777216:t)}writeInt32(t){this.data.setInt32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeInt64(t){const e=t&BigInt(4294967295),a=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(e)),this.writeInt32(Number(a))):(this.writeInt32(Number(a)),this.writeInt32(Number(e)))}writeFloat(t){this.data.setFloat32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeDouble(t){this.data.setFloat64(this.pos+this.byteStart,t,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}writeBuffer(t){let e=t.length;this.remainingSize()<e&&(e=this.remainingSize(),r.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${t.length}, but set ${e}`,"src/common/io/BufferWriter.ts",218)),this.buffer.set(t,this.pos),this.pos+=t.length}writeString(t){const e=s.encode(t);return this.writeBuffer(e),e.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(t,e=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}}}}]);