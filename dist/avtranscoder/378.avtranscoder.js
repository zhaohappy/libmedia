(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[378],{47344:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>m});var n=s(134),i=s(50932),r=s(4624),a=s(9705),o=s(85947),u=s(14686),c=s(37837),d=s(71517),h=s(72739),f=s(50011),l=s(51785);const g="src/avformat/formats/IAssFormat.ts";class m extends o.A{constructor(){super(),(0,n.A)(this,"type",20),(0,n.A)(this,"queue",void 0),(0,n.A)(this,"index",void 0)}init(t){this.queue=[]}async readHeader(t){const e=await t.ioReader.readLine();if("[Script Info]"!==e.trim())return r.z3("the file format is not ass",g,68),a.LR;const s=t.createStream();s.codecpar.codecId=94230,s.codecpar.codecType=3,s.timeBase.den=1e3,s.timeBase.num=1;let n,i=e+"\n",o=!1,d=0,m=0;for(;;){const e=await t.ioReader.readLine();if(!/^;/.test(e)){if("[Events]"===e.trim()&&(o=!0),/^Format:/.test(e)&&o){i+=e,n=l.Bp(e.trim());for(let t=0;t<n.length;t++)"Start"===n[t]?d=t:"End"===n[t]&&(m=t);break}i+=e+"\n"}}const p=f.encode(i);s.codecpar.extradata=(0,c.sY)(p.length),s.codecpar.extradataSize=p.length,(0,u.lW)(s.codecpar.extradata,p.length,p),this.index=0;let x=BigInt(0);try{for(;;){const e=t.ioReader.getPos(),i=(await t.ioReader.readLine()).trim();if(/^;/.test(i)||/^Comment:/.test(i))continue;const{start:r,end:a}=l.Ew(n,i,d,m);s.nbFrames++,s.duration=a;const o={context:i,startTs:r,endTs:a,pos:e};r>=x?(this.queue.push(o),x=r):h._(this.queue,o,(t=>t.startTs<o.startTs?1:-1))}}catch(t){return 0}}async readAVPacket(t,e){if(!this.queue.length)return a.LR;if(this.index>=this.queue.length)return-1048576;const s=t.streams.find((t=>3===t.codecpar.codecType)),n=this.queue[this.index++];i.M[15](e+32,s.index),i.M[15](e+76,s.timeBase.den),i.M[15](e+72,s.timeBase.num),i.M[17](e+16,n.startTs),i.M[17](e+8,n.startTs),i.M[17](e+48,n.endTs-n.startTs);const r=f.encode(n.context),o=(0,c.sY)(r.length);return(0,u.lW)(o,r.length,r),(0,d.NX)(e,o,r.length),0}async seek(t,e,s,n){if(2&n)return BigInt(a.E$);if(s<=BigInt(0))return this.index=0,BigInt(0);const i=h.El(this.queue,(t=>t.startTs>s?-1:1));if(i>=0){for(r.Yz(`seek in cues, found index: ${i}, pts: ${this.queue[i].startTs}, pos: ${this.queue[i].pos}`,g,217),this.index=Math.max(i-1,0);this.index>0&&(this.queue[this.index-1].startTs===this.queue[this.index].startTs||this.queue[this.index-1].endTs>s);)this.index--;return BigInt(0)}return BigInt(a.LR)}getAnalyzeStreamsCount(){return 1}}},85947:(t,e,s)=>{"use strict";s.d(e,{A:()=>i});var n=s(134);class i{constructor(){(0,n.A)(this,"type",-1),(0,n.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},5028:(t,e,s)=>{"use strict";s.d(e,{Q:()=>n});const n=["ReadOrder","Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"]},51785:(t,e,s)=>{"use strict";s.d(e,{Bp:()=>o,Ew:()=>u}),s(7210);var n=s(4624),i=s(5028),r=s(54825);const a="src/avformat/formats/ass/iass.ts";function o(t){return function(t,e){const s=e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/),i=[];for(let e=0;e<s.length;e++){const r=t.find((t=>t.toLowerCase()===s[e].toLowerCase()));r||n.R8(`not support ass field(${s[e]})`,a,40),i.push(r||s[e])}return i}(i.Q,t)}function u(t,e,s,n){const[,,i]=e.match(/^(\w+?)\s*:\s*(.*)/i),a=function(t,e){let s=e.split(",");if(s.length>t.length){const e=s.slice(t.length-1).join(",");s=s.slice(0,t.length-1),s.push(e)}return s}(t,i);return{start:(0,r.j)(a[s]),end:(0,r.j)(a[n])}}},54825:(t,e,s)=>{"use strict";function n(t){if(!(t=t.trim()))return-BigInt(1);let e=t.split(":"),s=BigInt(0);return 3===e.length&&(s+=BigInt(+e.shift().trim())*BigInt(36e5)),s+=BigInt(+e.shift().trim())*BigInt(6e4),e=e.shift().trim().split("."),s+=BigInt(+e.shift().trim())*BigInt(1e3),s+=BigInt(+e.shift().trim()),s}function i(t){if(!(t=t.trim()))return-BigInt(1);let e=t.split(":"),s=BigInt(0);return 3===e.length&&(s+=BigInt(+e.shift().trim())*BigInt(36e5)),s+=BigInt(+e.shift().trim())*BigInt(6e4),e=e.shift().trim().split(","),s+=BigInt(+e.shift().trim())*BigInt(1e3),s+=BigInt(+e.shift().trim()),s}s.d(e,{j:()=>n,t:()=>i})},11837:(t,e,s)=>{s(21489),t.exports=s(46438).Number.isNaN},21489:(t,e,s)=>{var n=s(88535);n(n.S,"Number",{isNaN:function(t){return t!=t}})},7210:(t,e,s)=>{t.exports=s(11837)},null:()=>{},null:()=>{},null:()=>{"use strict";["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"].map((t=>({name:t,regex:new RegExp(`^${t}-?\\d`)})))},null:()=>{},null:()=>{}}]);