"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[3],{64436:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(134),a=i(63939),s=(i(77162),i(37837)),n=i(71766);class c{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,s.Gy)(168),(0,n.Yi)(this.inCodecpar,e),this.inTimeBase={den:a.f[15](t+4),num:a.f[15](t)},0}destroy(){this.inCodecpar&&((0,n.dn)(this.inCodecpar),this.inCodecpar=0)}}},26173:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(134),a=i(63939),s=i(50932),n=i(64436),c=i(71517),o=i(62815),d=i(67659),h=i(59166),l=i(14686),f=i(9705),p=i(60264),u=i(37837),U=i(4624);class g extends n.A{constructor(...e){super(...e),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0)}init(e,t){return super.init(e,t),this.cache=(0,c._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,c.Qe)(this.cache),this.cache=0}sendAVPacket(e){const t=(0,l.JW)(a.f[20](e+24),a.f[15](e+28));if(1!==a.f[15](e+80)&&(0,p.Bs)(t)){let i;if((0,c.zu)(this.cache,e),27===a.f[15](this.inCodecpar+4)?i=o.oT(t):173===a.f[15](this.inCodecpar+4)?i=d.oT(t):196===a.f[15](this.inCodecpar+4)?i=h.oT(t):U.h2(`not support for codecId: ${a.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Annexb2AvccFilter.ts",91),s.M[15](this.cache+80,1),(0,c.NX)(this.cache,i.bufferPointer,i.length),i.key&&s.M[15](this.cache+36,1|a.f[15](this.cache+36)),i.extradata){const e=(0,u.sY)(i.extradata.length);(0,l.lW)(e,i.extradata.length,i.extradata),(0,c.Ow)(this.cache,1,e,i.extradata.length)}}else(0,c.rN)(this.cache,e);return this.cached=!0,0}receiveAVPacket(e){return this.cached?((0,c.Up)(e),(0,c.rN)(e,this.cache),this.cached=!1,0):f.LR}reset(){return 0}}},4003:(e,t,i)=>{i.r(t),i.d(t,{default:()=>A});var r=i(134),a=i(61499),s=i(63939),n=i(9599),c=i(29170),o=i(51597),d=i(58121),h=i(68243),l=i(72739),f=i(95335),p=i(35028),u=i(94889),U=i(96157),g=i(95268),w=i(33854),m=i(92647),x=i(14686),I=i(4624),y=i(71517),b=i(44328),k=i(26173),M=i(77231),v="src/avformat/formats/OFlvFormat.ts";class A extends o.A{constructor(e={}){super(),(0,r.A)(this,"type",0),(0,r.A)(this,"context",void 0),(0,r.A)(this,"header",void 0),(0,r.A)(this,"script",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"annexb2AvccFilter",void 0),this.header=new d.A,this.script=new h.A,this.options=e,this.context={keyframeFilePositions:[],keyFrameTimes:[],lastkeyframelocation:0,lastkeyframetimestamp:BigInt(0),lasttimestamp:BigInt(0),framerate:0,filesize:0,audioSize:0,videosize:0,datasize:0,duration:0,scriptWrote:!1,frameCount:0,firstKeyframePositionWrote:!1,videoMetadataWrote:!1}}init(e){e.ioWriter&&e.ioWriter.setEndian(!0);const t=e.getStreamByMediaType(1),i=e.getStreamByMediaType(0);return t&&(this.header.hasAudio=!0,this.script.onMetaData.hasAudio=!0,86051===t.codecpar.codecId&&(16e3!==t.codecpar.sampleRate&&I.h2("flv speex only support 16000 sample rate",v,114),1!==t.codecpar.chLayout.nbChannels&&I.h2("flv speex only support 1 channel",v,117)),f.zy(p.FV,t.codecpar.codecId)&&(this.script.onMetaData.audiocodecid=p.FV[t.codecpar.codecId],this.script.onMetaData.stereo=t.codecpar.chLayout.nbChannels>1,this.script.onMetaData.audiosamplerate=t.codecpar.sampleRate||0,this.script.onMetaData.audiosamplesize=t.codecpar.frameSize||0),t.timeBase.den=1e3,t.timeBase.num=1),i&&(this.header.hasVideo=!0,this.script.onMetaData.hasVideo=!0,f.zy(p.FV,i.codecpar.codecId)&&(this.script.onMetaData.videocodecid=p.FV[i.codecpar.codecId],this.script.onMetaData.width=i.codecpar.width||0,this.script.onMetaData.height=i.codecpar.height||0,this.script.onMetaData.framerate=(0,b.lb)(i.codecpar.framerate)),i.timeBase.den=1e3,i.timeBase.num=1,this.annexb2AvccFilter=new k.A,this.annexb2AvccFilter.init(i.codecpar[a.o9],i.timeBase[a.o9])),0}async destroy(e){this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null)}writeHeader(e){this.header.write(e.ioWriter),e.ioWriter.writeUint32(0),this.options.live&&(this.script.write(e.ioWriter),this.context.scriptWrote=!0);const t=e.getStreamByMediaType(1),i=e.getStreamByMediaType(0);if(t&&t.codecpar.extradata){if(86018===t.codecpar.codecId){const i=U.e(e.ioWriter,t,(0,x.s3)(t.codecpar.extradata,t.codecpar.extradataSize));this.context.filesize+=i+4,this.context.audioSize+=t.codecpar.extradataSize,this.context.datasize+=t.codecpar.extradataSize}this.script.onMetaData.hasMetadata=!0}if(i&&i.codecpar.extradata){if(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId||167===i.codecpar.codecId||225===i.codecpar.codecId||12===i.codecpar.codecId){const t=e.ioWriter.getPos(),r=173===i.codecpar.codecId||196===i.codecpar.codecId||167===i.codecpar.codecId||225===i.codecpar.codecId?w.e(e.ioWriter,i,(0,x.s3)(i.codecpar.extradata,i.codecpar.extradataSize),1):g.e(e.ioWriter,i,(0,x.s3)(i.codecpar.extradata,i.codecpar.extradataSize),1);this.context.filesize+=r+4,this.context.videosize+=i.codecpar.extradataSize,this.context.datasize+=i.codecpar.extradataSize,this.context.keyFrameTimes.push(0),this.context.keyframeFilePositions.push(Number(t)),this.context.videoMetadataWrote=!0}this.script.onMetaData.hasMetadata=!0}return 0}writeAVPacket(e,t){const i=e.getStreamByIndex(s.f[15](t+32));if(i){if(1===i.codecpar.codecType){const r=(0,y.rU)(t,1);if(r){const t=(0,x.s3)(s.f[20](r),s.f[15](r+4));86018===i.codecpar.codecId&&U.e(e.ioWriter,i,t)}if(s.f[15](t+28)){const r=e.ioWriter.getPos();u.xk(e.ioWriter,8,s.f[15](t+28)+1+p.IO[i.codecpar.codecId],(0,b.k)(s.f[17](t+16),(0,c.A)(t+72,n.P),i.timeBase)),u.BV(e.ioWriter,i),86018===i.codecpar.codecId&&U.x(e.ioWriter,1),e.ioWriter.writeBuffer((0,x.s3)(s.f[20](t+24),s.f[15](t+28)));const a=Number(e.ioWriter.getPos()-r);e.ioWriter.writeUint32(a),this.context.audioSize+=a,this.context.filesize+=a+4,this.context.lasttimestamp=(0,b.k)(s.f[17](t+8),(0,c.A)(t+72,n.P),i.timeBase),this.context.datasize+=s.f[15](t+28)||0}}else if(0===i.codecpar.codecType){27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||1===s.f[15](t+80)||(this.annexb2AvccFilter.sendAVPacket(t),this.annexb2AvccFilter.receiveAVPacket(t));const r=e.ioWriter.getPos(),a=(0,y.rU)(t,1);if(a){const t=(0,x.s3)(s.f[20](a),s.f[15](a+4));27===i.codecpar.codecId||12===i.codecpar.codecId?g.e(e.ioWriter,i,t,1):173!==i.codecpar.codecId&&196!==i.codecpar.codecId&&167!==i.codecpar.codecId&&225!==i.codecpar.codecId||w.e(e.ioWriter,i,(0,x.s3)(i.codecpar.extradata,i.codecpar.extradataSize),1)}if(s.f[15](t+28)){const a=e.ioWriter.getPos();if(173===i.codecpar.codecId||196===i.codecpar.codecId||167===i.codecpar.codecId||225===i.codecpar.codecId){const r=s.f[17](t+16)===s.f[17](t+8)||173!==i.codecpar.codecId&&196!==i.codecpar.codecId?3:1;if(u.xk(e.ioWriter,9,s.f[15](t+28)+1+p.IO[i.codecpar.codecId]+(1===r?3:0),(0,b.k)(s.f[17](t+16),(0,c.A)(t+72,n.P),i.timeBase)),u.VU(e.ioWriter,i,r,s.f[15](t+36)),w.d(e.ioWriter,i.codecpar.codecId),1===r){let r=0;s.f[17](t+8)!==M.Dh&&(r=Number(BigInt.asIntN(32,(0,b.k)(s.f[17](t+8)-s.f[17](t+16),(0,c.A)(t+72,n.P),i.timeBase)))),e.ioWriter.writeUint24(r)}}else if(u.xk(e.ioWriter,9,s.f[15](t+28)+1+p.IO[i.codecpar.codecId],(0,b.k)(s.f[17](t+16),(0,c.A)(t+72,n.P),i.timeBase)),27===i.codecpar.codecId||12===i.codecpar.codecId){u.ii(e.ioWriter,i,s.f[15](t+36));let r=0;s.f[17](t+8)!==M.Dh&&(r=Number(BigInt.asIntN(32,(0,b.k)(s.f[17](t+8)-s.f[17](t+16),(0,c.A)(t+72,n.P),i.timeBase)))),g.x(e.ioWriter,1,r)}e.ioWriter.writeBuffer((0,x.s3)(s.f[20](t+24),s.f[15](t+28)));const o=Number(e.ioWriter.getPos()-a);e.ioWriter.writeUint32(o),this.context.videosize+=o,this.context.filesize+=o+4,this.context.lasttimestamp=(0,b.k)(s.f[17](t+8),(0,c.A)(t+72,n.P),i.timeBase),this.context.datasize+=s.f[15](t+28)||0,this.context.frameCount++,1&s.f[15](t+36)&&(this.context.firstKeyframePositionWrote||!this.context.videoMetadataWrote?(this.context.lastkeyframetimestamp=(0,b.k)(s.f[17](t+8),(0,c.A)(t+72,n.P),i.timeBase),this.context.lastkeyframelocation=Number(r),this.context.keyFrameTimes.push(Number((Number(this.context.lastkeyframetimestamp)*(0,b.lb)(i.timeBase)).toFixed(2))),this.context.keyframeFilePositions.push(this.context.lastkeyframelocation)):this.context.firstKeyframePositionWrote=!0)}}return 0}I.R8(`can not found the stream width the packet's streamIndex: ${s.f[15](t+32)}, ignore it`,v,234)}writeTrailer(e){const t=e.getStreamByMediaType(0);if(t&&(27===t.codecpar.codecId||173===t.codecpar.codecId||196===t.codecpar.codecId||167===t.codecpar.codecId||225===t.codecpar.codecId||12===t.codecpar.codecId)){const i=173===t.codecpar.codecId||196===t.codecpar.codecId||167===t.codecpar.codecId||225===t.codecpar.codecId;u.xk(e.ioWriter,9,1+p.IO[t.codecpar.codecId],BigInt(0)),i?(u.VU(e.ioWriter,t,2,1),w.d(e.ioWriter,t.codecpar.codecId)):(u.ii(e.ioWriter,t,1),g.x(e.ioWriter,2,0)),e.ioWriter.writeUint32(12+p.IO[t.codecpar.codecId]),this.context.videosize+=12+p.IO[t.codecpar.codecId],this.context.filesize+=12+p.IO[t.codecpar.codecId]+4,this.script.onMetaData.canSeekToEnd=!0}if(this.context.scriptWrote)e.ioWriter.flush();else{e.ioWriter.flush(),this.script.onMetaData.filesize=this.context.filesize,this.script.onMetaData.audiosize=this.context.audioSize,this.script.onMetaData.videosize=this.context.videosize,this.script.onMetaData.datasize=this.context.datasize,this.script.onMetaData.lasttimestamp=this.context.lasttimestamp,this.options.hasKeyframes?(this.script.onMetaData.lastkeyframetimestamp=this.context.lastkeyframetimestamp,this.script.onMetaData.lastkeyframelocation=this.context.lastkeyframelocation,this.context.keyFrameTimes.length>1?(this.script.onMetaData.hasKeyframes=!0,this.script.onMetaData.keyframes={filepositions:this.context.keyframeFilePositions,times:this.context.keyFrameTimes}):this.script.onMetaData.hasKeyframes=!1):this.script.onMetaData.hasKeyframes=!1,this.script.onMetaData.duration=Number((Number(this.context.lasttimestamp)/1e3).toFixed(2)),this.script.onMetaData.audiodatarate=Number((this.context.audioSize/this.script.onMetaData.duration/1e3).toFixed(2)),this.script.onMetaData.videodatarate=Number((this.context.videosize/this.script.onMetaData.duration/1e3).toFixed(2)),this.script.onMetaData.framerate=Math.floor(this.context.frameCount/this.script.onMetaData.duration);const t=this.script.computeSize();l.__(this.context.keyframeFilePositions,((e,i)=>{this.context.keyframeFilePositions[i]=e+11+t+4})),this.script.onMetaData.keyframes&&(this.script.onMetaData.keyframes.filepositions=this.context.keyframeFilePositions),this.context.filesize+=11+t+4,this.script.onMetaData.filesize=this.context.filesize;const i=[],r=e.ioWriter.onFlush;e.ioWriter.onFlush=e=>(i.push(e.slice()),0),this.script.write(e.ioWriter),e.ioWriter.flush(),e.ioWriter.onFlush=r;const a=(0,m.A)(Uint8Array,i);r&&r(a,BigInt(13))}return 0}flush(e){return e.ioWriter.flush(),0}}},58121:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134);class a{constructor(){(0,r.A)(this,"signature",void 0),(0,r.A)(this,"version",void 0),(0,r.A)(this,"flags",void 0),(0,r.A)(this,"dataOffset",void 0),(0,r.A)(this,"hasVideo",void 0),(0,r.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(this.flags),e.writeUint32(this.dataOffset)}}},68243:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(134),a=i(35336),s=i(92647),n=i(4624),c=i(94889),o=i(9705),d=i(73040);class h{constructor(){(0,r.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(e,t){const i=e.getPos(),r=i+BigInt(Math.floor(t)),a=await(0,d.$x)(e,r),s=await(0,d.$x)(e,r);this[a]=s,r>e.getPos()&&await e.skip(Number(BigInt.asIntN(32,r-e.getPos())));const c=Number(e.getPos()-i),h=await e.readUint32();return c+11!==h?(n.R8(`script size not match, size: ${c+11}, previousTagSize: ${h}`,"src/avformat/formats/flv/FlvScriptTag.ts",64),o.LR):0}computeSize(){const e=[],t=new a.A;return t.onFlush=t=>(e.push(t.slice()),0),(0,d.bD)(t,"onMetaData"),(0,d.bD)(t,this.onMetaData),t.flush(),(0,s.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],i=new a.A;i.onFlush=e=>(t.push(e.slice()),0),(0,d.bD)(i,"onMetaData"),(0,d.bD)(i,this.onMetaData),i.flush();const r=(0,s.A)(Uint8Array,t),n=e.getPos();c.xk(e,18,r.length,BigInt(0)),e.writeBuffer(r),e.writeUint32(Number(e.getPos()-n))}}dts2Position(e){if(this.canSeek()){let t=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let a;for(a=0;a<i.length;a++){if(i[a]===e){t=a;break}if(i[a]>e){t=Math.max(a-1,0);break}}return a&&a===i.length&&(t=i.length-1),{pos:r[t],dts:i[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let i=-1;const r=this.onMetaData.keyframes.times,a=this.onMetaData.keyframes.filepositions;let s=0;for(s=0;s<a.length;s++)if(a[s]>e){i=s;break}var t;return s===a.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:r[r.length-1]:r[i]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},96157:(e,t,i)=>{i.d(t,{e:()=>n,x:()=>s});var r=i(94889),a=i(35028);function s(e,t){e.writeUint8(t)}function n(e,t,i){const n=e.getPos();r.xk(e,8,i.length+1+a.IO[86018],BigInt(0)),r.BV(e,t),s(e,0),e.writeBuffer(i);const c=Number(e.getPos()-n);return e.writeUint32(c),c}},33854:(e,t,i)=>{i.d(t,{d:()=>s,e:()=>n});var r=i(94889),a=i(35028);function s(e,t){switch(t){case 173:e.writeString("hvc1");break;case 196:e.writeString("vvc1");break;case 167:e.writeString("vp09");break;case 225:e.writeString("av01")}}function n(e,t,i,n){const c=e.getPos();r.xk(e,9,i.length+1+a.IO[t.codecpar.codecId],BigInt(0)),(0,r.VU)(e,t,0,n),s(e,t.codecpar.codecId),e.writeBuffer(i);const o=Number(e.getPos()-c);return e.writeUint32(o),o}},95268:(e,t,i)=>{i.d(t,{e:()=>n,x:()=>s});var r=i(94889),a=i(35028);function s(e,t,i){e.writeUint8(t),e.writeUint24(i)}function n(e,t,i,n){const c=e.getPos();r.xk(e,9,i.length+1+a.IO[27],BigInt(0)),r.ii(e,t,n),s(e,0,0),e.writeBuffer(i);const o=Number(e.getPos()-c);return e.writeUint32(o),o}},35028:(e,t,i)=>{i.d(t,{FJ:()=>a,FV:()=>r,IO:()=>n,U5:()=>s});const r={86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,196:13,12:9,4:2,86:3,92:4,106:5,131:6},a={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},s={7:27,12:173,13:196,9:12,2:4,3:86,4:92,5:106,6:131},n={86018:1,86017:0,86051:0,65543:0,65542:0,69645:0,86049:0,27:4,12:4,173:4,196:4,167:4,225:4,4:0,86:0,92:0,106:0,131:0}},94889:(e,t,i)=>{i.d(t,{BV:()=>s,VU:()=>c,ii:()=>n,xk:()=>a});var r=i(35028);function a(e,t,i,r){e.writeUint8(t),e.writeUint24(i),e.writeUint24(Number(r&BigInt(16777215))),e.writeUint8(Number(r>>BigInt(24)&BigInt(255))),e.writeUint24(0)}function s(e,t){let i=2;(86018===t.codecpar.codecId||t.codecpar.chLayout.nbChannels>1)&&(i|=1),86018===t.codecpar.codecId||t.codecpar.sampleRate>=44e3?i|=12:t.codecpar.sampleRate>=22e3?i|=8:t.codecpar.sampleRate>=11e3&&(i|=4),i|=r.FV[t.codecpar.codecId]<<4,e.writeUint8(i)}function n(e,t,i){let a=15&r.FV[t.codecpar.codecId];27!==t.codecpar.codecId&&12!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||(a|=1&i?16:32),e.writeUint8(a)}function c(e,t,i,r){let a=15&i|128;27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId&&167!==t.codecpar.codecId&&225!==t.codecpar.codecId||(a|=1&r?16:32),e.writeUint8(a)}},59166:(e,t,i)=>{i.d(t,{Jk:()=>k,KD:()=>D,OD:()=>b,QA:()=>v,S1:()=>I,Ui:()=>S,XC:()=>A,ci:()=>M,oT:()=>y,wf:()=>B});var r=i(63939),a=i(50932),s=i(72739),n=i(729),c=i(31865),o=i(37246),d=i(14686),h=i(60264),l=i(71517),f=i(37837),p=i(23991),u=i(83314),U=i(39381);const g=3;function w(e){const t=e.readU(9),i=e.readU(3),r=e.readU(2),a=e.readU(2),s=e.readU(3);e.readU(5),e.readU(2);const n=e.readU(6),c=e.readU(7),o=e.readU(1),d=e.readU(8),h=e.readU(1),l=e.readU(1),f=[],p=[];if(n){for(let t=0;t<n-1;t++)f[t]=e.readU(8);f[n-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let r=i-2;r>=0;--r)t|=e.readU(1)<<r;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let r=i-2;r>=0;--r)t&1<<r&&(p[r]=e.readU(8))}const u=e.readU(8),U=[];if(u)for(let t=0;t<u;t++)U.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:s,chromaFormatIdc:a,constantFrameRate:r,generalProfileIdc:c,generalTierFlag:o,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:l,generalConstraintInfo:f,sublayerLevelIdc:p,generalSubProfileIdc:U,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function m(e){const t=new c.A(e,!0);if(1&t.readUint8()){const i=new o.A;i.appendBuffer(e.subarray(1)),w(i),t.skip(i.getPointer())}let i=[],r=[],a=[];const s=t.readUint8();for(let e=0;e<s;e++){const e=31&t.readUint8();let s=1;13!==e&&12!==e&&(s=t.readUint16());const n=[];for(let e=0;e<s;e++){const e=t.readUint16();n.push(t.readBuffer(e))}14===e?i=n:15===e?r=n:16===e&&(a=n)}return{vpss:i,spss:r,ppss:a}}function x(e,t,i){const r=t[0];let a;if(r){const e=B(r);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new u.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),a=i.getBuffer().subarray(0,i.getPointer())}let c=2+(a?a.length:0);e.length&&(c+=3,c=e.reduce(((e,t)=>e+2+t.length),c)),t.length&&(c+=3,c=t.reduce(((e,t)=>e+2+t.length),c)),i.length&&(c+=3,c=i.reduce(((e,t)=>e+2+t.length),c));const o=new Uint8Array(c),d=new n.A(o,!0);d.writeUint8(g<<1|(a?1:0)|248),a&&d.writeBuffer(a);let h=0;return e.length&&h++,t.length&&h++,i.length&&h++,d.writeUint8(h),e.length&&(d.writeUint8(142),d.writeUint16(e.length),s.__(e,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),t.length&&(d.writeUint8(143),d.writeUint16(t.length),s.__(t,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),i.length&&(d.writeUint8(144),d.writeUint16(i.length),s.__(i,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),o}function I(e){let t=(0,h.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const a=t[1]>>>3&31;14===a?e.push(t):15===a?i.push(t):16===a&&r.push(t)})),i.length&&r.length)return x(e,i,r)}}function y(e){let t,i=!1,r=(0,h.py)(e);if(r.length>=2){const e=[],i=[],a=[];r.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&a.push(t)})),i.length&&a.length&&(t=x(e,i,a),r=r.filter((e=>{const t=e[1]>>>3&31;return 14!==t&&15!==t&&16!==t&&20!==t})))}const a=r.reduce(((e,t)=>e+g+1+t.length),0),c=(0,f.sY)(a),o=(0,d.s3)(c,a),l=new n.A(o);return s.__(r,(e=>{3===g?l.writeUint32(e.length):2===g?l.writeUint24(e.length):1===g?l.writeUint16(e.length):l.writeUint8(e.length),l.writeBuffer(e.subarray(0));const t=e[1]>>>3&31;8!==t&&7!==t&&9!==t&&10!==t||(i=!0)})),{bufferPointer:c,length:a,extradata:t,key:i}}function b(e,t){const i=t?t[0]>>>1&3:g;let r=[],a=[],o=[],h=!1;if(t){const e=m(t);r=e.vpss,a=e.spss,o=e.ppss,h=!0}const l=[],p=new c.A(e);for(;p.remainingSize()>0;){let e=0;e=3===i?p.readUint32():2===i?p.readUint24():1===i?p.readUint16():p.readUint8(),l.push(p.readBuffer(e))}let u=r.reduce(((e,t)=>e+4+t.length),0);u=a.reduce(((e,t)=>e+4+t.length),u),u=o.reduce(((e,t)=>e+4+t.length),u),u=l.reduce(((e,t,i)=>e+(i?3:4)+t.length),u);const U=(0,f.sY)(u+7),w=(0,d.s3)(U,u+7),x=new n.A(w);return x.writeUint8(0),x.writeUint8(0),x.writeUint8(0),x.writeUint8(1),x.writeUint8(0),x.writeUint8(160),x.writeUint8(240),s.__(r,(e=>{x.writeUint8(0),x.writeUint8(0),x.writeUint8(0),x.writeUint8(1),x.writeBuffer(e)})),s.__(a,(e=>{x.writeUint8(0),x.writeUint8(0),x.writeUint8(0),x.writeUint8(1),x.writeBuffer(e)})),s.__(o,(e=>{x.writeUint8(0),x.writeUint8(0),x.writeUint8(0),x.writeUint8(1),x.writeBuffer(e)})),s.__(l,((e,t)=>{x.writeUint8(0),x.writeUint8(0),t||x.writeUint8(0),x.writeUint8(1),x.writeBuffer(e);const i=e[1]>>>3&31;8!==i&&7!==i&&9!==i&&10!==i||(h=!0)})),{bufferPointer:U,length:u+7,key:h}}function k(e,t){var i;if(!(1&r.f[15](e+36)))return;const a=(0,l.iI)(e);if((0,h.Bs)(a))return;const s=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:g;let n=[],o=[],p=[];const u=new c.A(a);for(;u.remainingSize()>0;){let e=0;e=3===s?u.readUint32():2===s?u.readUint24():1===s?u.readUint16():u.readUint8();const t=a.subarray(Number(BigInt.asIntN(32,u.getPos())),Number(BigInt.asIntN(32,u.getPos()))+e);u.skip(e);const i=t[1]>>>3&31;15===i?o.push(t):16===i?p.push(t):14===i&&n.push(t)}if(o.length||p.length||n.length){const t=x(n,o,p),i=(0,f.sY)(t.length);(0,d.lW)(i,t.length,t),(0,l.Ow)(e,1,i,t.length)}}function M(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,l.iI)(e);if(!(0,h.Bs)(i))return;let s=(0,h.py)(i);if(s.length>2){const t=[],i=[],n=[];if(s.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&n.push(e)})),t.length&&i.length&&n.length){const s=x(t,i,n),c=(0,f.sY)(s.length);(0,d.lW)(c,s.length,s),(0,l.Ow)(e,1,c,s.length),a.M[15](e+36,1|r.f[15](e+36))}}}function v(e,t){const{profile:i,level:r,width:a,height:s}=B(t);e.codecpar.profile=i,e.codecpar.level=r,e.codecpar.width=a,e.codecpar.height=s}function A(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=t[0]>>>1&3;const{spss:i}=m(t);i.length&&v(e,i[0])}}function D(e,t=4){if(2===r.f[15](e+80))return(0,h.py)((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t}));{const i=r.f[15](e+28);let a=0;for(;a<i-t;){const i=U.r8(r.f[20](e+24)+(a+t+1))>>>3&31;if(8===i||7===i)return!0;a+=4===t?U.Sg(r.f[20](e+24)+a):3===t?U.ht(r.f[20](e+24)+a):2===t?U.yd(r.f[20](e+24)+a):U.r8(r.f[20](e+24)+a),a+=t}return!1}}function B(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,a=0,s=0,n=0,c=1,d=0,l=0,f=0;const u=[],U=[],g=[],w=[],m=(0,h.BN)(e.subarray(t)),x=new o.A(m.length);x.appendBuffer(m),x.readU1(),x.readU1(),x.readU(6),x.readU(5),x.readU(3),x.readU(8);const I=x.readU(3);c=x.readU(2);const y=x.readU(2);if(x.readU(1)){if(i=x.readU(7),d=x.readU(1),r=x.readU(8),l=x.readU(1),f=x.readU(1),x.readU(1)){for(let e=0;e<8;e++)u[e]=x.readU(8);u[8]=x.readU(7);const e=x.readU(8);x.readU(e)}x.skipPadding();for(let e=I-1;e>=0;e--)U[e]=x.readU(1);x.skipPadding();for(let e=I-1;e>=0;e--)U[e]&&(g[e]=x.readU(8));const e=x.readU(8);if(e)for(let t=0;t<e;t++)w[t]=x.readU(32)}x.readU1(),x.readU1()&&x.readU1();const b=a=p.xb(x),k=s=p.xb(x);if(x.readU1()&&(p.xb(x),p.xb(x),p.xb(x),p.xb(x)),x.readU1()){const e=p.xb(x),t=y+5,i=1<<t,r=b/(1<<t),a=k/(1<<t),s=Math.ceil(Math.log2(r)),n=Math.ceil(Math.log2(a));let c=0,o=0,d=0;e>0&&(d=x.readU1(),o=x.readU1());for(let t=0;e>0&&t<=e;t++)o&&0!=t||(t>0&&b>i&&x.readU(s),t>0&&k>i&&x.readU(n),t<e&&b>i&&x.readU(s),t<e&&k>i&&x.readU(n)),d||x.readU(2);if(c=p.xb(x)+1,x.readU(1)&&x.readU(1))for(let t=0;t<=e;t++)x.readU(c)}n=p.xb(x),x.readU(1),x.readU(1);const M=x.readU(4),v=x.readU(1);let A=0;v&&(A=p.xb(x));const D=[],B=x.readU(2);for(let e=0;e<8*B;e++)D[e]=x.readU(1);return{profile:i,level:r,width:a,height:s,chromaFormatIdc:c,bitDepthMinus8:n,generalProfileSpace:0,tierFlag:d,generalConstraintInfo:u,generalSubProfileIdc:w,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:I,ptlSublayerLevelPresentFlag:U,sublayerLevelIdc:g,sps_log2_max_pic_order_cnt_lsb_minus4:M,sps_poc_msb_cycle_flag:v,sps_poc_msb_cycle_len_minus1:A,sps_num_extra_ph_bytes:B,sps_extra_ph_bit_present_flag:D}}function S(e){0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(e=I(e));const t=new o.A;return t.appendBuffer(e),1&t.readU(8)?w(t):{}}},73040:(e,t,i)=>{i.d(t,{$x:()=>c,bD:()=>o});var r=i(67672),a=i(72739),s=i(95335);async function n(e,t){return{key:await e.readString(await e.readUint16()),value:await c(e,t)}}async function c(e,t){let i;switch(await e.readUint8()){case 0:i=await e.readDouble();break;case 1:i=!!await e.readUint8();break;case 2:i=await e.readString(await e.readUint16());break;case 3:for(i={};e.getPos()<t;){const{key:r,value:a}=await n(e,t);if(i[r]=a,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(i={},await e.skip(4);e.getPos()<t;){const{key:r,value:a}=await n(e,t);if(i[r]=a,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:case 5:i=null;break;case 10:i=[];const r=await e.readUint32();for(let a=0;a<r;a++)i.push(await c(e,t));break;case 11:const a=await e.readDouble(),s=await e.readInt16();i=new Date(a+60*s*1e3);break;case 12:i=await e.readString(await e.readUint32())}return i}function o(e,t){r.ai(t)?(e.writeUint8(0),e.writeDouble(t)):r.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):r.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):r.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):r.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),a.__(t,(t=>{o(e,t)}))):r.Ik(t)?(e.writeUint8(3),s.__(t,((t,i)=>{e.writeUint16(i.length),e.writeString(i),o(e,t)})),e.writeUint24(9)):t instanceof Date?(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0)):null==t&&e.writeUint8(5)}}}]);