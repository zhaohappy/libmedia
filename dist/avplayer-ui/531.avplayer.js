"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[531],{85947:(a,t,e)=>{e.d(t,{A:()=>s});var i=e(134);class s{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(a){}}},92047:(a,t,e)=>{e.r(t),e.d(t,{default:()=>k});var i=e(134),s=e(63939),r=e(50932),n=e(4624),o=e(9705),d=e(65977),c=e(74963),p=e(85947),f=e(85428),l=e(9690),m=e(72739),u=e(14686),w=e(37837),g=e(71517),h=e(44328),z=e(77231),v=e(39381);const U="src/avformat/formats/IMovFormat.ts";class k extends p.A{constructor(a={}){super(),(0,i.A)(this,"type",1),(0,i.A)(this,"context",void 0),(0,i.A)(this,"options",void 0),this.options=a,this.context=(0,l.A)()}init(a){a.ioReader&&a.ioReader.setEndian(!0)}async readHeader(a){try{const t=await a.ioReader.fileSize();let e=0,i=await a.ioReader.readUint32(),s=await a.ioReader.readUint32();s===(0,d.A)("ftyp")?await c.E6(a.ioReader,this.context,{type:s,size:i-8}):(!t||i<t)&&await a.ioReader.skip(i-8);let r=BigInt(0);for(;!this.context.foundMoov;){const e=a.ioReader.getPos();if(e===t)return n.z3("the file format is not mp4",U,100),o.LR;if(i=await a.ioReader.readUint32(),s=await a.ioReader.readUint32(),i<8||t&&e+BigInt(Math.floor(i))>t)return n.z3(`invalid box size ${i}`,U,108),o.LR;s===(0,d.A)("mdat")?(this.context.foundMdat||(r=e),this.context.foundMdat=!0,await a.ioReader.seek(e+BigInt(Math.floor(i)))):s===(0,d.A)("moov")?(await c.wB(a.ioReader,a,this.context,{size:i-8,type:s}),this.context.foundMoov=!0):await a.ioReader.seek(e+BigInt(Math.floor(i)))}if(!this.context.fragment&&!this.context.foundMdat){const t=await a.ioReader.peekUint64()>>BigInt(32);Number(t)===(0,d.A)("moof")&&(this.context.fragment=!0)}if(this.context.fragment&&1&a.ioReader.flags){const t=a.ioReader.getPos(),e=await a.ioReader.fileSize();if(e>BigInt(16)){await a.ioReader.seek(e-BigInt(12));let i=await a.ioReader.readUint32();if(i===(0,d.A)("mfro")){await a.ioReader.skip(4);const t=await a.ioReader.readUint32();await a.ioReader.seek(e-BigInt(Math.floor(t)));const s=await a.ioReader.readUint32();i=await a.ioReader.readUint32(),i===(0,d.A)("mfra")&&await c.t9(a.ioReader,a,this.context,{size:s-8,type:i})}await a.ioReader.seek(t)}}return!this.context.fragment&&this.context.foundMdat&&await a.ioReader.seek(r),e}catch(t){return n.z3(t.message,U,170),this.context.foundMoov||n.z3("moov not found",U,173),a.ioReader.error}}async readAVPacket_(a,t){const{sample:e,stream:i}=(0,f.G)(a,this.context);if(!e)return-1048576;{r.M[15](t+32,i.index),r.M[17](t+16,e.dts),r.M[17](t+8,e.pts),r.M[17](t+48,BigInt(Math.floor(e.duration))),r.M[15](t+36,s.f[15](t+36)|e.flags),r.M[17](t+56,e.pos),r.M[15](t+76,i.timeBase.den),r.M[15](t+72,i.timeBase.num),i.startTime===z.Dh&&(i.startTime=s.f[17](t+8)||s.f[17](t+16));const n=Number(BigInt.asIntN(32,s.f[17](t+56)-a.ioReader.getPos()));0!==n&&(n>0&&(4&a.ioReader.flags||2&a.ioReader.flags)?await a.ioReader.skip(n):await a.ioReader.seek(s.f[17](t+56)));const o=e.size,c=(0,w.sY)(o);if((0,g.NX)(t,c,o),await a.ioReader.readBuffer(o,(0,u.JW)(c,o)),27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||r.M[15](t+80,1),94226===i.codecpar.codecId&&s.f[15](t+28)>=8){const a=v.Sg(s.f[20](t+24)+4)>>>0,e=s.f[15](t+28);if(a===(0,d.A)("vtte")&&8===e){const a=(0,w.Gy)(1);(0,g.NX)(t,a,1),r.M[15](t+28,1)}if(e>8&&(a===(0,d.A)("vtte")||a===(0,d.A)("vttc"))){let a=s.f[20](t+24)+8;const i=s.f[20](t+24)+e;for(;a<i;){const e=v.Sg(a);if(v.Sg(a+4)>>>0===(0,d.A)("payl")&&e>8){const i=(0,w.sY)(e-8);(0,u.Mr)(i,a+8,e-8),(0,g.NX)(t,i,e-8);break}a+=e}}}if(i.sideData[1]){const a=i.sideData[1].length,e=(0,w.sY)(a);(0,g.Ow)(t,1,e,a),(0,u.lW)(e,a,i.sideData[1]),delete i.sideData[1]}}return 0}async readAVPacket(a,t){try{if(this.context.fragment&&!this.context.currentFragment)for(;!this.context.currentFragment;){const t=a.ioReader.getPos(),e=await a.ioReader.readUint32(),i=await a.ioReader.readUint32();i===(0,d.A)("moof")?(this.context.currentFragment={pos:t,size:e,sequence:0,tracks:[],currentTrack:null},this.context.firstMoof||(this.context.firstMoof=t),await c.wZ(a.ioReader,a,this.context,{type:i,size:e-8})):i===(0,d.A)("moov")?await c.wB(a.ioReader,a,this.context,{size:e-8,type:i}):await a.ioReader.skip(e-8)}return await this.readAVPacket_(a,t)}catch(t){return-1048576!==a.ioReader.error?(n.z3(`read packet error, ${t}`,U,320),o.LR):a.ioReader.error}}async seek(a,t,e,i){const s=e,r=t.privData,n=()=>{this.context.currentFragment=null,a.streams.forEach((a=>{a.privData.samplesIndex.length=0}))};if(16&i&&this.context.fragment){const i=(0,h.k)(e,t.timeBase,z.i0);return await a.ioReader.seek(i,!0),n(),BigInt(0)}if(this.context.fragment){if(r.fragIndexes.length){let t=m.El(r.fragIndexes,(a=>a.time>s?-1:a.time===s?0:1));if(t>-1)return await a.ioReader.seek(r.fragIndexes[t].pos,!0),n(),BigInt(0)}return s===BigInt(0)&&this.context.firstMoof?(await a.ioReader.seek(this.context.firstMoof),n(),BigInt(0)):BigInt(o.E$)}let d=m.El(r.samplesIndex,(a=>a.pts>s?-1:a.pts===s?0:1));if(d>-1&&0===t.codecpar.codecType){let a=d;for(;a>=0;a--)if(1&r.samplesIndex[a].flags){d=a;break}a<0&&(d=-1)}return d>-1?(r.currentSample=d,r.sampleEnd=!1,m.__(a.streams,(a=>{if(a!==t){const e=a.privData;let i=(0,h.k)(r.samplesIndex[r.currentSample].pts,t.timeBase,a.timeBase),s=m.El(e.samplesIndex,(a=>a.pts>i?-1:a.pts===i?0:1));if(s>-1&&0===a.codecpar.codecType){let a=s;for(;a>=0;a--)if(1&e.samplesIndex[a].flags){s=a;break}a<0&&(s=-1)}s>=0?(e.currentSample=s,e.sampleEnd=!1):(e.sampleEnd=!0,e.currentSample=e.samplesIndex.length)}})),BigInt(0)):BigInt(o.LR)}getAnalyzeStreamsCount(){return 0}}},21071:(a,t,e)=>{e.d(t,{_l:()=>i,gQ:()=>s});const i=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],s=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco"]},61179:(a,t,e)=>{function i(a,t,e,i=0){const s=a.privData,r=e.trexs.find((a=>a.trackId===t.trackId));let n=t.baseDataOffset+BigInt(Math.floor(t.dataOffset));t.baseIsMoof&&(n+=e.currentFragment.pos);let o=t.baseMediaDecodeTime;const d=t.sampleSizes,c=t.sampleDurations,p=t.sampleFlags,f=t.sampleCompositionTimeOffset;if(!d.length)for(let a=0;a<t.sampleCount;a++)d.push(t.defaultSampleSize||r.size);if(!c.length)for(let a=0;a<t.sampleCount;a++)c.push(t.defaultSampleDuration||r.duration);if(!p.length)for(let a=0;a<t.sampleCount;a++)p.push(t.defaultSampleFlags||r.flags);if(!f.length)for(let a=0;a<t.sampleCount;a++)f.push(0);const l=[];for(let a=0;a<t.sampleCount;a++){const e={dts:o,pts:o+BigInt(Math.floor(f[a])),pos:n,size:d[a],duration:c[a],flags:0};o+=BigInt(Math.floor(e.duration)),n+=BigInt(Math.floor(e.size));let s=p[a];0===a&&t.firstSampleFlags&&(s=t.firstSampleFlags),16842752&s||(e.flags|=1),0===a&&d.length>1&&2&i&&(e.flags|=1),l.push(e)}s.samplesIndex=l}e.d(t,{p:()=>i})},98859:(a,t,e)=>{function i(a){const t=a.privData,e=t.chunkOffsets,i=t.sampleSizes,s=t.cttsSampleCounts,r=t.cttsSampleOffsets,n=t.stscFirstChunk,o=t.stscSamplesPerChunk,d=t.stssSampleNumbersMap,c=t.sttsSampleCounts,p=t.sttsSampleDeltas;if(!e.length)return;let f=0,l=0,m=0,u=0,w=0,g=0,h=BigInt(0),z=0,v=BigInt(0);const U=[];for(let t=0;t<e.length;t++)for(h=e[t],f<n.length-1&&n[f+1]===t+1&&f++,g=o[f];g>0;){const t={dts:v,pts:v,pos:h,size:i[z],duration:0,flags:0};(d&&d.has(z+1)||1===a.codecpar.codecType)&&(t.flags|=1),r&&(t.pts=t.dts+BigInt(Math.floor(r[u])),w++,w===s[u]&&(u++,w=0)),z&&(U[z-1].duration=Number(t.dts-U[z-1].dts)),h+=BigInt(Math.floor(t.size)),v+=BigInt(Math.floor(p[l])),m++,m===c[l]&&(l++,m=0),z++,U.push(t),g--}U.length>1&&(U[z-1].duration=U[z-2].duration),t.samplesIndex=U}e.d(t,{X:()=>i})},3384:(a,t,e)=>{function i(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[]}}e.d(t,{A:()=>i})},9690:(a,t,e)=>{e.d(t,{A:()=>s});var i=e(77231);function s(){return{isom:!1,timescale:i.N_,duration:i.Dh,foundMoov:!1,foundMdat:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:i.N_,volume:i.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},38106:(a,t,e)=>{e.d(t,{A:()=>s});var i=e(77231);function s(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,timescale:0,duration:BigInt(0),trackId:i.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],fragIndexes:[],lastPts:BigInt(0),lastDts:BigInt(0),startDts:BigInt(0),startCT:0,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},85428:(a,t,e)=>{e.d(t,{G:()=>r});var i=e(77231),s=e(44328);function r(a,t){let e,r,n,o,d,c,p=BigInt(0);if(a.streams.forEach((a=>{const t=a.privData;if(!t.samplesIndex||!t.samplesIndex.length)return t.sampleEnd=!0,!0;t.sampleEnd||n&&!(t.samplesIndex[t.currentSample].pos<n.pos)||(n=t.samplesIndex[t.currentSample],o=a),t.sampleEnd||d&&!((0,s.k)(t.samplesIndex[t.currentSample].dts,a.timeBase,i.KR)<p)||(d=t.samplesIndex[t.currentSample],p=(0,s.k)(d.dts,a.timeBase,i.KR),c=a)})),n&&d){const t=(0,s.k)(n.dts,o.timeBase,i.KR),p=(0,s.k)(d.dts,c.timeBase,i.KR);Math.abs(Number(t-p))<1e6||2&a.ioReader.flags||4&a.ioReader.flags?(e=n,r=o):(e=d,r=c)}else n?(e=n,r=o):d&&(e=d,r=c);if(r&&(r.privData.currentSample++,r.privData.currentSample>=r.privData.samplesIndex.length&&(r.privData.sampleEnd=!0)),t.fragment){const e=!!a.streams.find((a=>!1===a.privData.sampleEnd));e||(t.currentFragment=null)}return{sample:e,stream:r}}},74963:(a,t,e)=>{e.d(t,{E6:()=>w,t9:()=>v,wB:()=>h,wZ:()=>z});var i=e(65977),s=e(21071),r=e(68361),n=e(4624),o=e(61179),d=e(98859),c=e(3384),p=e(38106),f=e(37837),l=e(14686),m=e(77231);const u="src/avformat/formats/mov/imov.ts";async function w(a,t,e){const s=a.getPos()+BigInt(Math.floor(e.size));for(t.majorBrand=await a.readUint32(),t.minorVersion=await a.readUint32(),t.majorBrand===(0,i.A)("qt  ")&&(t.isom=!0);a.getPos()<s;)t.compatibleBrand.push(await a.readUint32())}async function g(a,t,e,o){const d=a.getPos()+BigInt(Math.floor(e.size));for(;a.getPos()<d;){const e=await a.readUint32(),d=await a.readUint32();if(e<8)return void n.z3(`invalid box size ${e}`,u,76);if(r.A[d])await r.A[d](a,t,{type:d,size:e-8},o);else if(d===(0,i.A)("mdia")){let n=!1,d=BigInt(0);const c=a.getPos()+BigInt(Math.floor(e-8));for(;a.getPos()<c;){const e=await a.readUint32(),c=await a.readUint32();c===(0,i.A)("hdlr")?(await r.A[c](a,t,{type:c,size:e-8},o),n=!0):c===(0,i.A)("minf")&&n?await g(a,t,{type:c,size:e-8},o):c!==(0,i.A)("minf")||n?r.A[c]?await r.A[c](a,t,{type:c,size:e-8},o):s.gQ.some((a=>(0,i.A)(a)===c))?await g(a,t,{type:c,size:e-8},o):await a.skip(e-8):(d=a.getPos()-BigInt(8),await a.skip(e-8))}if(d){const e=a.getPos();await a.seek(d);const i=await a.readUint32(),s=await a.readUint32();await g(a,t,{type:s,size:i-8},o),await a.seek(e)}}else s.gQ.some((a=>(0,i.A)(a)===d))?await g(a,t,{type:d,size:e-8},o):await a.skip(e-8)}}async function h(a,t,e,s){const o=a.getPos()+BigInt(Math.floor(s.size));for(;a.getPos()<o;){const s=await a.readUint32(),o=await a.readUint32();if(s<8)return void n.z3(`invalid box, type: ${o}, size ${s}`,u,209);if(r.A[o])await r.A[o](a,null,{type:o,size:s-8},e);else if(o===(0,i.A)("trak"))if(!e.foundMoov||e.fragment){const i=t.createStream();if(i.privData=(0,p.A)(),await g(a,i,{type:o,size:s-8},e),e.fragment){const a=i.privData,e=t.streams.find((t=>{const e=t.privData;if(t.index!==i.index&&e.trackId===a.trackId)return!0}));e?(i.sideData[1]&&(e.sideData[1]=i.sideData[1],e.codecpar.extradata&&(0,f.Eb)(e.codecpar.extradata),e.codecpar.extradataSize=e.sideData[1].length,e.codecpar.extradata=(0,f.sY)(e.codecpar.extradataSize),(0,l.lW)(e.codecpar.extradata,e.codecpar.extradataSize,e.sideData[1]),i.codecpar.width!==m.N_&&a.width>0&&(e.codecpar.width=a.width),i.codecpar.width!==m.N_&&a.height>0&&(e.codecpar.height=a.height)),t.removeStream(i),t.streamIndex--):(i.codecpar.width===m.N_&&a.width>0&&(i.codecpar.width=a.width),i.codecpar.width===m.N_&&a.height>0&&(i.codecpar.height=a.height))}else(0,d.X)(i)}else await a.skip(s-8);else o===(0,i.A)("mvex")?(e.fragment=!0,await g(a,null,{type:o,size:s-8},e)):await a.skip(s-8)}}async function z(a,t,e,s){const d=a.getPos()+BigInt(Math.floor(s.size));for(;a.getPos()<d;){const s=await a.readUint32(),d=await a.readUint32();if(s<8)return void n.z3(`invalid box, type: ${d}, size ${s}`,u,314);if(r.A[d])await r.A[d](a,null,{type:d,size:s-8},e);else if(d===(0,i.A)("traf")){const i=(0,c.A)();e.currentFragment.currentTrack=i,await g(a,null,{type:d,size:s-8},e),e.currentFragment.tracks.push(i),e.currentFragment.currentTrack=null;const r=t.streams.find((a=>a.privData.trackId===i.trackId));if(r){const a=r.privData;i.streamIndex=r.index,(0,o.p)(r,i,e,t.ioReader.flags),a.currentSample=0,a.sampleEnd=!1}}else await a.skip(s-8)}}async function v(a,t,e,s){const r=a.getPos()+BigInt(Math.floor(s.size));for(;a.getPos()<r;){const s=a.getPos(),r=await a.readUint32();if(await a.readUint32()===(0,i.A)("tfra")){const s=await a.readUint8();await a.skip(3);const r=await a.readUint32(),n=await a.readUint32(),o=await a.readUint32(),d=t.streams.find((a=>a.privData.trackId===r));if(d){const r=d.privData;let c,p;for(let t=0;t<o;t++){1===s?(c=await a.readUint64(),p=await a.readUint64()):(c=BigInt(Math.floor(await a.readUint32())),p=BigInt(Math.floor(await a.readUint32()))),r.fragIndexes.push({pos:p,time:c});for(let t=0;t<1+(n>>4&3);t++)await a.skip(1);for(let t=0;t<1+(n>>2&3);t++)await a.skip(1);for(let t=0;t<1+(3&n);t++)await a.skip(1)}if(r.fragIndexes.length){await a.seek(r.fragIndexes[r.fragIndexes.length-1].pos);const s=await a.readUint32(),n=await a.readUint32();if(n===(0,i.A)("moof")&&(e.currentFragment={pos:BigInt(0),size:s,sequence:0,tracks:[],currentTrack:null},await z(a,t,e,{size:s,type:n}),r.samplesIndex.length)){const a=r.samplesIndex[r.samplesIndex.length-1];d.duration=a.pts+BigInt(Math.floor(a.duration)),r.samplesIndex.length=0}}}}await a.seek(s+BigInt(Math.floor(r)),!1,!1)}e.currentFragment=null}},6660:(a,t,e)=>{e.d(t,{Q9:()=>r,f3:()=>n,uf:()=>o,zs:()=>s});var i=e(65977);const s={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},r={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},n={vide:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,i.A)("mp4a")]:86018,1836253269:86017,[(0,i.A)("Opus")]:86076,[(0,i.A)("fLaC")]:86028,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[i.A.mp4v]:12,[(0,i.A)("av01")]:225,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("avc1")]:27,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213}},38582:(a,t,e)=>{e.d(t,{A:()=>d});var i=e(4624),s=e(14686),r=e(37837),n=e(21477);const o="src/avformat/formats/mov/parsing/av1c.ts";async function d(a,t,e,d){const c=a.getPos();if(t.codecpar.codecId=225,e.size<=0)return;const p=(0,r.sY)(e.size),f=await a.readBuffer(e.size,(0,s.JW)(p,e.size));d.foundMoov?(t.sideData[1]=f.slice(),(0,r.Eb)(p)):(t.codecpar.extradata=p,t.codecpar.extradataSize=e.size,t.sideData[1]=f.slice()),n.XC(t,t.sideData[1]);const l=e.size-Number(a.getPos()-c);l>0?await a.skip(l):l<0&&i.z3(`read avcc error, size: ${e.size}, read: ${e.size-l}`,o,67)}},73840:(a,t,e)=>{e.d(t,{A:()=>d});var i=e(37837),s=e(14686),r=e(4624),n=e(62815);const o="src/avformat/formats/mov/parsing/avcc.ts";async function d(a,t,e,d){const c=a.getPos();if(t.codecpar.codecId=27,e.size<=0)return;const p=(0,i.sY)(e.size),f=await a.readBuffer(e.size,(0,s.JW)(p,e.size));d.foundMoov?(t.sideData[1]=f.slice(),(0,i.Eb)(p)):(t.codecpar.extradata=p,t.codecpar.extradataSize=e.size,t.sideData[1]=f.slice()),n.XC(t,t.sideData[1]);const l=e.size-Number(a.getPos()-c);l>0?await a.skip(l):l<0&&r.z3(`read avcc error, size: ${e.size}, read: ${e.size-l}`,o,67)}},37213:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/co64.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=[],c=await a.readUint32();if(0===o)for(let t=0;t<c;t++)d.push(await a.readUint64());t.privData.chunkOffsets=d;const p=e.size-Number(a.getPos()-n);p>0?await a.skip(p):p<0&&i.z3(`read co64 error, size: ${e.size}, read: ${e.size-p}`,s,56)}},12869:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/colr.ts";async function r(a,t,e,r){const n=a.getPos();let o=await a.readString(4);if("nclx"===o||"nclc"===o||"prof"===o)if("prof"===o){const i=await a.readBuffer(e.size-4);t.sideData[28]=i}else{let e=await a.readUint16(),i=await a.readUint16(),s=await a.readUint16();if("nclx"===o){const e=await a.readUint8()>>7;t.codecpar.colorRange=e?2:1}e>=23&&(e=2),i>=19&&(i=2),s>=15&&(s=2),t.codecpar.colorPrimaries=e,t.codecpar.colorTrc=i,t.codecpar.colorSpace=s}else i.R8(`unsupported color_parameter_type: ${o}`,s,79);const d=e.size-Number(a.getPos()-n);d>0?await a.skip(d):d<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-d}`,s,87)}},59299:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/ctts.ts";async function r(a,t,e,r){const n=a.getPos(),o=t.privData;await a.skip(4);const d=[],c=[],p=await a.readUint32();for(let t=0;t<p;t++)d.push(await a.readUint32()),c.push(await a.readInt32());o.cttsSampleCounts=d,o.cttsSampleOffsets=c;const f=e.size-Number(a.getPos()-n);f>0?await a.skip(f):f<0&&i.z3(`read ctts error, size: ${e.size}, read: ${e.size-f}`,s,59)}},7320:(a,t,e)=>{e.d(t,{A:()=>f});var i=e(61499),s=e(63939),r=e(50932),n=e(4624),o=e(71517),d=e(87518),c=e(99991);const p="src/avformat/formats/mov/parsing/dac3.ts";async function f(a,t,e,f){const l=a.getPos();if(t.codecpar.codecId=86019,e.size<=0)return;const m=(0,o.E4)(t.codecpar[i.o9]+20,t.codecpar[i.o9]+24,7,4),u=s.f[20](m),w=await a.readUint24(),g=w>>14&7,h=w>>11&7,z=w>>10&1;let v=d.j[h];z&&(v|=8),c.bl(t.codecpar[i.o9]+112),c.ML(t.codecpar[i.o9]+112,v),r.M[15](u,g);const U=e.size-Number(a.getPos()-l);U>0?await a.skip(U):U<0&&n.z3(`read avcc error, size: ${e.size}, read: ${e.size-U}`,p,77)}},36868:(a,t,e)=>{e.d(t,{A:()=>f});var i=e(61499),s=e(63939),r=e(50932),n=e(4624),o=e(71517),d=e(87518),c=e(99991);const p="src/avformat/formats/mov/parsing/dec3.ts";async function f(a,t,e,f){const l=a.getPos();if(t.codecpar.codecId=86056,e.size<=0)return;const m=(0,o.E4)(t.codecpar[i.o9]+20,t.codecpar[i.o9]+24,7,4),u=s.f[20](m);await a.skip(2);const w=await a.readUint24(),g=w>>12&31,h=w>>9&7,z=w>>8&1;let v=d.j[h];z&&(v|=8),c.bl(t.codecpar[i.o9]+112),c.ML(t.codecpar[i.o9]+112,v),r.M[15](u,g),t.codecpar.chLayout.nbChannels>1&&7==g&&r.M[15](u,8);const U=e.size-Number(a.getPos()-l);U>0?await a.skip(U):U<0&&n.z3(`read avcc error, size: ${e.size}, read: ${e.size-U}`,p,82)}},86528:(a,t,e)=>{e.d(t,{A:()=>o});var i=e(4624),s=e(37837),r=e(14686);const n="src/avformat/formats/mov/parsing/dfla.ts";async function o(a,t,e,o){const d=a.getPos();t.codecpar.codecId=86028,await a.skip(1),await a.skip(3);const c=await a.readUint8(),p=128&c,f=127&c,l=await a.readUint24();if(0===f&&34===l){const e=(0,s.sY)(l),i=await a.readBuffer(l,(0,r.JW)(e,l));o.foundMoov?(t.sideData[1]=i.slice(),(0,s.Eb)(e)):(t.codecpar.extradata=e,t.codecpar.extradataSize=l)}else i.z3("streaminfo must be first FLACMetadataBlock",n,67);p||i.R8("non streaminfo FLACMetadataBlock(s) ignored",n,71);const m=e.size-Number(a.getPos()-d);m>0?await a.skip(m):m<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-m}`,n,79)}},41781:(a,t,e)=>{e.d(t,{A:()=>p});var i=e(4624),s=e(37837),r=e(14686),n=e(22576),o=e(31865),d=e(729);const c="src/avformat/formats/mov/parsing/dops.ts";async function p(a,t,e,p){const f=a.getPos();t.codecpar.codecId=86076,await a.skip(1);const l=(0,s.sY)(e.size+8),m=(0,r.JW)(l,e.size+8),u=new o.A(m),w=new d.A(m,!1);w.writeString("OpusHead"),w.writeUint8(1),await a.readBuffer(e.size-1,(0,r.JW)(l+9,e.size-1)),u.seek(10),w.seek(10),w.writeUint16(u.readUint16()),w.writeUint32(u.readUint32()),w.writeUint16(u.readUint16()),p.foundMoov?(t.sideData[1]=m.slice(),(0,s.Eb)(l)):(t.codecpar.extradata=l,t.codecpar.extradataSize=m.length,n.XC(t,m.slice()));const g=e.size-Number(a.getPos()-f);g>0?await a.skip(g):g<0&&i.z3(`read dops error, size: ${e.size}, read: ${e.size-g}`,c,81)}},28412:(a,t,e)=>{e.d(t,{A:()=>f});var i=e(4624),s=e(6660),r=e(37837),n=e(14686),o=e(95832),d=e(22576);const c="src/avformat/formats/mov/parsing/esds.ts";async function p(a){let t=0;for(let e=0;e<4;e++){const e=await a.readUint8();if(t=t<<7|127&e,!(128&e))break}return t}async function f(a,t,e,f){const l=a.getPos();await a.skip(4);let m=a.getPos()+BigInt(Math.floor(e.size-4));for(;a.getPos()<m;){let e=await a.readUint8(),l=await p(a);if(0!==l)if(3===e){let m=a.getPos()+BigInt(Math.floor(l));if(await a.skip(2),await a.skip(1),e=await a.readUint8(),l=await p(a),0===l){i.R8("esds invalid ES descriptor size 0, skip",c,85),await a.skip(Number(m-a.getPos()));continue}if(4===e)if(t.codecpar.codecId=s.Q9[await a.readUint8()],await a.skip(1),await a.skip(3),await a.skip(4),await a.skip(4),a.getPos()<m-BigInt(5))if(e=await a.readUint8(),l=await p(a),5===e){const e=(0,r.sY)(l),i=await a.readBuffer(l,(0,n.JW)(e,l));f.foundMoov?(t.sideData[1]=i.slice(),(0,r.Eb)(e)):(t.codecpar.extradata=e,t.codecpar.extradataSize=l,86018===t.codecpar.codecId?o.XC(t,i.slice()):86076===t.codecpar.codecId&&d.XC(t,i.slice()))}else await a.skip(Number(m-a.getPos()));else await a.skip(Number(m-a.getPos()));else await a.skip(Math.min(l,Number(m-a.getPos())))}else await a.skip(Math.min(l,Number(m-a.getPos())));else i.R8("esds invalid descriptor size 0, skip",c,68),await a.skip(Number(m-a.getPos()))}const u=e.size-Number(a.getPos()-l);u>0?await a.skip(u):u<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-u}`,c,153)}},40179:(a,t,e)=>{e.d(t,{A:()=>o});var i=e(4624),s=e(34677),r=e(6660);const n="src/avformat/formats/mov/parsing/hdlr.ts";async function o(a,t,e,o){const d=a.getPos(),c=await a.readUint8();if(await a.skip(3),0===c){await a.skip(4);const i=await a.readString(4),n=r.f3[i];(0,s.A)(n)&&(t.codecpar.codecType=n),await a.skip(4),await a.skip(4),await a.skip(4);const d=e.size-24;if(d>0){const e=!o.isom&&await a.peekUint8()===d-1;e&&await a.skip(1),t.metadata.handlerName=await a.readString(d-(e?1:0))}}const p=e.size-Number(a.getPos()-d);p>0?await a.skip(p):p<0&&i.z3(`read hdlr error, size: ${e.size}, read: ${e.size-p}`,n,77)}},31421:(a,t,e)=>{e.d(t,{A:()=>d});var i=e(37837),s=e(14686),r=e(4624),n=e(67659);const o="src/avformat/formats/mov/parsing/hvcc.ts";async function d(a,t,e,d){const c=a.getPos();if(t.codecpar.codecId=173,e.size<=0)return;const p=(0,i.sY)(e.size),f=await a.readBuffer(e.size,(0,s.JW)(p,e.size));d.foundMoov?(t.sideData[1]=f.slice(),(0,i.Eb)(p)):(t.codecpar.extradata=p,t.codecpar.extradataSize=e.size,t.sideData[1]=f.slice()),n.XC(t,t.sideData[1]);const l=e.size-Number(a.getPos()-c);l>0?await a.skip(l):l<0&&r.z3(`read hevc error, size: ${e.size}, read: ${e.size-l}`,o,67)}},45248:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/mdhd.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);let d=BigInt(0),c=BigInt(0),p=0,f=BigInt(0);1===o?(d=await a.readUint64(),c=await a.readUint64(),p=await a.readUint32(),f=await a.readUint64()):(d=BigInt(Math.floor(await a.readUint32())),c=BigInt(Math.floor(await a.readUint32())),p=await a.readUint32(),f=BigInt(Math.floor(await a.readUint32()))),t.duration=f,t.timeBase.den=p,t.timeBase.num=1,t.metadata.creationTime=d,t.metadata.modificationTime=c;const l=await a.readUint16(),m=[];m[0]=l>>10&31,m[1]=l>>5&31,m[2]=31&l;const u=String.fromCharCode(m[0]+96,m[1]+96,m[2]+96);t.metadata.language=l,t.metadata.languageString=u,await a.skip(2);const w=e.size-Number(a.getPos()-n);w>0?await a.skip(w):w<0&&i.z3(`read mdhd error, size: ${e.size}, read: ${e.size-w}`,s,83)}},7018:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/mfhd.ts";async function r(a,t,e,r){const n=a.getPos();await a.readUint8(),await a.skip(3),r.currentFragment.sequence=await a.readUint32();const o=e.size-Number(a.getPos()-n);o>0?await a.skip(o):o<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-o}`,s,49)}},19354:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/mvhd.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3),1===o?(r.creationTime=await a.readUint64(),r.modificationTime=await a.readUint64(),r.timescale=await a.readUint32(),r.duration=await a.readUint64()):(r.creationTime=BigInt(Math.floor(await a.readUint32())),r.modificationTime=BigInt(Math.floor(await a.readUint32())),r.timescale=await a.readUint32(),r.duration=BigInt(Math.floor(await a.readUint32()))),r.rate=await a.readUint32(),r.volume=await a.readUint16()>>>8,await a.skip(10),r.matrix=new Uint32Array(9);for(let t=0;t<9;t++)r.matrix[t]=await a.readUint32();await a.skip(24),r.nextTrackId=await a.readUint32();const d=e.size-Number(a.getPos()-n);d>0?await a.skip(d):d<0&&i.z3(`read mvhd error, size: ${e.size}, read: ${e.size-d}`,s,70)}},68361:(a,t,e)=>{e.d(t,{A:()=>A});var i=e(91635),s=e(59299),r=e(63080),n=e(62831),o=e(6570),d=e(34136),c=e(15692),p=e(37213),f=e(45248),l=e(19354),m=e(27436),u=e(40179),w=e(35173),g=e(25778),h=e(7018),z=e(61807),v=e(67523),U=e(58996),k=e(65977);const A={[(0,k.A)("stts")]:i.A,[(0,k.A)("ctts")]:s.A,[(0,k.A)("stss")]:r.A,[(0,k.A)("stsz")]:n.A,[(0,k.A)("stz2")]:o.A,[(0,k.A)("stsc")]:d.A,[(0,k.A)("stco")]:c.A,[(0,k.A)("co64")]:p.A,[(0,k.A)("mdhd")]:f.A,[(0,k.A)("mvhd")]:l.A,[(0,k.A)("tkhd")]:m.A,[(0,k.A)("hdlr")]:u.A,[(0,k.A)("stsd")]:w.A,[(0,k.A)("trex")]:g.A,[(0,k.A)("mfhd")]:h.A,[(0,k.A)("tfhd")]:z.A,[(0,k.A)("tfdt")]:v.A,[(0,k.A)("trun")]:U.A}},15692:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/stco.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=[],c=await a.readUint32();if(0===o)for(let t=0;t<c;t++)d.push(BigInt(Math.floor(await a.readUint32())));t.privData.chunkOffsets=d;const p=e.size-Number(a.getPos()-n);p>0?await a.skip(p):p<0&&i.z3(`read stco error, size: ${e.size}, read: ${e.size-p}`,s,56)}},34136:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/stsc.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=t.privData,c=[],p=[],f=[],l=await a.readUint32();if(0===o)for(let t=0;t<l;t++)c.push(await a.readUint32()),p.push(await a.readUint32()),f.push(await a.readUint32());d.stscFirstChunk=c,d.stscSamplesPerChunk=p,d.stscSampleDescriptionIndex=f;const m=e.size-Number(a.getPos()-n);m>0?await a.skip(m):m<0&&i.z3(`read stsc error, size: ${e.size}, read: ${e.size-m}`,s,65)}},35173:(a,t,e)=>{e.d(t,{A:()=>v});var i=e(4624),s=e(65977),r=e(6660),n=e(73840),o=e(31421),d=e(60703),c=e(83561),p=e(38582),f=e(28412),l=e(28460),m=e(86528),u=e(41781),w=e(12869),g=e(7320),h=e(36868);const z="src/avformat/formats/mov/parsing/stsd.ts";async function v(a,t,e,v){const U=a.getPos(),k=await a.readUint8();await a.skip(3);const A=t.privData,I=await a.readUint32();for(let e=0;e<I;e++){const e=await a.readUint32(),U=await a.readUint32(),I=a.getPos()+BigInt(Math.floor(e-8));if(r.uf[U]&&(t.codecpar.codecId=r.uf[U]),0===e){i.R8("stsd entry invalid box size 0, skip",z,73),await a.skip(Number(I-a.getPos()));break}if(e>=16?(await a.skip(6),await a.skip(2)):e<=7&&i.h2(`invalid size: ${e} in stsd`,z,86),0===t.codecpar.codecType){await a.skip(2),await a.skip(2),t.metadata.vendorId=await a.readString(4),await a.skip(4),await a.skip(4),t.codecpar.width=await a.readUint16(),t.codecpar.height=await a.readUint16(),await a.skip(4),await a.skip(4),await a.skip(4),await a.skip(2);let e=await a.readUint8();for(e>31&&(e=31),t.metadata.encoder=await a.readString(e),e<31&&await a.skip(31-e),await a.skip(2),await a.skip(2);a.getPos()<I;){const e=await a.readUint32(),r=await a.readUint32();0!==e?r===(0,s.A)("avcC")?await(0,n.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("hvcC")?await(0,o.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("vvcC")?await(0,d.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("av1C")?await(0,p.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("vpcC")?await(0,c.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("esds")?await(0,f.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("wave")?await(0,l.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("colr")?await(0,w.A)(a,t,{type:r,size:e-8},v):await a.skip(Math.min(e-8,Number(I-a.getPos()))):(i.R8("stsd video invalid box size 0, skip",z,135),await a.skip(Number(I-a.getPos())))}}else if(1===t.codecpar.codecType){const e=await a.readUint16();for(await a.skip(2),t.metadata.vendorId=await a.readString(4),t.codecpar.chLayout.nbChannels=await a.readUint16(),t.codecpar.bitsPerCodedSample=await a.readUint16(),A.audioCid=await a.readUint16(),await a.skip(2),t.codecpar.sampleRate=await a.readUint32()>>>16,(!v.isom||0===k&&e>0)&&(1===e?(A.samplesPerFrame=await a.readUint32(),await a.skip(4),A.bytesPerFrame=await a.readUint32(),await a.skip(4)):2===e&&(await a.skip(4),t.codecpar.sampleRate=Number(await a.readUint64()),t.codecpar.chLayout.nbChannels=await a.readUint32(),await a.skip(4),t.codecpar.bitsPerCodedSample=await a.readUint32(),await a.skip(4),A.bytesPerFrame=await a.readUint32(),A.samplesPerFrame=await a.readUint32()));a.getPos()<I;){const e=await a.readUint32(),r=await a.readUint32();0!==e?r===(0,s.A)("esds")?await(0,f.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("dfLa")?await(0,m.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("dOps")?await(0,u.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("wave")?await(0,l.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("dac3")?await(0,g.A)(a,t,{type:r,size:e-8},v):r===(0,s.A)("dec3")?await(0,h.A)(a,t,{type:r,size:e-8},v):await a.skip(Math.min(e-8,Number(I-a.getPos()))):(i.R8("stsd audio invalid box size 0, skip",z,282),await a.skip(Number(I-a.getPos())))}}else 3===t.codecpar.codecType?(U===(0,s.A)("stpp")?t.codecpar.codecId=94232:U===(0,s.A)("wvtt")?t.codecpar.codecId=94226:U===(0,s.A)("tx3g")||U===(0,s.A)("text")?t.codecpar.codecId=94213:U===(0,s.A)("c608")&&(t.codecpar.codecId=94218),await a.skip(Math.min(e-8,Number(I-a.getPos())))):await a.skip(Math.min(e-8,Number(I-a.getPos())))}const x=e.size-Number(a.getPos()-U);x>0?await a.skip(x):x<0&&i.z3(`read stsd error, size: ${e.size}, read: ${e.size-x}`,z,383)}},63080:(a,t,e)=>{e.d(t,{A:()=>o});var i=e(80662),s=e.n(i),r=e(4624);const n="src/avformat/formats/mov/parsing/stss.ts";async function o(a,t,e,i){const o=a.getPos(),d=await a.readUint8();await a.skip(3);const c=new(s()),p=await a.readUint32();if(0===d)for(let t=0;t<p;t++)c.set(await a.readUint32(),!0);t.privData.stssSampleNumbersMap=c;const f=e.size-Number(a.getPos()-o);f>0?await a.skip(f):f<0&&r.z3(`read stss error, size: ${e.size}, read: ${e.size-f}`,n,57)}},62831:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/stsz.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=[];let c=0,p=0;if(0===o){c=await a.readUint32(),p=await a.readUint32();for(let t=0;t<p;t++)0===c?d.push(await a.readUint32()):d[t]=c}t.privData.sampleSizes=d;const f=e.size-Number(a.getPos()-n);f>0?await a.skip(f):f<0&&i.z3(`read stsz error, size: ${e.size}, read: ${e.size-f}`,s,65)}},91635:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/stts.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=t.privData,c=[],p=[],f=await a.readUint32();let l=1;if(0===o)for(let t=0;t<f;t++)c.push(await a.readUint32()),l=await a.readInt32(),l<0&&i.R8("File uses negative stts sample delta, using value 1 instead, sync may be lost!",s,53),p.push(l);d.sttsSampleCounts=c,d.sttsSampleDeltas=p;const m=e.size-Number(a.getPos()-n);m>0?await a.skip(m):m<0&&i.z3(`read stts error, size: ${e.size}, read: ${e.size-m}`,s,67)}},6570:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/stz2.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=[];let c=0,p=0;if(0===o)if(await a.skip(3),p=await a.readUint8(),c=await a.readUint32(),4===p)for(let t=0;t<c;t+=2){const e=await a.readUint8();d[t]=e>>4&15,d[t+1]=15&e}else if(8===p)for(let t=0;t<c;t++)d[t]=await a.readUint8();else if(16===p)for(let t=0;t<c;t++)d[t]=await a.readUint16();else i.z3("Error in length field in stz2 box",s,67);t.privData.sampleSizes=d;const f=e.size-Number(a.getPos()-n);f>0?await a.skip(f):f<0&&i.z3(`read stz2 error, size: ${e.size}, read: ${e.size-f}`,s,78)}},67523:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/tfdt.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8();await a.skip(3);const d=r.currentFragment.currentTrack;d&&(d.baseMediaDecodeTime=1===o?await a.readUint64():BigInt(Math.floor(await a.readUint32())));const c=e.size-Number(a.getPos()-n);c>0?await a.skip(c):c<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-c}`,s,57)}},61807:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/tfhd.ts";async function r(a,t,e,r){const n=a.getPos(),o=(await a.readUint8(),await a.readUint24()),d=await a.readUint32(),c=r.currentFragment.currentTrack;c.trackId=d,c&&(1&o&&(c.baseDataOffset=await a.readUint64()),2&o&&await a.skip(4),8&o&&(c.defaultSampleDuration=await a.readUint32()),16&o&&(c.defaultSampleSize=await a.readUint32()),32&o&&(c.defaultSampleFlags=await a.readUint32()),131072&o&&(c.baseIsMoof=!0));const p=e.size-Number(a.getPos()-n);p>0?await a.skip(p):p<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-p}`,s,75)}},27436:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/tkhd.ts";async function r(a,t,e,r){const n=t.privData,o=a.getPos(),d=await a.readUint8();n.flags=await a.readUint24(),1&n.flags&&(t.disposition|=1),1===d?(t.metadata.creationTime=await a.readUint64(),t.metadata.modificationTime=await a.readUint64(),n.trackId=await a.readUint32(),await a.skip(4),n.duration=await a.readUint64()):(t.metadata.creationTime=BigInt(Math.floor(await a.readUint32())),t.metadata.modificationTime=BigInt(Math.floor(await a.readUint32())),n.trackId=await a.readUint32(),await a.skip(4),n.duration=BigInt(Math.floor(await a.readUint32()))),await a.skip(8),n.layer=await a.readInt16(),n.alternateGroup=await a.readInt16(),n.volume=await a.readInt16()>>8,await a.skip(2);const c=[];n.matrix=new Int32Array(9);for(let t=0;t<9;t++)n.matrix[t]=await a.readInt32(),c[t]=8===t?n.matrix[t]/1073741824:n.matrix[t]/65536;n.width=await a.readUint32()>>16,n.height=await a.readUint32()>>16,t.metadata.matrix=c;const p=e.size-Number(a.getPos()-o);p>0?await a.skip(p):p<0&&i.z3(`read tkhd error, size: ${e.size}, read: ${e.size-p}`,s,91)}},25778:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/trex.ts";async function r(a,t,e,r){const n=a.getPos();await a.readUint8(),await a.skip(3);const o=await a.readUint32();await a.skip(4);const d=await a.readUint32(),c=await a.readUint32(),p=await a.readUint32();r.trexs.push({trackId:o,duration:d,size:c,flags:p});const f=e.size-Number(a.getPos()-n);f>0?await a.skip(f):f<0&&i.z3(`read trex error, size: ${e.size}, read: ${e.size-f}`,s,61)}},58996:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/formats/mov/parsing/trun.ts";async function r(a,t,e,r){const n=a.getPos(),o=await a.readUint8(),d=await a.readUint24(),c=r.currentFragment.currentTrack;if(c){c.sampleCount=await a.readUint32(),1&d&&(c.dataOffset=await a.readInt32()),4&d&&(c.firstSampleFlags=await a.readUint32());for(let t=0;t<c.sampleCount;t++)256&d&&c.sampleDurations.push(await a.readUint32()),512&d&&c.sampleSizes.push(await a.readUint32()),1024&d&&c.sampleFlags.push(await a.readUint32()),2048&d&&(0===o?c.sampleCompositionTimeOffset.push(await a.readUint32()):c.sampleCompositionTimeOffset.push(await a.readInt32()))}const p=e.size-Number(a.getPos()-n);p>0?await a.skip(p):p<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-p}`,s,79)}},83561:(a,t,e)=>{e.d(t,{A:()=>d});var i=e(37837),s=e(14686),r=e(4624),n=e(82014);const o="src/avformat/formats/mov/parsing/vpcc.ts";async function d(a,t,e,d){const c=a.getPos();if(await a.readUint8(),await a.skip(3),t.codecpar.codecId=167,e.size-4<=0)return;const p=(0,i.sY)(e.size-4),f=await a.readBuffer(e.size-4,(0,s.JW)(p,e.size-4));d.foundMoov?(t.sideData[1]=f.slice(),(0,i.Eb)(p)):(t.codecpar.extradata=p,t.codecpar.extradataSize=e.size-4,t.sideData[1]=f.slice()),n.XC(t,t.sideData[1]);const l=e.size-Number(a.getPos()-c);l>0?await a.skip(l):l<0&&r.z3(`read vpcc error, size: ${e.size}, read: ${e.size-l}`,o,71)}},60703:(a,t,e)=>{e.d(t,{A:()=>d});var i=e(37837),s=e(14686),r=e(4624),n=e(59166);const o="src/avformat/formats/mov/parsing/vvcc.ts";async function d(a,t,e,d){const c=a.getPos();if(await a.readUint8(),await a.skip(3),t.codecpar.codecId=196,e.size-4<=0)return;const p=(0,i.sY)(e.size-4),f=await a.readBuffer(e.size-4,(0,s.JW)(p,e.size-4));d.foundMoov?(t.sideData[1]=f.slice(),(0,i.Eb)(p)):(t.codecpar.extradata=p,t.codecpar.extradataSize=e.size-4,t.sideData[1]=f.slice()),n.XC(t,t.sideData[1]);const l=e.size-Number(a.getPos()-c);l>0?await a.skip(l):l<0&&r.z3(`read vvcc error, size: ${e.size}, read: ${e.size-l}`,o,71)}},28460:(a,t,e)=>{e.d(t,{A:()=>o});var i=e(4624),s=e(65977),r=e(28412);const n="src/avformat/formats/mov/parsing/wave.ts";async function o(a,t,e,o){const d=a.getPos(),c=d+BigInt(Math.floor(e.size));for(;a.getPos()<c;){const e=await a.readUint32(),d=await a.readUint32();0!==e?d===(0,s.A)("esds")?await(0,r.A)(a,t,{type:d,size:e-8},o):await a.skip(Math.min(e-8,Number(c-a.getPos()))):(i.R8("wave invalid box size 0, skip",n,47),await a.skip(Number(c-a.getPos())))}const p=e.size-Number(a.getPos()-d);p>0?await a.skip(p):p<0&&i.z3(`read vpcc error, size: ${e.size}, read: ${e.size-p}`,n,73)}},65977:(a,t,e)=>{e.d(t,{A:()=>r});var i=e(4624);const s="src/avformat/function/mktag.ts";function r(a){4!==a.length&&i.R8(`tag length is not 4, tag: ${a}`,s,30);let t=0;for(let e=0;e<4;e++)t=t<<8|a.charCodeAt(e);return t}},95832:(a,t,e)=>{e.d(t,{Bq:()=>f,Ij:()=>p,XC:()=>c,f7:()=>l,uF:()=>r});var i=e(77231),s=e(37246);const r={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],d=[i.N_,1,2,3,4,5,6,7];function c(a,t){if(!t&&a.sideData[1]&&(t=a.sideData[1]),t){const{profile:e,sampleRate:s,channels:r}=function(a){let t=i.N_,e=i.N_,s=i.N_;var r,n;return a.length>=2&&(t=a[0]>>3&31,e=null!==(r=o[(7&a[0])<<1|a[1]>>7])&&void 0!==r?r:48e3,s=null!==(n=d[a[1]>>3&15])&&void 0!==n?n:2),{profile:t,sampleRate:e,channels:s}}(t);a.codecpar.profile=e,a.codecpar.sampleRate=s,a.codecpar.chLayout.nbChannels=r}}function p(a){const t=n[a.sampleRate],e=a.chLayout.nbChannels,s=a.profile===i.N_?2:a.profile,r=new Uint8Array(2);return r[0]=(31&s)<<3|(14&t)>>1,r[1]=(1&t)<<7|(15&e)<<3,r}function f(a){if(a.length<7)return-1;const t=a[0]<<4|a[1]>>4;if(4095!==t)return-1;const e=1&a[1],i=(192&a[2])>>>6,s=(60&a[2])>>>2,r=(1&a[2])<<2|(192&a[3])>>>6,n=(3&a[3])<<11|a[4]<<3|(224&a[5])>>>5,c=3&a[6];let p=1===e?7:9,f=n-p;return{syncWord:t,profile:i+1,sampleRate:o[s],channels:d[r],aacFrameLength:n,numberOfRawDataBlocksInFrame:c,headerLength:p,framePayloadLength:f}}function l(a,t){function e(){const a=t.readU(2);let e=0;for(let i=0;i<=a;i++)e<<=8,e|=t.readU(8);return e}t||(t=new s.A).appendBuffer(a);const i=t.getPointer(),r={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;r.syncWord=n,r.muxLengthBytes=t.readU(13);const c=1===t.readU1();if(r.useSameStreamMux=c,!c){const a=1===t.readU1();if(a&&1===t.readU1())return-1;if(a&&e(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=a?e():0;const s=t.readU(5);i-=5;const n=t.readU(4);i-=4;const c=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(a)e();else{let a=0;for(;;){a<<=8;const e=1===t.readU1();if(a+=t.readU(8),!e)break}}1===t.readU1()&&t.readU(8),r.profile=s+1,r.sampleRate=o[n],r.channels=d[c]}let p=0;for(;;){const a=t.readU(8);if(p+=a,255!==a)break}return r.framePayloadLength=p,r.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),r}},87518:(a,t,e)=>{e.d(t,{R:()=>m,j:()=>s});var i=e(37246);const s=[3,4,3,7,259,263,1539,1543],r=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],o=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],p=[2,1,2,3,3,4,4,5],f=[1,2,3,6],l=7;function m(a){const t=new i.A(a.length);t.appendBuffer(a);const e={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(e.syncWord=t.readU(16),2935!==e.syncWord)return-1;if(e.bitstreamId=31&t.peekU(29),e.bitstreamId>16)return-2;if(e.numBlocks=6,e.ac3BitrateCode=-1,e.centerMixLevel=5,e.surroundMixLevel=6,e.dolbySurroundMode=0,e.bitstreamId<=10){if(e.crc1=t.readU(16),e.srCode=t.readU(2),3===e.srCode)return-3;const a=t.readU(6);if(a>37)return-4;e.ac3BitrateCode=a>>1,t.readU(5),e.bitstreamMode=t.readU(3),e.channelMode=t.readU(3),2==e.channelMode?e.dolbySurroundMode=t.readU(2):(1&e.channelMode&&1!=e.channelMode&&(e.centerMixLevel=n[t.readU(2)]),4&e.channelMode&&(e.surroundMixLevel=o[t.readU(2)])),e.lfeOn=t.readU(1),e.srShift=Math.max(e.bitstreamId,8)-8,e.sampleRate=d[e.srCode]>>e.srShift,e.bitrate=1e3*c[e.ac3BitrateCode]>>e.srShift,e.channels=p[e.channelMode]+e.lfeOn,e.frameSize=2*r[a][e.srCode],e.frameType=2,e.substreamId=0}else{if(e.crc1=0,e.frameType=t.readU(2),3==e.frameType)return-5;if(e.substreamId=t.readU(3),e.frameSize=t.readU(11)+1<<1,e.frameSize<l)return-6;if(e.srCode=t.readU(2),3==e.srCode){const a=t.readU(2);if(3==a)return-7;e.sampleRate=d[a]/2,e.srShift=1}else e.numBlocks=f[t.readU(2)],e.sampleRate=d[e.srCode],e.srShift=0;e.channelMode=t.readU(3),e.lfeOn=t.readU(1),e.bitrate=8*e.frameSize*e.sampleRate/(256*e.numBlocks),e.channels=p[e.channelMode]+e.lfeOn}return e.channelLayout=BigInt(s[e.channelMode]),e.lfeOn&&(e.channelLayout|=BigInt(8)),e}},21477:(a,t,e)=>{e.d(t,{Ui:()=>n,XC:()=>r,zk:()=>s});var i=e(37246);e(83314),e(97317);const s={0:"Main",1:"High",2:"Professional"};function r(a,t){if(!t&&a.sideData[1]&&(t=a.sideData[1]),t&&t.length>=4){const e=n(t);a.codecpar.profile=e.profile,a.codecpar.level=e.level}}function n(a){const t=new i.A(a.length);t.appendBuffer(a),t.readU1(),t.readU(7);const e=t.readU(3),s=t.readU(5),r=t.readU1();let n=t.readU1()?10:8;return t.readU1()&&(n=12),{profile:e,level:s,tier:r,bitDepth:n,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}},22576:(a,t,e)=>{e.d(t,{Ij:()=>c,XC:()=>d,kt:()=>o});var i=e(31865),s=e(729),r=e(44328);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(a){let t=0,e=0,i=0;if(a.length<1)return 0;switch(t=a[0],e=n[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(a.length<2)return 0;i=63&a[1]}return i*e}function d(a,t){if(!t&&a.sideData[1]&&(t=a.sideData[1]),t&&t.length>=19){const e=new i.A(t,!1);e.skip(9),a.codecpar.chLayout.nbChannels=e.readUint8(),a.codecpar.initialPadding=e.readUint16(),a.codecpar.sampleRate=e.readUint32(),a.codecpar.seekPreroll=Number((0,r.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function c(a){const t=new Uint8Array(19),e=new s.A(t,!1);return e.writeString("OpusHead"),e.writeUint8(1),e.writeUint8(a.chLayout.nbChannels),e.writeUint16(a.initialPadding),e.writeUint32(a.sampleRate),t}},82014:(a,t,e)=>{e.d(t,{Ui:()=>n,XC:()=>r,wN:()=>s}),e(9599);var i=e(37246);e(77231),e(97317),e(729);const s={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function r(a,t){if(!t&&a.sideData[1]&&(t=a.sideData[1]),t&&t.length>=6){const e=n(t);a.codecpar.profile=e.profile,a.codecpar.level=e.level}}function n(a){const t=new i.A(a.length);return t.appendBuffer(a),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},null:()=>{}}]);