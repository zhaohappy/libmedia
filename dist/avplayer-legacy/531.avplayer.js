(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[531],{58469:(e,t,r)=>{"use strict";r.d(t,{Bq:()=>d,Ij:()=>f,XC:()=>c,f7:()=>l,uF:()=>s});var i=r(134),n=r(77231),a=r(37246),s=(0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)({},1,"Main"),2,"LC"),3,"LC"),4,"LC"),5,"HE"),6,"HE"),o={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,n.N_,n.N_,n.N_],h=[n.N_,1,2,3,4,5,6,7];function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){var r=function(e){var t,r,i=n.N_,a=n.N_,s=n.N_;return e.length>=2&&(i=e[0]>>3&31,a=null!==(t=u[(7&e[0])<<1|e[1]>>7])&&void 0!==t?t:48e3,s=null!==(r=h[e[1]>>3&15])&&void 0!==r?r:2),{profile:i,sampleRate:a,channels:s}}(t),i=r.profile,a=r.sampleRate,s=r.channels;e.codecpar.profile=i,e.codecpar.sampleRate=a,e.codecpar.chLayout.nbChannels=s}}function f(e){var t=o[e.sampleRate],r=e.chLayout.nbChannels,i=new Uint8Array(2);return i[0]=(31&e.profile)<<3|(14&t)>>1,i[1]=(1&t)<<7|(15&r)<<3,i}function d(e){if(e.length<7)return-1;var t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;var r=1&e[1],i=(192&e[2])>>>6,n=(60&e[2])>>>2,a=(1&e[2])<<2|(192&e[3])>>>6,s=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,o=3&e[6],c=1===r?7:9,f=s-c;return{syncWord:t,profile:i+1,sampleRate:u[n],channels:h[a],aacFrameLength:s,numberOfRawDataBlocksInFrame:o,headerLength:c,framePayloadLength:f}}function l(e,t){function r(){for(var e=t.readU(2),r=0,i=0;i<=e;i++)r<<=8,r|=t.readU(8);return r}t||(t=new a.A).appendBuffer(e);var i=t.getPos(),n={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},s=t.readU(11);if(695!==s)return-1;n.syncWord=s,n.muxLengthBytes=t.readU(13);var o=1===t.readU1();if(n.useSameStreamMux=o,!o){var c=1===t.readU1();if(c&&1===t.readU1())return-1;if(c&&r(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;var f=c?r():0,d=t.readU(5);f-=5;var l=t.readU(4);f-=4;var p=t.readU(4);if(f-=4,t.readU(3),(f-=3)>0&&t.readU(f),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(c)r();else for(;;){var g=1===t.readU1();if(t.readU(8),!g)break}1===t.readU1()&&t.readU(8),n.profile=d+1,n.sampleRate=u[l],n.channels=h[p]}for(var v=0;;){var b=t.readU(8);if(v+=b,255!==b)break}return n.framePayloadLength=v,n.headerLength=t.getPos()-i+(8===t.getBitLeft()?0:1),n}},90412:(e,t,r)=>{"use strict";r.d(t,{Ui:()=>o,XC:()=>s,zk:()=>a}),r(42096),r(75062),r(16091),r(68632);var i=r(134),n=r(37246),a=(0,i.A)((0,i.A)((0,i.A)({},0,"Main"),1,"High"),2,"Professional");function s(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){var r=o(t);e.codecpar.profile=r.profile,e.codecpar.level=r.level}}function o(e){var t=new n.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);var r=t.readU(3),i=t.readU(5),a=t.readU1(),s=t.readU1()?10:8;return t.readU1()&&(s=12),{profile:r,level:i,tier:a,bitDepth:s,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}},20620:(e,t,r)=>{"use strict";r.d(t,{Jk:()=>A,KD:()=>B,MB:()=>x,S1:()=>y,XC:()=>_,ci:()=>I,oT:()=>m,tZ:()=>k,wf:()=>M}),r(42096),r(75062),r(16091),r(68632);var i=r(134),n=r(63939),a=r(50932),s=r(72739),o=r(729),u=r(31865),h=r(37246),c=r(4624),f=r(14686),d=r(71517),l=r(60264),p=r(37837),g=r(23991),v=r(39381),b="src/avformat/codecs/h264.ts",U=3,k=(0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)({},66,"Constrained Baseline"),77,"Main"),100,"High"),110,"High10"),122,"High422"),244,"High444");function x(e){var t=new u.A(e);t.skip(5);for(var r=[],i=[],n=[],a=31&t.readUint8(),s=0;s<a;s++){var o=t.readUint16();r.push(t.readBuffer(o))}for(var h=t.readUint8(),c=0;c<h;c++){var f=t.readUint16();i.push(t.readBuffer(f))}if(t.remainingSize()>4){t.skip(3);var d=t.readUint8();if(d>0)for(var l=0;l<d;l++){var p=t.readUint16();n.push(t.readBuffer(p))}}return{spss:r,ppss:i,spsExts:n}}function w(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e.length>32&&(c.R8("h264 metadata's sps max length is 32, but get ".concat(e.length),b,210),e=e.slice(0,32)),e.length>256&&(c.R8("h264 metadata's pps max length is 256, but get ".concat(e.length),b,214),e=e.slice(0,256));var i=7;i=e.reduce((function(e,t){return e+2+t.length}),i),i=t.reduce((function(e,t){return e+2+t.length}),i);var n=e[0],a=M(n);66!==a.profile&&77!==a.profile&&88!==a.profile&&(i+=4,r.length&&(i=r.reduce((function(e,t){return e+2+t.length}),i)));var u=new Uint8Array(i),h=new o.A(u);return h.writeUint8(1),h.writeUint8(n[1]),h.writeUint8(n[2]),h.writeUint8(n[3]),h.writeUint8(252|U),h.writeUint8(224|31&e.length),s.__(e,(function(e){h.writeUint16(e.length),h.writeBuffer(e)})),h.writeUint8(t.length),s.__(t,(function(e){h.writeUint16(e.length),h.writeBuffer(e)})),66!==a.profile&&77!==a.profile&&88!==a.profile&&(h.writeUint8(252|a.chromaFormatIdc),h.writeUint8(248|a.bitDepthLumaMinus8),h.writeUint8(248|a.bitDepthChromaMinus8),r.length&&s.__(r,(function(e){h.writeUint16(e.length),h.writeBuffer(e)}))),u}function y(e){var t=(0,l.py)(e);if(t.length>1){var r=[],i=[],n=[];if(t.forEach((function(e){var t=31&e[0];7===t?r.push(e):8===t?i.push(e):13===t&&n.push(e)})),r.length&&i.length)return w(r,i,n)}}function m(e){var t,r=(0,l.py)(e),i=!1;if(r.length>1){var n=[],a=[],u=[];r.forEach((function(e){var t=31&e[0];7===t?n.push(e):8===t?a.push(e):13===t&&u.push(e)})),n.length&&a.length&&(t=w(n,a,u)),r=r.filter((function(e){var t=31&e[0];return 9!==t&&8!==t&&7!==t&&13!==t}))}var h=r.reduce((function(e,t){return e+U+1+t.length}),0),c=(0,p.sY)(h),d=(0,f.s3)(c,h),g=new o.A(d);return s.__(r,(function(e){3===U?g.writeUint32(e.length):2===U?g.writeUint24(e.length):1===U?g.writeUint16(e.length):g.writeUint8(e.length),g.writeBuffer(e.subarray(0)),5==(31&e[0])&&(i=!0)})),{bufferPointer:c,length:h,key:i,extradata:t}}function A(e,t){var r;if(1&n.f[15](e+36)){var i=(0,d.iI)(e);if(!(0,l.Bs)(i)){for(var a=null!==(r=t.metadata.naluLengthSizeMinusOne)&&void 0!==r?r:U,s=[],o=[],h=[],c=[],g=new u.A(i);g.remainingSize()>0;){var v;v=3===a?g.readUint32():2===a?g.readUint24():1===a?g.readUint16():g.readUint8();var b=i.subarray(Number(BigInt.asIntN(32,g.getPos())),Number(BigInt.asIntN(32,g.getPos()))+v);g.skip(v);var k=31&b[0];7===k?s.push(b):8===k?o.push(b):13===k?h.push(b):c.push(b)}if(s.length||o.length){var x=w(s,o,h),y=(0,p.sY)(x.length);(0,f.lW)(y,x.length,x),(0,d.Ow)(e,1,y,x.length)}}}}function I(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(1&n.f[15](e+36)||t){var r=(0,d.iI)(e);if((0,l.Bs)(r)){var i=(0,l.py)(r);if(i.length>1){var s=[],o=[],u=[];if(i.forEach((function(e){var t=31&e[0];7===t?s.push(e):8===t?o.push(e):13===t&&u.push(e)})),s.length&&o.length){var h=w(s,o,u),c=(0,p.sY)(h.length);(0,f.lW)(c,h.length,h),(0,d.Ow)(e,1,c,h.length),a.M[15](e+36,1|n.f[15](e+36))}}}}}function _(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[4];var r=x(t).spss;if(r.length){var i=M(r[0]),n=i.profile,a=i.level,s=i.width,o=i.height;e.codecpar.profile=n,e.codecpar.level=a,e.codecpar.width=s,e.codecpar.height=o}}}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(2===n.f[15](e+80))return(0,l.py)((0,f.s3)(n.f[20](e+24),n.f[15](e+28))).some((function(e){return 5==(31&e[0])}));for(var r=n.f[15](e+28),i=0;i<r-t;){if(5==(31&v.r8(n.f[20](e+24)+(i+t))))return!0;i+=4===t?v.Sg(n.f[20](e+24)+i):3===t?v.ht(n.f[20](e+24)+i):2===t?v.yd(n.f[20](e+24)+i):v.r8(n.f[20](e+24)+i),i+=t}return!1}function M(e){if(e&&!(e.length<3)){var t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);var r=(0,l.BN)(e.subarray(t)),i=new h.A(r.length);i.appendBuffer(r),i.readU1(),i.readU(2),i.readU(5);var n=i.readU(8);i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU(2);var a=i.readU(8);g.xb(i);var s=1,o=0,u=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(3===(s=g.xb(i))&&i.readU1(),o=g.xb(i),u=g.xb(i),i.readU1(),i.readU1()))for(var c=new Array(8),f=0;f<(3!=s?8:12);f++)c[f]=i.readU1();var d=g.xb(i),p=g.xb(i),v=0,b=0;if(0===p)v=g.xb(i);else if(1===p){b=i.readU1(),g.$x(i),g.$x(i);for(var U=g.xb(i),k=0;k<U;k++)g.$x(i)}g.xb(i),i.readU1();var x=g.xb(i),w=g.xb(i),y=i.readU1(),m=16*(x+1),A=(2-y)*(w+1)*16;y||i.readU1(),i.readU1();var I=i.readU1();if(I){var _=1,B=2-I;1===s?(_=2,B=2*(2-I)):2===I&&(_=2,B=2-I),m-=_*(g.xb(i)+g.xb(i)),A-=B*(g.xb(i)+g.xb(i))}return{profile:n,level:a,width:m,height:A,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:u,frameMbsOnlyFlag:y,picOrderCntType:p,log2MaxPicOrderCntLsbMinus4:v,deltaPicOrderAlwaysZeroFlag:b,log2MaxFrameNumMinus4:d}}}},53e3:(e,t,r)=>{"use strict";r.d(t,{HL:()=>U,Jk:()=>y,KD:()=>I,S1:()=>x,XC:()=>A,ZU:()=>B,ci:()=>m,dT:()=>v,oT:()=>w,wf:()=>_}),r(42096),r(75062),r(16091),r(68632);var i=r(134),n=r(63939),a=r(50932),s=r(72739),o=r(729),u=r(31865),h=r(37246),c=r(14686),f=r(60264),d=r(71517),l=r(37837),p=r(23991),g=r(39381),v=(0,i.A)((0,i.A)((0,i.A)((0,i.A)({},1,"Main"),2,"Main10"),3,"MainStillPicture"),4,"Main444"),b=3;function U(e){var t=new u.A(e,!0);t.skip(22);for(var r=[],i=[],n=[],a=t.readUint8(),s=0;s<a;s++){for(var o=63&t.readUint8(),h=t.readUint16(),c=[],f=0;f<h;f++){var d=t.readUint16();c.push(t.readBuffer(d))}32===o?r=c:33===o?i=c:34===o&&(n=c)}return{vpss:r,spss:i,ppss:n}}function k(e,t,r){var i=t[0],n=23;e.length&&(n+=3,n=e.reduce((function(e,t){return e+2+t.length}),n)),t.length&&(n+=3,n=t.reduce((function(e,t){return e+2+t.length}),n)),r.length&&(n+=3,n=r.reduce((function(e,t){return e+2+t.length}),n));var a=new Uint8Array(n),u=new o.A(a,!0),h=_(i);u.writeUint8(1),u.writeUint8(i[1]),u.writeUint8(i[2]),u.writeUint8(i[3]),u.writeUint8(i[4]),u.writeUint8(i[5]),u.writeUint8(i[6]),u.writeUint8(i[7]),u.writeUint8(i[8]),u.writeUint8(i[9]),u.writeUint8(i[10]),u.writeUint8(i[11]),u.writeUint8(h.level),u.writeUint8(1020),u.writeUint8(0),u.writeUint8(16320),u.writeUint8(16320|h.chroma_format_idc),u.writeUint8(8160|h.bit_depth_luma_minus8),u.writeUint8(8160|h.bit_depth_chroma_minus8),u.writeUint16(0),u.writeUint8(8|(1&i[0])<<2|b);var c=0;return e.length&&c++,t.length&&c++,r.length&&c++,u.writeUint8(c),e.length&&(u.writeUint8(160),u.writeUint16(e.length),s.__(e,(function(e){u.writeUint16(e.length),u.writeBuffer(e)}))),t.length&&(u.writeUint8(161),u.writeUint16(t.length),s.__(t,(function(e){u.writeUint16(e.length),u.writeBuffer(e)}))),r.length&&(u.writeUint8(162),u.writeUint16(r.length),s.__(r,(function(e){u.writeUint16(e.length),u.writeBuffer(e)}))),a}function x(e){var t=(0,f.py)(e);if(t.length>=2){var r=[],i=[],n=[];if(t.forEach((function(e){var t=e[0]>>>1&63;32===t?r.push(e):33===t?i.push(e):34===t&&n.push(e)})),i.length&&n.length)return k(r,i,n)}}function w(e){var t,r=!1,i=(0,f.py)(e);if(i.length>=2){var n=[],a=[],u=[];i.forEach((function(e){var t=e[0]>>>1&63;32===t?n.push(e):33===t?a.push(e):34===t&&u.push(e)})),a.length&&u.length&&(t=k(n,a,u),i=i.filter((function(e){var t=e[0]>>>1&63;return 32!==t&&33!==t&&34!==t&&35!==t})))}var h=i.reduce((function(e,t){return e+b+1+t.length}),0),d=(0,l.sY)(h),p=(0,c.s3)(d,h),g=new o.A(p);return s.__(i,(function(e){3===b?g.writeUint32(e.length):2===b?g.writeUint24(e.length):1===b?g.writeUint16(e.length):g.writeUint8(e.length),g.writeBuffer(e.subarray(0));var t=e[0]>>>1&63;19!==t&&20!==t&&21!==t||(r=!0)})),{bufferPointer:d,length:h,extradata:t,key:r}}function y(e,t){var r;if(1&n.f[15](e+36)){var i=(0,d.iI)(e);if(!(0,f.Bs)(i)){for(var a=null!==(r=t.metadata.naluLengthSizeMinusOne)&&void 0!==r?r:b,s=[],o=[],h=[],p=new u.A(i);p.remainingSize()>0;){var g;g=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();var v=i.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+g);p.skip(g);var U=v[0]>>>1&63;33===U?o.push(v):34===U?h.push(v):32===U&&s.push(v)}if(o.length||h.length||s.length){var x=k(s,o,h),w=(0,l.sY)(x.length);(0,c.lW)(w,x.length,x),(0,d.Ow)(e,1,w,x.length)}}}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(1&n.f[15](e+36)||t){var r=(0,d.iI)(e);if((0,f.Bs)(r)){var i=(0,f.py)(r);if(i.length>2){var s=[],o=[],u=[];if(i.forEach((function(e){var t=e[0]>>>1&63;32===t?s.push(e):33===t?o.push(e):34===t&&u.push(e)})),s.length&&o.length&&u.length){var h=k(s,o,u),p=(0,l.sY)(h.length);(0,c.lW)(p,h.length,h),(0,d.Ow)(e,1,p,h.length),a.M[15](e+36,1|n.f[15](e+36))}}}}}function A(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[21];var r=U(t).spss;if(r.length){var i=_(r[0]),n=i.profile,a=i.level,s=i.width,o=i.height;e.codecpar.profile=n,e.codecpar.level=a,e.codecpar.width=s,e.codecpar.height=o}}}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(2===n.f[15](e+80))return(0,f.py)((0,c.s3)(n.f[20](e+24),n.f[15](e+28))).some((function(e){var t=e[0]>>>1&63;return 20===t||19===t}));for(var r=n.f[15](e+28),i=0;i<r-t;){var a=g.r8(n.f[20](e+24)+(i+t))>>>1&63;if(20===a||19===a)return!0;i+=4===t?g.Sg(n.f[20](e+24)+i):3===t?g.ht(n.f[20](e+24)+i):2===t?g.yd(n.f[20](e+24)+i):g.r8(n.f[20](e+24)+i),i+=t}return!1}function _(e){if(e&&!(e.length<3)){var t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);var r=0,i=0,n=0,a=0,s=0,o=0,u=1,c=0,d=0,l=0,g=0,v=(0,f.BN)(e.subarray(t)),b=new h.A(v.length);b.appendBuffer(v),b.readU1(),b.readU(6),b.readU(6),b.readU(3),b.readU(4);var U=b.readU(3);b.readU1();var k=0;if(U<=6){c=b.readU(2),d=b.readU1(),r=b.readU(5),l=b.readU(32),g=b.readU(48),i=b.readU(8);for(var x=new Array(6),w=new Array(6),y=0;y<U;y++)x[y]=b.readU1(),w[y]=b.readU1();if(U>0)for(var m=U;m<8;m++)b.readU(2);for(var A=0;A<U;A++)x[A]&&(b.readU(2),b.readU(1),b.readU(5),b.readU(32),b.readU(1),b.readU(1),b.readU(1),b.readU(1),b.readU(44)),w[A]&&b.readU(8);p.xb(b),3===(u=p.xb(b))&&(k=b.readU(1)),n=p.xb(b),a=p.xb(b);var I=0,_=0,B=0,M=0;b.readU1()&&(I=p.xb(b),_=p.xb(b),B=p.xb(b),M=p.xb(b)),s=p.xb(b),o=p.xb(b);var P=2,R=2;0===u?P=R=0:2===u?(P=2,R=1):3===u&&(P=R=1),n-=P*(1<<s+1)*(I+_),a-=R*(1<<s+1)*(B+M)}for(var S=p.xb(b)+4,D=b.readU1()?0:U;D<U+1;D++)p.xb(b),p.xb(b),p.xb(b);var L=p.xb(b)+3,z=p.xb(b),E=p.xb(b)+2,F=p.xb(b),C=L+z,O=L-1,V=n+(1<<C)-1>>C,N=a+(1<<C)-1>>C;return{profile:r,level:i,width:n,height:a,chroma_format_idc:u,bit_depth_luma_minus8:s,bit_depth_chroma_minus8:o,general_profile_space:c,general_tier_flag:d,general_profile_compatibility_flags:l,constraint_flags:g,separate_colour_plane_flag:k,log2_min_cb_size:L,log2_diff_max_min_coding_block_size:z,log2_min_tb_size:E,log2_diff_max_min_transform_block_size:F,log2_max_trafo_size:F+E,log2_ctb_size:C,log2_min_pu_size:O,ctb_width:V,ctb_height:N,ctb_size:V*N,min_cb_width:n>>L,min_cb_height:a>>L,min_tb_width:n>>E,min_tb_height:a>>E,min_pu_width:n>>O,min_pu_height:a>>O,log2_max_poc_lsb:S}}}function B(e){if(e&&!(e.length<3)){var t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);var r=(0,f.BN)(e.subarray(t)),i=new h.A(r.length);return i.appendBuffer(r),{pps_pic_parameter_set_id:p.xb(i),pps_seq_parameter_set_id:p.xb(i),dependent_slice_segment_flag:i.readU1(),output_flag_present_flag:i.readU1(),num_extra_slice_header_bits:i.readU(3)}}}},58919:(e,t,r)=>{"use strict";r.d(t,{Ui:()=>o,XC:()=>s,wN:()=>a}),r(42096),r(75062),r(16091),r(68632);var i=r(134),n=r(37246),a=(0,i.A)((0,i.A)((0,i.A)((0,i.A)({},0,"Profile0"),1,"Profile1"),2,"Profile2"),3,"Profile3");function s(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){var r=o(t);e.codecpar.profile=r.profile,e.codecpar.level=r.level}}function o(e){var t=new n.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},55611:(e,t,r)=>{"use strict";r.d(t,{Jk:()=>x,KD:()=>A,QA:()=>y,Ui:()=>_,XC:()=>m,ci:()=>w,oT:()=>k,wf:()=>I});var i=r(63939),n=r(50932),a=r(72739),s=r(729),o=r(31865),u=r(37246),h=r(14686),c=r(60264),f=r(71517),d=r(37837),l=r(23991),p=r(83314),g=r(39381),v=3;function b(e){var t=e.readU(9),r=e.readU(3),i=e.readU(2),n=e.readU(2),a=e.readU(3);e.readU(5),e.readU(2);var s=e.readU(6),o=e.readU(7),u=e.readU(1),h=e.readU(8),c=e.readU(1),f=e.readU(1),d=[],l=[];if(s){for(var p=0;p<s-1;p++)d[p]=e.readU(8);d[s-1]=e.readU(6)}else e.readU(6);if(r>1){for(var g=0,v=r-2;v>=0;--v)g|=e.readU(1)<<v;for(var b=r;b<=8&&r>1;++b)e.readU(1);for(var U=r-2;U>=0;--U)g&1<<U&&(l[U]=e.readU(8))}var k=e.readU(8),x=[];if(k)for(var w=0;w<k;w++)x.push(e.readU(8));return{olsIdx:t,numSublayers:r,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:i,generalProfileIdc:o,generalTierFlag:u,generalLevelIdc:h,ptlFrameOnlyConstraintFlag:c,ptlMultilayerEnabledFlag:f,generalConstraintInfo:d,sublayerLevelIdc:l,generalSubProfileIdc:x,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function U(e,t,r){var i,n=t[0];if(n){var o=I(n),u=o.generalConstraintInfo;u.length||(u=new Array(12).fill(0));var h=new p.A;if(h.writeU(9,0),h.writeU(3,o.spsMaxSublayersMinus1+1),h.writeU(2,1),h.writeU(2,o.chromaFormatIdc),h.writeU(3,o.bitDepthMinus8),h.writeU(5,31),h.writeU(2,0),h.writeU(6,u.length),h.writeU(7,o.profile),h.writeU1(o.tierFlag),h.writeU(8,o.level),h.writeU1(o.ptlFrameOnlyConstraintFlag),h.writeU1(o.ptlMultilayerEnabledFlag),u.length){for(var c=0;c<u.length-1;c++)h.writeU(8,u[c]);h.writeU(6,u[u.length-1])}else h.writeU(6,63);if(o.spsMaxSublayersMinus1+1>1){for(var f=0,d=o.spsMaxSublayersMinus1-1;d>=0;d--)f=f<<1|o.ptlSublayerLevelPresentFlag[d];h.writeU(o.spsMaxSublayersMinus1,f);for(var l=o.spsMaxSublayersMinus1+1;l<=8&&o.spsMaxSublayersMinus1>0;++l)h.writeU1(0);for(var g=o.spsMaxSublayersMinus1-1;g>=0;g--)o.ptlSublayerLevelPresentFlag[g]&&h.writeU(8,o.sublayerLevelIdc[g])}h.writeU(8,o.generalSubProfileIdc.length);for(var b=0;b<o.generalSubProfileIdc.length;b++)h.writeU(8,o.sublayerLevelIdc[b]);h.writeU(16,o.width),h.writeU(16,o.height),h.writeU(16,0),h.padding(),i=h.getBuffer().subarray(0,h.getPointer())}var U=2+(i?i.length:0);e.length&&(U+=3,U=e.reduce((function(e,t){return e+2+t.length}),U)),t.length&&(U+=3,U=t.reduce((function(e,t){return e+2+t.length}),U)),r.length&&(U+=3,U=r.reduce((function(e,t){return e+2+t.length}),U));var k=new Uint8Array(U),x=new s.A(k,!0);x.writeUint8(v<<1|(i?1:0)|248),i&&x.writeBuffer(i);var w=0;return e.length&&w++,t.length&&w++,r.length&&w++,x.writeUint8(w),e.length&&(x.writeUint8(142),x.writeUint16(e.length),a.__(e,(function(e){x.writeUint16(e.length),x.writeBuffer(e)}))),t.length&&(x.writeUint8(143),x.writeUint16(t.length),a.__(t,(function(e){x.writeUint16(e.length),x.writeBuffer(e)}))),r.length&&(x.writeUint8(144),x.writeUint16(r.length),a.__(r,(function(e){x.writeUint16(e.length),x.writeBuffer(e)}))),k}function k(e){var t,r=!1,i=(0,c.py)(e);if(i.length>=2){var n=[],o=[],u=[];i.forEach((function(e){var t=e[1]>>>3&31;14===t?n.push(e):15===t?o.push(e):16===t&&u.push(e)})),o.length&&u.length&&(t=U(n,o,u),i=i.filter((function(e){var t=e[1]>>>3&31;return 14!==t&&15!==t&&16!==t&&20!==t})))}var f=i.reduce((function(e,t){return e+v+1+t.length}),0),l=(0,d.sY)(f),p=(0,h.s3)(l,f),g=new s.A(p);return a.__(i,(function(e){3===v?g.writeUint32(e.length):2===v?g.writeUint24(e.length):1===v?g.writeUint16(e.length):g.writeUint8(e.length),g.writeBuffer(e.subarray(0));var t=e[1]>>>3&31;8!==t&&7!==t&&9!==t&&10!==t||(r=!0)})),{bufferPointer:l,length:f,extradata:t,key:r}}function x(e,t){var r;if(1&i.f[15](e+36)){var n=(0,f.iI)(e);if(!(0,c.Bs)(n)){for(var a=null!==(r=t.metadata.naluLengthSizeMinusOne)&&void 0!==r?r:v,s=[],u=[],l=[],p=new o.A(n);p.remainingSize()>0;){var g;g=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();var b=n.subarray(Number(BigInt.asIntN(32,p.getPos())),Number(BigInt.asIntN(32,p.getPos()))+g);p.skip(g);var k=b[1]>>>3&31;15===k?u.push(b):16===k?l.push(b):14===k&&s.push(b)}if(u.length||l.length||s.length){var x=U(s,u,l),w=(0,d.sY)(x.length);(0,h.lW)(w,x.length,x),(0,f.Ow)(e,1,w,x.length)}}}}function w(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(1&i.f[15](e+36)||t){var r=(0,f.iI)(e);if((0,c.Bs)(r)){var a=(0,c.py)(r);if(a.length>2){var s=[],o=[],u=[];if(a.forEach((function(e){var t=e[1]>>>3&31;14===t?s.push(e):15===t?o.push(e):16===t&&u.push(e)})),s.length&&o.length&&u.length){var l=U(s,o,u),p=(0,d.sY)(l.length);(0,h.lW)(p,l.length,l),(0,f.Ow)(e,1,p,l.length),n.M[15](e+36,1|i.f[15](e+36))}}}}}function y(e,t){var r=I(t),i=r.profile,n=r.level,a=r.width,s=r.height;e.codecpar.profile=i,e.codecpar.level=n,e.codecpar.width=a,e.codecpar.height=s}function m(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=t[0]>>>1&3;var r=function(e){var t=new o.A(e,!0);if(1&t.readUint8()){var r=new u.A;r.appendBuffer(e.subarray(1)),b(r),t.skip(r.getPos())}for(var i=[],n=[],a=[],s=t.readUint8(),h=0;h<s;h++){var c=31&t.readUint8(),f=1;13!==c&&12!==c&&(f=t.readUint16());for(var d=[],l=0;l<f;l++){var p=t.readUint16();d.push(t.readBuffer(p))}14===c?i=d:15===c?n=d:16===c&&(a=d)}return{vpss:i,spss:n,ppss:a}}(t).spss;r.length&&y(e,r[0])}}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(2===i.f[15](e+80))return(0,c.py)((0,h.s3)(i.f[20](e+24),i.f[15](e+28))).some((function(e){var t=e[1]>>>3&31;return 8===t||7===t}));for(var r=i.f[15](e+28),n=0;n<r-t;){var a=g.r8(i.f[20](e+24)+(n+t+1))>>>3&31;if(8===a||7===a)return!0;n+=4===t?g.Sg(i.f[20](e+24)+n):3===t?g.ht(i.f[20](e+24)+n):2===t?g.yd(i.f[20](e+24)+n):g.r8(i.f[20](e+24)+n),n+=t}return!1}function I(e){if(e&&!(e.length<3)){var t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);var r,i,n,a,s=0,o=0,h=0,f=0,d=0,p=[],g=[],v=[],b=[],U=(0,c.BN)(e.subarray(t)),k=new u.A(U.length);k.appendBuffer(U),k.readU1(),k.readU1(),k.readU(6),k.readU(5),k.readU(3),k.readU(8);var x=k.readU(3);a=k.readU(2);var w=k.readU(2);if(k.readU(1)){if(s=k.readU(7),h=k.readU(1),o=k.readU(8),f=k.readU(1),d=k.readU(1),k.readU(1)){for(var y=0;y<8;y++)p[y]=k.readU(8);p[8]=k.readU(7);var m=k.readU(8);k.readU(m)}k.skipPadding();for(var A=x-1;A>=0;A--)g[A]=k.readU(1);k.skipPadding();for(var I=x-1;I>=0;I--)g[I]&&(v[I]=k.readU(8));var _=k.readU(8);if(_)for(var B=0;B<_;B++)b[B]=k.readU(32)}k.readU1(),k.readU1()&&k.readU1();var M=r=l.xb(k),P=i=l.xb(k);if(k.readU1()&&(l.xb(k),l.xb(k),l.xb(k),l.xb(k)),k.readU1()){var R,S=l.xb(k),D=w+5,L=1<<D,z=M/(1<<D),E=P/(1<<D),F=Math.ceil(Math.log2(z)),C=Math.ceil(Math.log2(E)),O=0,V=0;S>0&&(V=k.readU1(),O=k.readU1());for(var N=0;S>0&&N<=S;N++)O&&0!=N||(N>0&&M>L&&k.readU(F),N>0&&P>L&&k.readU(C),N<S&&M>L&&k.readU(F),N<S&&P>L&&k.readU(C)),V||k.readU(2);if(R=l.xb(k)+1,k.readU(1)&&k.readU(1))for(var T=0;T<=S;T++)k.readU(R)}n=l.xb(k),k.readU(1),k.readU(1);var W=k.readU(4),Y=k.readU(1),J=0;Y&&(J=l.xb(k));for(var X=[],H=k.readU(2),j=0;j<8*H;j++)X[j]=k.readU(1);return{profile:s,level:o,width:r,height:i,chromaFormatIdc:a,bitDepthMinus8:n,generalProfileSpace:0,tierFlag:h,generalConstraintInfo:p,generalSubProfileIdc:b,ptlFrameOnlyConstraintFlag:f,ptlMultilayerEnabledFlag:d,spsMaxSublayersMinus1:x,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:v,sps_log2_max_pic_order_cnt_lsb_minus4:W,sps_poc_msb_cycle_flag:Y,sps_poc_msb_cycle_len_minus1:J,sps_num_extra_ph_bytes:H,sps_extra_ph_bit_present_flag:X}}}function _(e){0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(e=function(e){var t=(0,c.py)(e);if(t.length>=2){var r=[],i=[],n=[];if(t.forEach((function(e){var t=e[1]>>>3&31;14===t?r.push(e):15===t?i.push(e):16===t&&n.push(e)})),i.length&&n.length)return U(r,i,n)}}(e));var t=new u.A;return t.appendBuffer(e),1&t.readU(8)?b(t):{}}},28773:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var i=r(88435),n=r.n(i),a=r(25182),s=r(78716),o=r(81570),u=r(77193),h=r(25767),c=r(43070),f=r(31060),d=r(134),l=r(36443),p=r.n(l),g=r(63939),v=r(50932),b=r(58121),U=r(68243),k=r(4624),x=r(35028),w=r(20620),y=r(58469),m=r(53e3),A=r(55611),I=r(90412),_=r(58919),B=r(9705),M=r(85947),P=r(14686),R=r(37837),S=r(71517),D=r(65977),L=r(44328),z=r(77231),E=r(72739),F=r(52071);function C(e,t,r){return t=(0,h.A)(t),(0,u.A)(e,O()?n()(t,r||[],(0,h.A)(e).constructor):t.apply(e,r))}function O(){try{var e=!Boolean.prototype.valueOf.call(n()(Boolean,[],(function(){})))}catch(e){}return(O=function(){return!!e})()}var V="src/avformat/formats/IFlvFormat.ts",N=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.A)(this,t),e=C(this,t),(0,d.A)((0,c.A)(e),"type",0),(0,d.A)((0,c.A)(e),"header",void 0),(0,d.A)((0,c.A)(e),"script",void 0),(0,d.A)((0,c.A)(e),"options",void 0),(0,d.A)((0,c.A)(e),"firstTagPos",void 0),e.header=new b.A,e.script=new U.A,e.options=r,e}var r,i,n,u,h,l,M;return(0,f.A)(t,e),(0,o.A)(t,[{key:"init",value:function(e){e.ioReader&&e.ioReader.setEndian(!0)}},{key:"readHeader",value:(M=(0,a.A)(p().mark((function e(t){var r,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.ioReader.peekString(3);case 3:if("FLV"===e.sent){e.next=7;break}return k.z3("the file format is not flv",V,101),e.abrupt("return",B.LR);case 7:return e.next=9,this.header.read(t.ioReader);case 9:return e.next=11,t.ioReader.readUint32();case 11:return 0!==e.sent&&k.R8("the previousTagSize0 is not 0",V,108),r=0,e.next=16,t.ioReader.peekUint8();case 16:if(18!==e.sent){e.next=28;break}return e.next=20,t.ioReader.skip(1);case 20:return e.next=22,t.ioReader.readUint24();case 22:return i=e.sent,e.next=25,t.ioReader.skip(7);case 25:return e.next=27,this.script.read(t.ioReader,i);case 27:r=e.sent;case 28:return r>=0&&(this.firstTagPos=t.ioReader.getPos()),e.abrupt("return",r);case 32:return e.prev=32,e.t0=e.catch(0),k.z3(e.t0.message,V,126),e.abrupt("return",t.ioReader.error);case 36:case"end":return e.stop()}}),e,this,[[0,32]])}))),function(e){return M.apply(this,arguments)})},{key:"readCodecConfigurationRecord",value:(l=(0,a.A)(p().mark((function e(t,r,i){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,R.sY)(i),r.codecpar.extradata=n,r.codecpar.extradataSize=i,e.next=5,t.ioReader.readBuffer(i,(0,P.JW)(n,i));case 5:r.sideData[1]=(0,P.s3)(n,i).slice(),27===r.codecpar.codecId?w.XC(r):173===r.codecpar.codecId?m.XC(r):196===r.codecpar.codecId?A.XC(r):225===r.codecpar.codecId?I.XC(r):167===r.codecpar.codecId&&_.XC(r);case 7:case"end":return e.stop()}}),e)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"readAVPacketData",value:(h=(0,a.A)(p().mark((function e(t,r,i,n){var a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.sY)(n),(0,S.NX)(i,a,n),e.next=4,t.ioReader.readBuffer(n,(0,P.JW)(a,n));case 4:27===r.codecpar.codecId?(w.Jk(i,r),v.M[15](i+80,1)):173===r.codecpar.codecId?(m.Jk(i,r),v.M[15](i+80,1)):196===r.codecpar.codecId&&(A.Jk(i,r),v.M[15](i+80,1));case 5:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return h.apply(this,arguments)})},{key:"readAVPacket_",value:(u=(0,a.A)(p().mark((function e(t,r){var i,n,a,s,o,u,h,c,f,d,l,b,U,w,m,A,I,_,M,L,z,E,F,C,O,N,T,W,Y,J;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.ioReader.getPos(),v.M[17](r+56,i),e.next=4,t.ioReader.readUint8();case 4:return e.t0=e.sent,n=31&e.t0,e.next=8,t.ioReader.readUint24();case 8:return a=e.sent,e.next=11,t.ioReader.readUint24();case 11:return s=e.sent,e.next=14,t.ioReader.readUint8();case 14:return(o=e.sent)&&(s|=o<<24),v.M[17](r+16,BigInt(Math.floor(s))),v.M[17](r+8,BigInt(Math.floor(s))),e.next=19,t.ioReader.skip(3);case 19:if(8!==n){e.next=84;break}return(u=t.getStreamByMediaType(1))&&v.M[15](r+32,u.index),v.M[15](r+36,1|g.f[15](r+36)),e.next=25,t.ioReader.readUint8();case 25:if(h=e.sent,!u){e.next=47;break}if(86018!==u.codecpar.codecId){e.next=43;break}return e.next=30,t.ioReader.readUint8();case 30:if(0!==e.sent){e.next=39;break}return c=a-2,f=(0,R.sY)(c),(0,S.Ow)(r,1,f,c),e.next=37,t.ioReader.readBuffer(c,(0,P.JW)(f,c));case 37:e.next=41;break;case 39:return e.next=41,this.readAVPacketData(t,u,r,a-2);case 41:e.next=45;break;case 43:return e.next=45,this.readAVPacketData(t,u,r,a-1);case 45:e.next=82;break;case 47:if(u=t.createStream(),v.M[15](r+32,u.index),u.codecpar.codecType=1,u.timeBase.den=1e3,u.timeBase.num=1,u.startTime=g.f[17](r+8)||g.f[17](r+16),this.script.onMetaData.duration&&(u.duration=BigInt(Math.floor(1e3*this.script.onMetaData.duration))),u.codecpar.chLayout.nbChannels=1&~h?1:2,u.codecpar.sampleRate=44100<<((12&h)>>>2)>>3,u.codecpar.bitsPerCodedSample=2&h?16:8,d=(240&h)>>4,u.codecpar.codecId=0===d||3===d?8===u.codecpar.bitsPerCodedSample?65541:65536:x.FJ[d],86018!==u.codecpar.codecId){e.next=78;break}return e.next=62,t.ioReader.readUint8();case 62:if(0!==e.sent){e.next=74;break}return l=a-2,b=(0,R.sY)(l),u.codecpar.extradata=b,u.codecpar.extradataSize=l,e.next=70,t.ioReader.readBuffer(l,(0,P.JW)(b,l));case 70:u.sideData[1]=(0,P.s3)(b,l).slice(),y.XC(u),e.next=76;break;case 74:return e.next=76,this.readAVPacketData(t,u,r,a-2);case 76:e.next=81;break;case 78:return 86051===u.codecpar.codecId?(u.codecpar.sampleRate=16e3,u.codecpar.chLayout.nbChannels=1):65543!==u.codecpar.codecId&&65542!==u.codecpar.codecId||(u.codecpar.sampleRate=8e3),e.next=81,this.readAVPacketData(t,u,r,a-1);case 81:this.onStreamAdd&&this.onStreamAdd(u);case 82:e.next=234;break;case 84:if(9!==n){e.next=219;break}return(U=t.getStreamByMediaType(0))&&v.M[15](r+32,U.index),e.next=89,t.ioReader.readUint8();case 89:if(w=e.sent,!U){e.next=152;break}if((112&w)>>4==1&&v.M[15](r+36,1|g.f[15](r+36)),!(128&w)){e.next=123;break}return e.next=95,t.ioReader.skip(4);case 95:if(m=15&w,173!==U.codecpar.codecId&&196!==U.codecpar.codecId||v.M[15](r+80,1),0!==m){e.next=105;break}return A=a-5,I=(0,R.sY)(A),(0,S.Ow)(r,1,I,A),e.next=103,t.ioReader.readBuffer(A,(0,P.JW)(I,A));case 103:e.next=121;break;case 105:if(2!==m){e.next=109;break}v.M[15](r+36,32|g.f[15](r+36)),e.next=121;break;case 109:if(1!==m&&3!==m){e.next=121;break}if(1!==m||173!==U.codecpar.codecId&&196!==U.codecpar.codecId){e.next=119;break}return e.next=113,t.ioReader.readUint24();case 113:return _=e.sent,v.M[17](r+8,g.f[17](r+16)+BigInt(Math.floor(_))),e.next=117,this.readAVPacketData(t,U,r,a-8);case 117:e.next=121;break;case 119:return e.next=121,this.readAVPacketData(t,U,r,a-5);case 121:e.next=150;break;case 123:if(27!==U.codecpar.codecId&&173!==U.codecpar.codecId&&12!==U.codecpar.codecId){e.next=148;break}return v.M[15](r+80,1),e.next=127,t.ioReader.readUint8();case 127:return M=e.sent,e.next=130,t.ioReader.readUint24();case 130:if(L=e.sent,v.M[17](r+8,g.f[17](r+16)+BigInt(Math.floor(L))),0!==M){e.next=140;break}return z=a-5,E=(0,R.sY)(z),(0,S.Ow)(r,1,E,z),e.next=138,t.ioReader.readBuffer(z,(0,P.JW)(E,z));case 138:e.next=146;break;case 140:if(2!==M){e.next=144;break}v.M[15](r+36,32|g.f[15](r+36)),e.next=146;break;case 144:return e.next=146,this.readAVPacketData(t,U,r,a-5);case 146:e.next=150;break;case 148:return e.next=150,this.readAVPacketData(t,U,r,a-1);case 150:e.next=217;break;case 152:if(U=t.createStream(),v.M[15](r+32,U.index),U.codecpar.codecType=0,U.timeBase.den=1e3,U.timeBase.num=1,U.startTime=g.f[17](r+8)||g.f[17](r+16),this.script.onMetaData.duration&&(U.duration=BigInt(Math.floor(1e3*this.script.onMetaData.duration))),this.script.onMetaData.width>0&&(U.codecpar.width=this.script.onMetaData.width),this.script.onMetaData.height>0&&(U.codecpar.height=this.script.onMetaData.height),(112&w)>>4==1&&v.M[15](r+36,1|g.f[15](r+36)),!(128&w)){e.next=191;break}return e.next=165,t.ioReader.readUint32();case 165:if((F=e.sent)===(0,D.A)("hvc1")?(U.codecpar.codecId=173,v.M[15](r+80,1)):F===(0,D.A)("vvc1")?(U.codecpar.codecId=196,v.M[15](r+80,1)):F===(0,D.A)("av01")?U.codecpar.codecId=225:F===(0,D.A)("vp09")&&(U.codecpar.codecId=167),0!=(C=15&w)){e.next=173;break}return e.next=171,this.readCodecConfigurationRecord(t,U,a-5);case 171:e.next=189;break;case 173:if(2!==C){e.next=177;break}v.M[15](r+36,32|g.f[15](r+36)),e.next=189;break;case 177:if(1!==C&&3!==C){e.next=189;break}if(1!==C||173!==U.codecpar.codecId&&196!==U.codecpar.codecId){e.next=187;break}return e.next=181,t.ioReader.readUint24();case 181:return O=e.sent,v.M[17](r+8,g.f[17](r+16)+BigInt(Math.floor(O))),e.next=185,this.readAVPacketData(t,U,r,a-8);case 185:e.next=189;break;case 187:return e.next=189,this.readAVPacketData(t,U,r,a-5);case 189:e.next=216;break;case 191:if(U.codecpar.codecId=x.U5[15&w],27!==U.codecpar.codecId&&173!==U.codecpar.codecId&&196!==U.codecpar.codecId&&12!==U.codecpar.codecId){e.next=214;break}return v.M[15](r+80,1),e.next=196,t.ioReader.readUint8();case 196:return N=e.sent,e.next=199,t.ioReader.readUint24();case 199:if(T=e.sent,v.M[17](r+8,g.f[17](r+16)+BigInt(Math.floor(T))),0!==N){e.next=206;break}return e.next=204,this.readCodecConfigurationRecord(t,U,a-5);case 204:e.next=212;break;case 206:if(2!==N){e.next=210;break}v.M[15](r+36,32|g.f[15](r+36)),e.next=212;break;case 210:return e.next=212,this.readAVPacketData(t,U,r,a-5);case 212:e.next=216;break;case 214:return e.next=216,this.readAVPacketData(t,U,r,a-1);case 216:this.onStreamAdd&&this.onStreamAdd(U);case 217:e.next=234;break;case 219:if(18!==n){e.next=230;break}return e.next=222,this.script.read(t.ioReader,a);case 222:if(!((W=e.sent)<0)){e.next=225;break}return e.abrupt("return",W);case 225:return e.next=227,this.readAVPacket_(t,r);case 227:return e.abrupt("return",e.sent);case 230:return k.R8("invalid tag type: ".concat(n,", try to sync to next tag"),V,458),e.next=233,this.syncTag(t);case 233:return e.abrupt("return",this.readAVPacket_(t,r));case 234:return Y=t.ioReader.getPos()-i,e.t1=BigInt,e.t2=Math,e.next=239,t.ioReader.readUint32();case 239:if(e.t3=e.sent,e.t4=e.t2.floor.call(e.t2,e.t3),J=(0,e.t1)(e.t4),Y===J){e.next=245;break}return k.R8("tag ".concat(n," size not match, size: ").concat(Y,", previousTagSize: ").concat(J),V,467),e.abrupt("return",B.LR);case 245:return e.abrupt("return",0);case 246:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"readAVPacket",value:(n=(0,a.A)(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v.M[15](r+76,1e3),v.M[15](r+72,1),e.next=5,this.readAVPacket_(t,r);case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(0),-1048576===t.ioReader.error){e.next=13;break}return k.z3("read packet error, ".concat(e.t0),V,483),e.abrupt("return",B.LR);case 13:return e.abrupt("return",t.ioReader.error);case 14:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"syncTag",value:(i=(0,a.A)(p().mark((function e(t){var r,i,n,a,s,o,u,h,c,f,d,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=z.Dh,i=3;case 2:return e.prev=3,e.next=6,t.ioReader.readUint8();case 6:if(8!==(n=e.sent)&&9!==n){e.next=70;break}return r=t.ioReader.getPos()-BigInt(1),e.next=11,t.ioReader.readUint24();case 11:if(!((a=e.sent)>10485760)){e.next=16;break}return e.next=15,t.ioReader.seek(r+BigInt(1));case 15:return e.abrupt("continue",2);case 16:return e.next=18,t.ioReader.skip(7+a);case 18:return s=t.ioReader.getPos()-r,e.t0=BigInt,e.t1=Math,e.next=23,t.ioReader.readUint32();case 23:if(e.t2=e.sent,e.t3=e.t1.floor.call(e.t1,e.t2),o=(0,e.t0)(e.t3),s!==o){e.next=66;break}u=0;case 28:if(!(u<=i)){e.next=57;break}return h=t.ioReader.getPos(),e.next=32,t.ioReader.readUint8();case 32:if(8!==(c=e.sent)&&9!==c&&18!==c){e.next=54;break}return e.next=36,t.ioReader.readUint24();case 36:return f=e.sent,e.next=39,t.ioReader.skip(7+f);case 39:return d=t.ioReader.getPos()-h,e.t4=BigInt,e.t5=Math,e.next=44,t.ioReader.readUint32();case 44:if(e.t6=e.sent,e.t7=e.t5.floor.call(e.t5,e.t6),l=(0,e.t4)(e.t7),d!==l){e.next=51;break}u++,e.next=52;break;case 51:return e.abrupt("break",57);case 52:e.next=55;break;case 54:return e.abrupt("break",57);case 55:e.next=28;break;case 57:if(!(u<i)){e.next=63;break}return e.next=60,t.ioReader.seek(r+BigInt(1));case 60:r=z.Dh,e.next=64;break;case 63:return e.abrupt("break",77);case 64:e.next=70;break;case 66:return e.next=68,t.ioReader.seek(r+BigInt(1));case 68:return r=z.Dh,e.abrupt("continue",2);case 70:e.next=75;break;case 72:return e.prev=72,e.t8=e.catch(3),e.abrupt("break",77);case 75:e.next=2;break;case 77:if(r===z.Dh){e.next=80;break}return e.next=80,t.ioReader.seek(r);case 80:case"end":return e.stop()}}),e,null,[[3,72]])}))),function(e){return i.apply(this,arguments)})},{key:"seek",value:(r=(0,a.A)(p().mark((function e(t,r,i,n){var a,s,o,u,h,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.ioReader.getPos(),!(2&n)){e.next=10;break}return e.next=4,t.ioReader.seek(i);case 4:if(4&n){e.next=7;break}return e.next=7,this.syncTag(t);case 7:case 16:case 29:return e.abrupt("return",a);case 10:if(!r||!r.sampleIndexes.length){e.next=17;break}if(!((s=E.El(r.sampleIndexes,(function(e){return e.pts>i?-1:1})))>0&&(0,L.k)(i-r.sampleIndexes[s-1].pts,r.timeBase,z.i0)<BigInt(1e4))){e.next=17;break}return k.Yz("seek in sampleIndexes, found index: ".concat(s,", pts: ").concat(r.sampleIndexes[s-1].pts,", pos: ").concat(r.sampleIndexes[s-1].pos),V,582),e.next=16,t.ioReader.seek(r.sampleIndexes[s-1].pos);case 17:if(!this.script.canSeek()){e.next=30;break}if(o=this.script.dts2Position(Number((0,L.k)(i,r.timeBase,z.i0)/BigInt(1e3))),u=o.pos,h=o.dts,!(u>0)){e.next=30;break}return k.Yz("seek in filepositions, found pts: ".concat(h,", pos: ").concat(u),V,591),e.next=23,t.ioReader.seek(BigInt(Math.floor(u)));case 23:return e.next=25,t.ioReader.peekUint8();case 25:if(8===(c=e.sent)||9===c||18===c){e.next=29;break}return e.next=29,this.syncTag(t);case 30:return k.Yz("not found any keyframe index, try to seek in bytes",V,601),e.abrupt("return",(0,F.A)(t,r,i,this.firstTagPos,this.readAVPacket.bind(this),this.syncTag.bind(this)));case 32:case"end":return e.stop()}}),e,this)}))),function(e,t,i,n){return r.apply(this,arguments)})},{key:"getAnalyzeStreamsCount",value:function(){var e=0;return this.header.hasAudio&&e++,this.header.hasVideo&&e++,e}}]),t}(M.A)},85947:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(78716),n=r(81570),a=r(134),s=function(){function e(){(0,i.A)(this,e),(0,a.A)(this,"type",-1),(0,a.A)(this,"onStreamAdd",void 0)}return(0,n.A)(e,[{key:"destroy",value:function(e){}}]),e}()},58121:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(25182),n=r(78716),a=r(81570),s=r(134),o=r(36443),u=r.n(o),h=function(){function e(){(0,n.A)(this,e),(0,s.A)(this,"signature",void 0),(0,s.A)(this,"version",void 0),(0,s.A)(this,"flags",void 0),(0,s.A)(this,"dataOffset",void 0),(0,s.A)(this,"hasVideo",void 0),(0,s.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}var t;return(0,a.A)(e,[{key:"read",value:(t=(0,i.A)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readString(3);case 2:return this.signature=e.sent,e.next=5,t.readUint8();case 5:return this.version=e.sent,e.next=8,t.readUint8();case 8:return this.flags=e.sent,e.next=11,t.readUint32();case 11:this.dataOffset=e.sent,this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"write",value:function(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(this.flags),e.writeUint32(this.dataOffset)}}]),e}()},68243:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var i=r(25182),n=r(78716),a=r(81570),s=r(134),o=r(36443),u=r.n(o),h=r(35336),c=r(67672),f=r(72739),d=r(95335),l=r(92647),p=r(4624),g=r(94889),v=r(9705),b=function(){function e(){(0,n.A)(this,e),(0,s.A)(this,"onMetaData",void 0),this.onMetaData={audiocodecid:10,canSeekToEnd:!1,width:0,height:0,stereo:!0,videocodecid:7}}var t,r,o;return(0,a.A)(e,[{key:"parseObject",value:(o=(0,i.A)(u().mark((function e(t,r){var i,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,t.readUint16();case 3:return e.t1=e.sent,e.next=6,e.t0.readString.call(e.t0,e.t1);case 6:return i=e.sent,e.next=9,this.parseValue(t,r);case 9:return n=e.sent,e.abrupt("return",{key:i,value:n});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"parseValue",value:(r=(0,i.A)(u().mark((function e(t,r){var i,n,a,s,o,h,c,f,d,l,p,g;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readUint8();case 2:i=e.sent,e.t0=i,e.next=0===e.t0?6:1===e.t0?10:2===e.t0?19:3===e.t0?27:8===e.t0?46:9===e.t0?67:10===e.t0?69:11===e.t0?84:12===e.t0?92:100;break;case 6:return e.next=8,t.readDouble();case 8:return n=e.sent,e.abrupt("break",100);case 10:return e.next=12,t.readUint8();case 12:if(!e.sent){e.next=16;break}e.t1=!0,e.next=17;break;case 16:e.t1=!1;case 17:return n=e.t1,e.abrupt("break",100);case 19:return e.t2=t,e.next=22,t.readUint16();case 22:return e.t3=e.sent,e.next=25,e.t2.readString.call(e.t2,e.t3);case 25:return n=e.sent,e.abrupt("break",100);case 27:n={};case 28:if(!(t.getPos()<r)){e.next=45;break}return e.next=31,this.parseObject(t,r);case 31:return a=e.sent,s=a.key,o=a.value,n[s]=o,e.next=37,t.peekUint24();case 37:if(e.t4=e.sent,e.t5=16777215&e.t4,9!==e.t5){e.next=43;break}return e.next=42,t.skip(3);case 42:return e.abrupt("break",45);case 43:e.next=28;break;case 45:return e.abrupt("break",100);case 46:return n={},e.next=49,t.skip(4);case 49:if(!(t.getPos()<r)){e.next=66;break}return e.next=52,this.parseObject(t,r);case 52:return h=e.sent,c=h.key,f=h.value,n[c]=f,e.next=58,t.peekUint24();case 58:if(e.t6=e.sent,e.t7=16777215&e.t6,9!==e.t7){e.next=64;break}return e.next=63,t.skip(3);case 63:return e.abrupt("break",66);case 64:e.next=49;break;case 66:return e.abrupt("break",100);case 67:return n=null,e.abrupt("break",100);case 69:return n=[],e.next=72,t.readUint32();case 72:d=e.sent,l=0;case 74:if(!(l<d)){e.next=83;break}return e.t8=n,e.next=78,this.parseValue(t,r);case 78:e.t9=e.sent,e.t8.push.call(e.t8,e.t9);case 80:l++,e.next=74;break;case 83:return e.abrupt("break",100);case 84:return e.next=86,t.readDouble();case 86:return p=e.sent,e.next=89,t.readInt16();case 89:return g=e.sent,n=new Date(p+60*g*1e3),e.abrupt("break",100);case 92:return e.t10=t,e.next=95,t.readUint32();case 95:return e.t11=e.sent,e.next=98,e.t10.readString.call(e.t10,e.t11);case 98:return n=e.sent,e.abrupt("break",100);case 100:return e.abrupt("return",n);case 101:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"read",value:(t=(0,i.A)(u().mark((function e(t,r){var i,n,a,s,o,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.getPos(),n=i+BigInt(Math.floor(r)),e.next=4,this.parseValue(t,n);case 4:return a=e.sent,e.next=7,this.parseValue(t,n);case 7:return s=e.sent,this[a]=s,o=Number(t.getPos()-i),e.next=12,t.readUint32();case 12:if(h=e.sent,o+11===h){e.next=16;break}return p.R8("script size not match, size: ".concat(o+11,", previousTagSize: ").concat(h),"src/avformat/formats/flv/FlvScriptTag.ts",150),e.abrupt("return",v.LR);case 16:return e.abrupt("return",0);case 17:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"writeValue",value:function(e,t){var r=this;c.ai(t)?(e.writeUint8(0),e.writeDouble(t)):c.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):c.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):c.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):c.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),f.__(t,(function(t){r.writeValue(e,t)}))):c.Ik(t)?(e.writeUint8(3),d.each(t,(function(t,i){e.writeUint16(i.length),e.writeString(i),r.writeValue(e,t)})),e.writeUint24(9)):t instanceof Date&&(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0))}},{key:"computeSize",value:function(){var e=[],t=new h.A;return t.onFlush=function(t){return e.push(t.slice()),0},this.writeValue(t,"onMetaData"),this.writeValue(t,this.onMetaData),t.flush(),(0,l.A)(Uint8Array,e).length}},{key:"write",value:function(e){if(this.onMetaData){var t=[],r=new h.A;r.onFlush=function(e){return t.push(e.slice()),0},this.writeValue(r,"onMetaData"),this.writeValue(r,this.onMetaData),r.flush();var i=(0,l.A)(Uint8Array,t),n=e.getPos();g.xk(e,18,i.length,BigInt(0)),e.writeBuffer(i),e.writeUint32(Number(e.getPos()-n))}}},{key:"dts2Position",value:function(e){if(this.canSeek()){var t,r=-1,i=this.onMetaData.keyframes.times,n=this.onMetaData.keyframes.filepositions;for(t=0;t<i.length;t++){if(i[t]===e){r=t;break}if(i[t]>e){r=Math.max(t-1,0);break}}return t&&t===i.length&&(r=i.length-1),{pos:n[r],dts:i[r]}}return{pos:-1,dts:-1}}},{key:"position2DTS",value:function(e){if(this.canSeek()){var t,r=-1,i=this.onMetaData.keyframes.times,n=this.onMetaData.keyframes.filepositions,a=0;for(a=0;a<n.length;a++)if(n[a]>e){r=a;break}return a===n.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:i[i.length-1]:i[r]}return-1}},{key:"canSeek",value:function(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}]),e}()},35028:(e,t,r)=>{"use strict";r.d(t,{FJ:()=>s,U5:()=>o});var i,n,a=r(134),s=(i={},(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(i,86018,10),86017,2),86051,11),69645,1),86049,6),65543,7),65542,8),27,7),173,12),196,13),(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(i,12,9),4,2),86,3),92,4),106,5),131,6),{10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542}),o={7:27,12:173,13:196,9:12,2:4,3:86,4:92,5:106,6:131};n={},(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(n,86018,1),86017,0),86051,0),65543,0),65542,0),69645,0),86049,0),27,4),12,4),173,4),(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)(n,196,4),167,4),225,4),4,0),86,0),92,0),106,0),131,0)},94889:(e,t,r)=>{"use strict";function i(e,t,r,i){e.writeUint8(t),e.writeUint24(r),e.writeUint24(Number(i&BigInt(16777215))),e.writeUint8(Number(i>>BigInt(24)&BigInt(255))),e.writeUint24(0)}r.d(t,{xk:()=>i})},2187:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var i=r(72739),n=r(44328),a=r(77231);function s(e,t,r){var s=BigInt(0);return i.__(e,(function(e){s+=e.codecpar.bitrate*(0,n.k)(t,r,a.i0)/BigInt(8e3)})),s}},65977:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var i=r(4624),n="src/avformat/function/mktag.ts";function a(e){4!==e.length&&i.R8("tag length is not 4, tag: ".concat(e),n,30);for(var t=0,r=0;r<4;r++)t=t<<8|e.charCodeAt(r);return t}},52071:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var i=r(25182),n=r(36443),a=r.n(n),s=r(63939),o=r(9599),u=r(29170),h=r(77231),c=r(44328),f=r(2187),d=r(71517),l=r(9705),p=r(4624),g="src/avformat/function/seekInBytes.ts";function v(e,t,r,i,n,a){return b.apply(this,arguments)}function b(){return(b=(0,i.A)(a().mark((function e(t,r,i,n,v,b){var U,k,x,w,y,m,A,I,_,B,M,P,R,S;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U=t.ioReader.getPos(),e.next=3,t.ioReader.fileSize();case 3:if(k=e.sent,x=h.Dh,w=i,r.startTime!==h.Dh?w-=r.startTime:w-=r.firstDTS,!((y=(0,c.k)(i,r.timeBase,h.i0))<BigInt(1e4))){e.next=13;break}return p.Yz("seek pts is earlier then 10s, seek to first packet pos(".concat(n,") directly"),g,63),e.next=12,t.ioReader.seek(n);case 12:return e.abrupt("return",U);case 13:if(m=(0,f.d)(t.streams,w,r.timeBase),A=k-(0,f.d)(t.streams,BigInt(5e3),h.i0),I=(0,f.d)(t.streams,BigInt(1e4),h.i0),m>A&&(m=A),!(m<n)){e.next=21;break}return e.next=20,t.ioReader.seek(n);case 20:return e.abrupt("return",U);case 21:_=(0,d._5)(),B=k,M=BigInt(0);case 24:if(!(B-M<I)){e.next=28;break}return x=M,e.abrupt("break",51);case 28:return e.next=30,t.ioReader.seek(m);case 30:return e.next=32,b(t);case 32:return P=t.ioReader.getPos(),e.next=35,v(t,_);case 35:if(!(e.sent>=0)){e.next=48;break}if(R=(0,c.k)(s.f[17](_+8),(0,u.A)(_+72,o.P),h.i0),S=R-y,p.Yz("try to seek to pos: ".concat(m,", got packet pts: ").concat(s.f[17](_+8),"(").concat(R,"ms), diff: ").concat(S,"ms"),g,98),!(S<=BigInt(0)&&-S<BigInt(1e4))){e.next=45;break}return x=P,e.abrupt("break",51);case 45:m=S>BigInt(0)?M+(B=m)>>BigInt(1):(M=m)+B>>BigInt(1);case 46:e.next=49;break;case 48:return e.abrupt("break",51);case 49:e.next=24;break;case 51:if((0,d.Qe)(_),x===h.Dh){e.next=61;break}return p.Yz("finally seek to pos ".concat(x),g,124),e.next=56,t.ioReader.seek(x);case 56:return e.next=58,b(t);case 58:return e.abrupt("return",U);case 61:return e.next=63,t.ioReader.seek(U);case 63:return e.abrupt("return",BigInt(l.E$));case 64:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},null:()=>{},23991:(e,t,r)=>{"use strict";function i(e){for(var t=0;t<32&&0===e.readU1();)t++;return e.readU(t)+((1<<t)-1)}function n(e){var t=i(e);return 1&t?(t+1)/2:-t/2}r.d(t,{$x:()=>n,xb:()=>i})},39381:(e,t,r)=>{"use strict";r.d(t,{E3:()=>a,Sg:()=>h,Y0:()=>u,ht:()=>o,r8:()=>n,yd:()=>s});var i=r(63939);function n(e){return i.f[2](e)}function a(e){return n(e+1)<<8|n(e)}function s(e){return n(e)<<8|n(e+1)}function o(e){return n(e)<<16|n(e+1)<<8|n(e+2)}function u(e){return a(e+2)<<16|a(e)}function h(e){return s(e)<<16|s(e+2)}},60264:(e,t,r)=>{"use strict";function i(e){return e.length>4&&0===e[0]&&0===e[1]&&(1===e[2]||0===e[2]&&1===e[3])}function n(e,t){for(var r=0,i=t;i<e.length;i++)switch(e[i]){case 0:r++;break;case 1:if(r>=2)return{offset:i-Math.min(r,3),startCode:Math.min(r+1,4)};r=0;break;default:r=0}return{offset:-1,startCode:0}}function a(e){for(var t=[],r=n(e,0),i={offset:-1,startCode:0};(i=n(e,r.offset+r.startCode)).offset>-1;)t.push(e.subarray(r.offset+r.startCode,i.offset,!0)),r=i;return t.push(e.subarray(r.offset+r.startCode,void 0,!0)),t}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;r||(r=e.length);for(var i=new Uint8Array(e.length),n=0,a=0,s=0;s<e.length;s++){if(s>=t&&s<r)if(0===e[s])n++;else if(3===e[s]&&2===n&&s+1<e.length&&e[s+1]<=3){if(++s===e.length)break;n=0===e[s]?1:0}else n=0;i[a++]=e[s]}return i.slice(0,a)}r.d(t,{BN:()=>s,Bs:()=>i,Ky:()=>n,py:()=>a})},37246:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(78716),n=r(81570),a=r(134),s=r(4624),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576;(0,i.A)(this,e),(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"pointer",void 0),(0,a.A)(this,"bitsLeft",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"endPointer",void 0),(0,a.A)(this,"error",void 0),(0,a.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}return(0,n.A)(e,[{key:"peekU1",value:function(){(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();var e=this.pointer,t=this.bitsLeft;return 0===t&&(e++,t=8),this.buffer[e]>>t-1&1}},{key:"readU1",value:function(){var e;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,e=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),e}},{key:"readU",value:function(e){for(var t=0,r=0;r<e;r++)t|=this.readU1()<<e-r-1;return t}},{key:"remainingLength",value:function(){return this.endPointer-this.pointer}},{key:"getBitLeft",value:function(){return this.bitsLeft}},{key:"getPos",value:function(){return this.pointer}},{key:"backToPos",value:function(e){this.pointer=e}},{key:"skip",value:function(e){var t=(e-e%8)/8;this.pointer+=t;var r=e%8;this.bitsLeft<=r?(this.pointer++,this.bitsLeft=8-(r-this.bitsLeft)):this.bitsLeft-=r}},{key:"flush",value:function(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);var e=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(e<0)throw this.error=e,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+e,this.pointer=0}else{var t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}},{key:"getBuffer",value:function(){return this.buffer}},{key:"appendBuffer",value:function(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{var t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,s.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",198)}}},{key:"clear",value:function(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}},{key:"skipPadding",value:function(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}]),e}()},83314:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(78716),n=r(81570),a=r(134),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576;(0,i.A)(this,e),(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"pointer",void 0),(0,a.A)(this,"bitPointer",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"error",void 0),(0,a.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.buffer=new Uint8Array(this.size)}return(0,n.A)(e,[{key:"writeU1",value:function(e){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&e?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}},{key:"writeU",value:function(e,t){for(var r=0;r<e;r++)this.writeU1(t>>e-r-1&1)}},{key:"remainingLength",value:function(){return this.size-this.pointer}},{key:"flush",value:function(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){var e=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){var t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}},{key:"padding",value:function(){for(;0!==this.bitPointer;)this.writeU1(0)}},{key:"clear",value:function(){this.pointer=0,this.bitPointer=0,this.error=0}},{key:"getBuffer",value:function(){return this.buffer}},{key:"getPointer",value:function(){return this.pointer}}]),e}()},729:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i=r(78716),n=r(81570),a=r(134),s=r(4624),o=r(50011),u=function(){function e(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,i.A)(this,e),(0,a.A)(this,"data",void 0),(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"byteStart",void 0),(0,a.A)(this,"pos",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!r}return(0,n.A)(e,[{key:"writeUint8",value:function(e){this.data.setUint8(this.pos+++this.byteStart,e)}},{key:"writeUint16",value:function(e){this.data.setUint16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}},{key:"writeUint24",value:function(e){var t=3840&e,r=240&e,i=15&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(r),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(r),this.writeUint8(i))}},{key:"writeUint32",value:function(e){this.data.setUint32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}},{key:"writeUint64",value:function(e){var t=e&BigInt(4294967295),r=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(t)),this.writeUint32(Number(r))):(this.writeUint32(Number(r)),this.writeUint32(Number(t)))}},{key:"writeInt8",value:function(e){this.data.setInt8(this.pos+++this.byteStart,e)}},{key:"writeInt16",value:function(e){this.data.setInt16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}},{key:"writeInt32",value:function(e){this.data.setInt32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}},{key:"writeInt64",value:function(e){var t=e&BigInt(4294967295),r=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(t)),this.writeInt32(Number(r))):(this.writeInt32(Number(r)),this.writeInt32(Number(t)))}},{key:"writeFloat",value:function(e){this.data.setFloat32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}},{key:"writeDouble",value:function(e){this.data.setFloat64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}},{key:"getPos",value:function(){return this.pos}},{key:"seek",value:function(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}},{key:"skip",value:function(e){this.seek(this.pos+e)}},{key:"back",value:function(e){this.seek(this.pos-e)}},{key:"remainingSize",value:function(){return this.size-this.pos}},{key:"writeBuffer",value:function(e){var t=e.length;this.remainingSize()<t&&(t=this.remainingSize(),s.R8("the remaining buffer size is smaller then the wrote buffer, hope set ".concat(e.length,", but set ").concat(t),"src/common/io/BufferWriter.ts",211)),this.buffer.set(e,this.pos),this.pos+=e.length}},{key:"writeString",value:function(e){var t=o.encode(e);return this.writeBuffer(t),t.length}},{key:"getWroteBuffer",value:function(){return this.buffer.subarray(0,this.pos)}},{key:"resetBuffer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}]),e}()},35336:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(78716),n=r(81570),a=r(134),s=r(50011),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;if((0,i.A)(this,e),(0,a.A)(this,"data",void 0),(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"pointer",void 0),(0,a.A)(this,"pos",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"littleEndian",void 0),(0,a.A)(this,"error",void 0),(0,a.A)(this,"onFlush",void 0),(0,a.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=t,this.littleEndian=!r,this.error=0,n&&n.view)this.size=n.length,this.buffer=n,this.data=n.view;else if(n&&!n.byteOffset)this.size=n.length,this.buffer=n,this.data=new DataView(this.buffer.buffer);else{if(n)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}return(0,n.A)(e,[{key:"writeUint8",value:function(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}},{key:"writeUint16",value:function(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}},{key:"writeUint24",value:function(e){this.remainingLength()<3&&this.flush();var t=(16711680&e)>>16,r=(65280&e)>>8,i=255&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(r),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(r),this.writeUint8(i))}},{key:"writeUint32",value:function(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}},{key:"writeUint64",value:function(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}},{key:"writeInt8",value:function(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}},{key:"writeInt16",value:function(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}},{key:"writeInt32",value:function(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}},{key:"writeInt64",value:function(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}},{key:"writeFloat",value:function(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}},{key:"writeDouble",value:function(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}},{key:"getPointer",value:function(){return this.pointer}},{key:"getPos",value:function(){return this.pos}},{key:"remainingLength",value:function(){return this.size-this.pointer}},{key:"writeBuffer",value:function(e){if(e.length){var t=e.length;if(this.remainingLength()<t)for(var r=0;t>0;){this.flush();var i=Math.min(this.size,t);this.buffer.set(e.subarray(r,r+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),r+=i,t-=i}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}}},{key:"writeString",value:function(e){var t=s.encode(e);return this.writeBuffer(t),t.length}},{key:"encodeString",value:function(e){return s.encode(e)}},{key:"flush",value:function(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){var e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}},{key:"flushToPos",value:function(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){var t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}},{key:"seek",value:function(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();var t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}},{key:"seekInline",value:function(e){var t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}},{key:"skip",value:function(e){var t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}},{key:"back",value:function(e){var t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}},{key:"getBuffer",value:function(){return this.buffer.subarray(0,this.pointer)}},{key:"setEndian",value:function(e){this.littleEndian=!e}},{key:"reset",value:function(){this.pointer=0,this.pos=BigInt(0),this.error=0}},{key:"getBufferSize",value:function(){return this.size}}]),e}()},803:(e,t,r)=>{var i=r(16560),n=r(54220);function a(t){return e.exports=a="function"==typeof i&&"symbol"==typeof n?function(e){return typeof e}:function(e){return e&&"function"==typeof i&&e.constructor===i&&e!==i.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,a(t)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}}]);